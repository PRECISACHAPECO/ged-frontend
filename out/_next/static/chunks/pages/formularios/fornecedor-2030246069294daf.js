(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7463],{59424:function(e,a,o){(window.__NEXT_P=window.__NEXT_P||[]).push(["/formularios/fornecedor",function(){return o(33740)}])},93250:function(e,a,o){"use strict";var t=o(85893),n=o(49837),r=o(91359),s=o(69175);let l=e=>{let{result:a,columns:o,btnNew:l=!0,btnPrint:i=!0,btnBack:d,openModal:c,modaLog:u}=e;return(0,t.jsx)(n.Z,{children:(0,t.jsx)(r.Z,{sx:{pt:"0"},children:(0,t.jsx)(s.Z,{rows:a,columns:o,modaLog:u,buttonsHeader:{btnNew:l,btnPrint:i,btnBack:d,openModal:c}})})})};a.Z=l},99384:function(e,a,o){"use strict";var t=o(67294),n=o(46749);let r=()=>{let[e,a]=(0,t.useState)({}),o=(e,o,t,r)=>{let s=new Date(t),l=(0,n.HD)(e,s,r);a(e=>({...e,[o]:l}))};return{setDateFormat:o,dateStatus:e}};a.Z=r},33740:function(e,a,o){"use strict";o.r(a),o.d(a,{default:function(){return K}});var t=o(85893),n=o(67294),r=o(60664),s=o(93250),l=o(87536),i=o(56531),d=o(99734),c=o(34282),u=o(7071),m=o(29308),p=o(23895),x=o(19604),f=o(61953),h=o(49837),v=o(91359),D=o(29630),g=o(79072),I=o(55343),b=o(11163),j=o.n(b),Z=o(46749),y=o(86887),C=o(83830),F=o(40039),S=o(39976),E=o(47842),w=o(86501),P=o(66136),A=o(80377),N=o(22416),k=o(22841),z=o(16056);let M=e=>{let{xs:a,md:o,title:n,index:r,name:s,typePage:l,value:i,disabled:d,register:c,...u}=e;return(0,t.jsx)(g.ZP,{item:!0,xs:a,md:o,children:(0,t.jsx)(f.Z,{display:"flex",flexDirection:"column",alignItems:"start",children:(0,t.jsx)(k.Z,{control:(0,t.jsx)(z.Z,{...u,name:s,...c(s),defaultChecked:i,disabled:d,onChange(e){u.onChange&&u.onChange(e.target.checked,r,s,l)}}),label:n,size:"small",sx:{"&:hover":{"& .MuiFormControlLabel-label":{color:"primary.main"}}}})})})},H=e=>{let{data:a,control:o,setValue:r,register:s,errors:l}=e,[i,d]=(0,n.useState)(!0);return r("emailDestinatario",a.email),(0,t.jsxs)("div",{className:"flex flex-col gap-2 pt-2",children:[i&&(0,t.jsx)(m.Z,{name:"emailDestinatario",type:"email",title:"E-mail do destinat\xe1rio",required:!0,control:o,errors:l.emailDestinatario}),(0,t.jsx)(m.Z,{name:"assunto",title:"Assunto",required:!0,register:s,control:o,defaultValue:"",errors:l.assunto}),(0,t.jsx)(m.Z,{name:"descricao",title:"Descri\xe7\xe3o",multiline:!0,rows:4,required:!0,control:o,defaultValue:"",errors:l.descricao}),(0,t.jsxs)(N.Z,{row:!0,children:[(0,t.jsx)(M,{name:"email",title:"E-mail",value:!0,register:s,onChange:()=>d(!i)}),(0,t.jsx)(M,{name:"alerta",title:"Alerta",value:!0,register:s})]})]})};var O=o(27304),_=o(44373);o(80587);var q=o(92945);let R=e=>{let{values:a,handleFileSelect:o,handleRemove:r,loadingFile:s,disabled:l,errors:i}=e,{settings:d}=(0,n.useContext)(P.J6),c=d.mode,[u,m]=(0,n.useState)(null),p=(0,n.useRef)(null),x=e=>{p.current.click(),m(e)};return(0,n.useEffect)(()=>{p.current&&(p.current.value="")},[o]),(0,t.jsx)("div",{className:"flex flex-col gap-2",children:a&&a.map((e,n)=>(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(g.ZP,{container:!0,spacing:2,children:(0,t.jsx)(g.ZP,{item:!0,xs:12,sm:6,children:(0,t.jsxs)(f.Z,{display:"flex",alignItems:"center",sx:{gap:1},children:[(0,t.jsx)(D.Z,{color:"primary",variant:"subtitle1",sx:{fontWeight:700},children:e.nome}),(0,t.jsx)(D.Z,{variant:"body2",children:"(".concat(e.unidadeMedida,")")})]})})},n),e.produtoAnexosDescricao&&e.produtoAnexosDescricao.length>0&&(0,t.jsx)(g.ZP,{container:!0,spacing:4,children:e.produtoAnexosDescricao.map((e,a)=>(0,t.jsx)(q.Z,{modeTheme:c,handleFileClick:x,selectedItem:u,inputRef:p,item:e,loadingFile:s,indexBlock:n,indexItem:a,handleFileSelect:o,folder:"produto",handleRemove:r,error:i,disabled:l},"".concat(n,"-").concat(a)))}),e.anexos&&0===e.anexos.length&&(0,t.jsx)(D.Z,{variant:"body2",sx:{mb:2},children:"Este produto n\xe3o exige anexos"}),n<a.length-1&&(0,t.jsx)(_.Z,{sx:{my:4}})]}))})};var V=o(50287),L=o(99384);let B=e=>{var a,o,s,l,d,c,u;let{modeloID:p,values:x,fields:f,disabled:h,register:v,errors:D,setValue:I,control:b,getAddressByCep:j}=e,[y,C]=(0,n.useState)([]),{setDateFormat:F,dateStatus:S}=(0,L.Z)(),E=async()=>{let e=await r.h.post("/cadastros/profissional/getProfissionaisAssinatura",{formularioID:1,modeloID:p});C(e.data.preenche)};return(0,n.useEffect)(()=>{E(),x&&!x.data&&I("fieldsHeader.data",(0,Z.Ux)()),x&&!x.hora&&I("fieldsHeader.hora",(0,Z.Xn)())},[x]),(0,t.jsxs)(g.ZP,{container:!0,spacing:4,children:[(0,t.jsx)(V.Z,{xs:12,md:2,title:"Data da avalia\xe7\xe3o",name:"fieldsHeader.data",type:"date",value:null!==(c=null==x?void 0:x.data)&&void 0!==c?c:(0,Z.Ux)(),disabled:h,register:v,control:b,setDateFormat:F,typeValidation:"dataPassado",daysValidation:365,dateStatus:S,errors:null==D?void 0:null===(a=D.fieldsHeader)||void 0===a?void 0:a.data}),(0,t.jsx)(m.Z,{xs:12,md:2,title:"Hora da avalia\xe7\xe3o",name:"fieldsHeader.hora",value:null!==(u=null==x?void 0:x.data)&&void 0!==u?u:(0,Z.Xn)(),type:"time",disabled:h,register:v,control:b,errors:null==D?void 0:null===(o=D.fieldsHeader)||void 0===o?void 0:o.hora}),(0,t.jsx)(m.Z,{xs:12,md:4,title:"CNPJ",name:"fieldsHeader.cnpj",type:"string",mask:"cnpj",disabled:h,register:v,control:b,errors:null==D?void 0:null===(s=D.fieldsHeader)||void 0===s?void 0:s.cnpj}),(0,t.jsx)(m.Z,{xs:12,md:4,title:"Raz\xe3o Social",name:"fieldsHeader.razaoSocial",type:"string",disabled:h,register:v,control:b,errors:null==D?void 0:null===(l=D.fieldsHeader)||void 0===l?void 0:l.razaoSocial}),(0,t.jsx)(m.Z,{xs:12,md:4,title:"Nome Fantasia",name:"fieldsHeader.nomeFantasia",type:"string",disabled:h,register:v,control:b,errors:null==D?void 0:null===(d=D.fieldsHeader)||void 0===d?void 0:d.nomeFantasia}),(0,t.jsx)(i.Z,{register:v,errors:D,setValue:I,control:b,fields:f,values:f,getAddressByCep:j,disabled:h})]})};o(84220);var G=o(41088),T=o(92629);let U=e=>{var a;let o;let{id:s,makeFornecedor:i}=e,{menu:b,user:N,loggedUnity:k}=(0,n.useContext)(F.V);console.log("\uD83D\uDE80 ~ loggedUnitysssssssssssssssssssss:",k);let[z,M]=(0,n.useState)(!1),[_,q]=(0,n.useState)(!1),[V,L]=(0,n.useState)(!1),[U,X]=(0,n.useState)(!1),[J,W]=(0,n.useState)(!1),[Q,K]=(0,n.useState)(!1),[Y,$]=(0,n.useState)(!0),[ee,ea]=(0,n.useState)(!0),[eo,et]=(0,n.useState)(null),[en,er]=(0,n.useState)([]),[es,el]=(0,n.useState)([]),[ei,ed]=(0,n.useState)(null),{createNewNotification:ec}=(0,n.useContext)(S.u),[eu,em]=(0,n.useState)(!1),[ep,ex]=(0,n.useState)([]),[ef,eh]=(0,n.useState)([]),[ev,eD]=(0,n.useState)([]),[eg,eI]=(0,n.useState)(null),[eb,ej]=(0,n.useState)([]),[eZ,ey]=(0,n.useState)(null),[eC,eF]=(0,n.useState)(""),[eS,eE]=(0,n.useState)(!1),[ew,eP]=(0,n.useState)(!1),[eA,eN]=(0,n.useState)({status:!1,errors:[]}),{settings:ek}=(0,n.useContext)(P.J6),{setId:ez}=(0,n.useContext)(C.X),[eM,eH]=(0,n.useState)([]),[eO,e_]=(0,n.useState)(!1),[eq,eR]=(0,n.useState)({status:!1,message:"Voc\xea n\xe3o tem permiss\xf5es",messageType:"info"}),eV=j(),eL=s&&s>0?"edit":"new",eB=eV.pathname;console.log("\uD83D\uDE80 ~ staticUrl:",eB);let{startLoading:eG,stopLoading:eT}=(0,G.Z)(),{reset:eU,register:eX,getValues:eJ,setValue:eW,control:eQ,watch:eK,handleSubmit:eY,clearErrors:e$,setError:e0,formState:{errors:e1}}=(0,l.cI)();console.log("formFornecedor errors: ",e1);let e3=async(e,a)=>{let o={status:e,observacao:a,auth:{usuarioID:N.usuarioID,papelID:N.papelID,unidadeID:k.unidadeID}};try{W(!0),await r.h.post("".concat(eB,"/changeFormStatus/").concat(s),o).then(a=>{w.ZP.success(Z.OD.successUpdate),W(!1),ai(e,null,null)})}catch(t){console.log(t)}},e2=async e=>{try{if(!e.email&&!e.alerta)return w.ZP.error("Selecione ao menos um tipo de notifica\xe7\xe3o!");let a={titulo:e.assunto,descricao:e.descricao,url:"/formularios/fornecedor/",urlID:s,tipoNotificacaoID:3,usuarioGeradorID:N.usuarioID,usuarioID:0,unidadeID:eo.fornecedor.unidadeID,papelID:2,email:e.email,alerta:e.alerta};if(console.log("\uD83D\uDE80 ~ data dat notifica\xe7\xe3o:",a),ec(a),e.email){let o={values:e,auth:{id:s,usuarioID:N.usuarioID,papelID:N.papelID,unidadeID:k.unidadeID}};await r.h.post("".concat(eB,"/sendNotification"),o)}let t=e.alerta&&e.email?"E-mail e alerta enviados com sucesso!":e.alerta&&!e.email?"Alerta criado com sucesso!":!e.alerta&&e.email?"E-mail enviado com sucesso!":null;w.ZP.success(t)}catch(n){console.log(n)}},e4=()=>{navigator.clipboard.writeText(eg),w.ZP.success("Link copiado com sucesso!")},e7=()=>{ez(eo.parFornecedorModeloID),eV.push("/configuracoes/formularios/fornecedor/")},e8={id:1,name:"Gerar novo formul\xe1rio",description:"Gerar um novo formul\xe1rio de preenchimento para este fornecedor.",component:(0,t.jsx)(O.Z,{cnpj:null==ep?void 0:ep.cnpj}),route:null,type:null,modal:!0,action:i,size:"lg",icon:"fluent:form-new-20-regular",identification:null},e9={id:2,name:"Gerar notifica\xe7\xe3o",description:"Gerar uma nova notifica\xe7\xe3o para o fornecedor, podendo ser um e-mail e/ou alerta do sistema.",component:(0,t.jsx)(H,{data:{email:null===(a=ev.find(e=>"email"==e.nomeColuna))||void 0===a?void 0:a.email}}),route:null,type:null,modal:!0,action:e2,icon:"cil:bell",identification:null},e5={id:3,name:"Copiar link do formul\xe1rio",description:"Copiar o link deste formul\xe1rio.",component:(0,t.jsx)(O.Z,{}),route:null,type:null,action:e4,modal:!1,icon:"solar:copy-outline",identification:null},e6={id:4,name:"Formul\xe1rio do fornecedor",nameComponent:"DadosFornecedor",type:"report",params:{data:{fornecedorID:s,unidadeID:k.unidadeID,papelID:N.papelID},route:"fornecedor/dadosFornecedor"},icon:"fluent:print-24-regular"},ae=[];1==N.papelID&&ae.push(e8),ae.push(e9),ae.push(e5),ae.push(e6),1==N.papelID&&(o=!1,b.map(e=>{e.menu.map(e=>{e.submenu&&e.submenu.length>0&&e.submenu.map(e=>{"/configuracoes/formularios"==e.rota&&(o=!0)})})}),o)&&ae.push({id:5,name:"Configura\xe7\xf5es do formul\xe1rio",description:"Alterar as configura\xe7\xf5es do modelo de formul\xe1rio.",route:null,type:null,action:e7,modal:!1,icon:"bi:gear",identification:null});let aa=async()=>{try{await r.h.post("".concat(eB,"/verifyFormPending/").concat(s),{parFormularioID:1}).then(e=>{$(e.data) //! true/false
})}catch(e){console.log(e)}},ao=()=>{M(!0);try{r.h.post("".concat(eB,"/getData/").concat(s),{type:eL,unidadeID:k.unidadeID}).then(e=>{var a,o,t;console.log("getData: ",e.data),M(!1),ex(e.data.fieldsHeader),eh(e.data.fieldsFooter),eD(e.data.fields),er(e.data.produtos),ej(e.data.blocos),el(e.data.grupoAnexo),eF(e.data.info),et(e.data.unidade),eI(e.data.link),ey(e.data.ultimaMovimentacao),as(e.data.blocos),eU(e.data);let n=[];for(let r=0;r<e.data.fields.length;r++){let s=e.data.fields[r].nomeColuna,l=e.data.fields[r].nomeCampo;for(let i in k){if("telefone"==s){let d=null!==(t=k.telefone1)&&void 0!==t?t:k.telefone2;eW("fields[".concat(r,"].").concat(s),null!=d?d:"")}i!==s||eJ("fields[".concat(r,"].").concat(s),k[i])||(eW("fields[".concat(r,"].").concat(s),k[i]),null!==k[i]&&""!==k[i]&&n.push({name:l,value:k[i]}))}}eH(n);let c=Z.WR[null==e?void 0:null===(a=e.data)||void 0===a?void 0:null===(o=a.info)||void 0===o?void 0:o.status];ed(c),eR({status:N.papelID==e.data.unidade.quemPreenche,message:2==N.papelID&&e.data.info.status>=40?"Esse formul\xe1rio j\xe1 foi conclu\xeddo e enviado pra f\xe1brica, n\xe3o \xe9 mais poss\xedvel alterar as informa\xe7\xf5es!":1==N.papelID&&e.data.info.status<40?"Somente o fornecedor pode alterar as informa\xe7\xf5es deste formul\xe1rio!":1==N.papelID&&40==e.data.info.status?"Este formul\xe1rio est\xe1 aguardando aprova\xe7\xe3o":null,messageType:2==N.papelID?"warning":"info"}),aa()}).catch(e=>{console.log("\uD83D\uDE80 ~ error:",e),M(!1)})}catch(e){console.log("\uD83D\uDE80 ~ error:",e),M(!1)}},at=()=>{e$();let e=!1,a=[];null==ev||ev.forEach((o,t)=>{let n=o.tabela?"fields[".concat(t,"].").concat(o.tabela):"fields[".concat(t,"].").concat(o.nomeColuna),r=eJ(n);1!==o.obrigatorio||r||(e0(n,{type:"manual",message:"Campo obrigat\xf3rio"}),a.push(null==o?void 0:o.nomeCampo),e=!0)}),en&&en.length>0&&en.forEach((o,t)=>{o.produtoAnexosDescricao.forEach((n,r)=>{1===n.obrigatorio&&0==n.anexos.length&&(e0("produtos[".concat(t,"].produtoAnexosDescricao[").concat(r,"].anexos"),{type:"manual",message:"Campo obrigat\xf3rio"}),a.push("Anexo: ".concat(null==o?void 0:o.nome," / ").concat(null==n?void 0:n.nome)),e=!0)})}),eb.forEach((o,t)=>{o.itens.forEach((o,n)=>{let r=eJ("blocos[".concat(t,"].itens[").concat(n,"].resposta"));(null==o?void 0:o.obrigatorio)!==1||r||(e0("blocos[".concat(t,"].itens[").concat(n,"].resposta"),{type:"manual",message:"Campo obrigat\xe1rio"}),a.push(null==o?void 0:o.nome),e=!0),o.respostaConfig&&1==o.respostaConfig.anexo&&o.respostaConfig.anexosSolicitados.length>0&&o.respostaConfig.anexosSolicitados.forEach((r,s)=>{1==r.obrigatorio&&r.anexos&&0==r.anexos.length&&(e0("blocos[".concat(t,"].itens[").concat(n,"].respostaConfig.anexosSolicitados[").concat(s,"].anexos"),{type:"manual",message:"Campo obrigat\xe1rio"}),a.push("Anexo: ".concat(null==o?void 0:o.nome," / ").concat(null==r?void 0:r.nome)),e=!0)})})}),es&&es.length>0&&es.forEach((o,t)=>{o.itens.forEach((n,r)=>{1===n.obrigatorio&&0==n.anexos.length&&(e0("grupoAnexo[".concat(t,"].itens[").concat(r,"].anexos"),{type:"manual",message:"Campo obrigat\xe1rio"}),a.push("Anexo: ".concat(null==o?void 0:o.nome," / ").concat(null==n?void 0:n.nome)),e=!0)})}),eN({status:e,errors:a})},an=async e=>{if(9===e.length){let a=e.replace(/[^0-9]/g,"");try{let o=await r.h.get("https://viacep.com.br/ws/".concat(a,"/json/"));o.data.localidade?(ev.forEach(async(e,a)=>{("logradouro"===e.nomeColuna||"bairro"===e.nomeColuna||"cidade"===e.nomeColuna||"estado"===e.nomeColuna)&&(await eW("fields[".concat(a,"].logradouro"),o.data.logradouro),await eW("fields[".concat(a,"].bairro"),o.data.bairro),await eW("fields[".concat(a,"].cidade"),o.data.localidade),await eW("fields[".concat(a,"].estado"),o.data.uf))}),w.ZP.success("Endere\xe7o encontrado!")):w.ZP.error("Endere\xe7o n\xe3o encontrado!")}catch(t){console.error(t)}}},ar=()=>{at(),eE(!0),K(!0)},as=e=>{let a=!0;e.forEach(e=>{e.itens.forEach(e=>{e.respostaConfig&&1==e.respostaConfig.bloqueiaFormulario&&(a=!1)})}),ea(a)},al=async e=>{e.conclusion=!0,await eY(ad)(e)},ai=(e,a,o)=>{let t=30==e?"Em preenchimento":40==e?"Conclu\xeddo":50==e?"Reprovado":60==e?"Aprovado parcialmente":70==e?"Aprovado":"Pendente",n={titulo:"Formul\xe1rio de Fornecedor ".concat(t),descricao:"O formul\xe1rio de Fornecedor #".concat(s," est\xe1 ").concat(t,"."),url:"/formularios/fornecedor/",urlID:s,tipoNotificacaoID:6,usuarioGeradorID:N.usuarioID,usuarioID:0,unidadeID:k.unidadeID,papelID:1};if(n&&(ec(n),a)){let r={titulo:"Fornecedor gerado",descricao:"O formul\xe1rio de Fornecedor #".concat(s," est\xe1 ").concat(t," e gerou uma n\xe3o conformidade."),url:"/formularios/fornecedor/nao-conformidade/",urlID:o,tipoNotificacaoID:5,usuarioGeradorID:N.usuarioID,usuarioID:0,unidadeID:k.unidadeID,papelID:1};ec(r)}};console.log("\uD83D\uDE80 ~ isLoadingaaaaaaaaaaaaaaaaaaa:",z);let ad=async function(e){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];console.log("\uD83D\uDE80 ~ param:",a),eG(),console.log("fun\xe7\xe3o ativada inicio"),!0===a.conclusion&&(e.status=N&&1==N.papelID?a.status:40,e.obsConclusao=a.obsConclusao);let o={form:e,auth:{usuarioID:N.usuarioID,papelID:N.papelID,unidadeID:k.unidadeID}};console.log("\uD83D\uDE80 ~ data:",o);try{"edit"==eL?(W(!0),await r.h.post("".concat(eB,"/updateData/").concat(s),o).then(a=>{w.ZP.success(Z.OD.successUpdate),W(!1);let o=null;a.data&&a.data.naoConformidade&&a.data.id>0&&(eV.push("/formularios/fornecedor/nao-conformidade/"),ez(a.data.id),o=a.data.id),ai(e.status,e.naoConformidade,o)})):"new"==eL?await r.h.post("".concat((0,Z.g_)(eB),"/insertData"),o).then(e=>{eV.push("".concat((0,Z.g_)(eB))),ez(e.data),w.ZP.success(Z.OD.successNew)}):w.ZP.error(Z.OD.error)}catch(t){console.log(t)}finally{eT(),console.log("fun\xe7\xe3o ativada fim finally")}},ac=async(e,a)=>{L(!0);let o=e.target.files;if(o&&o.length>0){var t;let n=new FormData;for(let l=0;l<o.length;l++)n.append("files[]",o[l]);n.append("usuarioID",N.usuarioID),n.append("unidadeID",k.unidadeID),n.append("produtoAnexoID",null!==(t=a.produtoAnexoID)&&void 0!==t?t:null),await r.h.post("".concat(eB,"/saveAnexo/").concat(s,"/produto/").concat(N.usuarioID,"/").concat(eo.unidadeID),n).then(e=>{L(!1);let a=eJ();ad(a)}).catch(e=>{var a,o,t;L(!1),w.ZP.error(null!==(t=null===(a=e.response)||void 0===a?void 0:null===(o=a.data)||void 0===o?void 0:o.message)&&void 0!==t?t:"Erro ao atualizar anexo, tente novamente!")})}},au=async(e,a)=>{q(!0);let o=e.target.files;if(o&&o.length>0){var t;let n=new FormData;for(let l=0;l<o.length;l++)n.append("files[]",o[l]);n.append("usuarioID",N.usuarioID),n.append("unidadeID",k.unidadeID),n.append("grupoAnexoItemID",null!==(t=a.grupoAnexoItemID)&&void 0!==t?t:null),await r.h.post("".concat(eB,"/saveAnexo/").concat(s,"/grupo-anexo/").concat(N.usuarioID,"/").concat(eo.unidadeID),n).then(e=>{q(!1);let a=eJ();ad(a)}).catch(e=>{var a,o,t;q(!1),w.ZP.error(null!==(t=null===(a=e.response)||void 0===a?void 0:null===(o=a.data)||void 0===o?void 0:o.message)&&void 0!==t?t:"Erro ao atualizar anexo, tente novamente!")})}},am=async(e,a)=>{X(!0);let o=e.target.files;if(o&&o.length>0){var t,n;let l=new FormData;for(let i=0;i<o.length;i++)l.append("files[]",o[i]);l.append("usuarioID",N.usuarioID),l.append("unidadeID",k.unidadeID),l.append("parFornecedorModeloBlocoID",null!==(t=a.parFornecedorModeloBlocoID)&&void 0!==t?t:null),l.append("itemOpcaoAnexoID",null!==(n=a.itemOpcaoAnexoID)&&void 0!==n?n:null),await r.h.post("".concat(eB,"/saveAnexo/").concat(s,"/item/").concat(N.usuarioID,"/").concat(eo.unidadeID),l).then(e=>{X(!1);let a=eJ();ad(a)}).catch(e=>{var a,o,t;X(!1),w.ZP.error(null!==(t=null===(a=e.response)||void 0===a?void 0:null===(o=a.data)||void 0===o?void 0:o.message)&&void 0!==t?t:"Erro ao atualizar anexo, tente novamente!!!!")})}},ap=async e=>{try{let a=await r.h.post("/cadastros/item/getItemConfigs",{itemID:e.itemID,alternativaItemID:e.alternativa.id}),o=eb.map(o=>({...o,itens:o.itens.map(o=>o.itemID==e.itemID?{...o,respostaConfig:{...a.data}}:o)}));ej(o)}catch(t){console.log("error",t)}},ax=async e=>{e&&await r.h.delete("".concat(eB,"/deleteAnexo/").concat(s,"/").concat(e.anexoID,"/").concat(eo.unidadeID,"/").concat(N.usuarioID,"/produto")).then(e=>{let a=eJ();ad(a)}).catch(e=>{var a,o,t;w.ZP.error(null!==(t=null===(a=e.response)||void 0===a?void 0:null===(o=a.data)||void 0===o?void 0:o.message)&&void 0!==t?t:"Erro ao remover anexo, tente novamente!")})},af=async e=>{e&&await r.h.delete("".concat(eB,"/deleteAnexo/").concat(s,"/").concat(e.anexoID,"/").concat(eo.unidadeID,"/").concat(N.usuarioID,"/grupo-anexo")).then(e=>{let a=eJ();ad(a)}).catch(e=>{var a,o,t;w.ZP.error(null!==(t=null===(a=e.response)||void 0===a?void 0:null===(o=a.data)||void 0===o?void 0:o.message)&&void 0!==t?t:"Erro ao remover anexo, tente novamente!")})},ah=async e=>{e&&await r.h.delete("".concat(eB,"/deleteAnexo/").concat(s,"/").concat(e.anexoID,"/").concat(eo.unidadeID,"/").concat(N.usuarioID,"/item")).then(e=>{let a=eJ();ad(a)}).catch(e=>{var a,o,t;w.ZP.error(null!==(t=null===(a=e.response)||void 0===a?void 0:null===(o=a.data)||void 0===o?void 0:o.message)&&void 0!==t?t:"Erro ao remover anexo, tente novamente!")})};return(0,n.useEffect)(()=>{"edit"==eL&&ao()},[s,J]),(0,n.useEffect)(()=>{at()},[]),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(E.Z,{show:z}),(0,t.jsxs)("form",{onSubmit:eY(ad),children:[eM&&eM.length>0&&(0,t.jsxs)(x.Z,{severity:"info",sx:{mb:2},children:[(0,t.jsxs)("h1",{children:["Os seguintes campos foram copiados de ",(0,t.jsx)("strong",{children:"Meus Dados"}),":"]}),(0,t.jsx)("div",{className:"pt-2",children:eM.map(e=>(0,t.jsx)("div",{className:"flex opacity-80",children:(0,t.jsx)("p",{children:"- ".concat(e.name," (").concat(e.value,")")})}))})]}),(0,t.jsxs)(f.Z,{display:"flex",flexDirection:"column",sx:{gap:4},children:[eq.message&&(0,t.jsx)(x.Z,{severity:"warning",children:eq.message}),eZ&&(0,t.jsxs)(x.Z,{severity:"info",children:["\xdaltima movimenta\xe7\xe3o: Profissional ".concat(eZ.nome," do(a) ").concat(eZ.nomeFantasia," movimentou o formul\xe1rio de ").concat(eZ.statusAnterior," para ").concat(eZ.statusAtual," em ").concat(eZ.dataHora,"."),eZ.observacao&&(0,t.jsxs)("p",{children:[(0,t.jsx)("br",{}),'Mensagem: "',eZ.observacao,'"']})]}),eC&&""!=eC.cabecalhoModelo&&(0,t.jsx)(h.Z,{children:(0,t.jsx)(v.Z,{children:(0,t.jsx)(D.Z,{variant:"subtitle1",sx:{mb:2},children:eC.cabecalhoModelo})})}),(0,t.jsxs)(h.Z,{children:[(0,t.jsx)(y.Z,{btnCancel:!0,btnDelete:eC.status<40,onclickDelete:()=>e_(!0),btnSave:eq.status,btnSend:eq.status||1==N.papelID&&eC.status>=40,btnPrint:"edit"==eL,actionsData:ae,actions:!0,handleSubmit:()=>eY(ad),handleSend:ar,iconConclusion:"mdi:check-bold",titleConclusion:"Concluir Formul\xe1rio",title:"Fornecedor",btnStatus:"edit"==eL,handleBtnStatus:()=>em(!0),type:eL,status:ei}),(0,t.jsx)(T.Z,{title:"Excluir Formul\xe1rio",description:"Tem certeza que deseja exluir o formulario?",params:{route:"formularios/fornecedor/delete/".concat(s),messageSucceded:"Formul\xe1rio exclu\xeddo com sucesso!",MessageError:"Dado possui pend\xeancia!"},open:eO,handleClose:()=>e_(!1)}),(0,t.jsx)(v.Z,{children:eo&&(0,t.jsxs)(f.Z,{display:"flex",flexDirection:"column",sx:{gap:1},children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,t.jsx)(D.Z,{variant:"caption",children:"Aberto por ".concat(ep.abertoPor.profissional.nome," em ").concat(ep.abertoPor.dataInicio," ").concat(ep.abertoPor.horaInicio," ")}),(0,t.jsx)(u.Z,{size:"small",skin:"light",color:"primary",label:(1==eo.quemPreenche?"F\xe1brica":"Fornecedor")+" preenche"})]}),(0,t.jsx)(B,{modeloID:eo.parFornecedorModeloID,values:ep,fields:ev,disabled:!eq.status||Y,register:eX,errors:e1,setValue:eW,control:eQ,getAddressByCep:an})]})})]}),eo&&(null==eo?void 0:eo.obrigatorioProdutoFornecedor)&&en&&en.length>0&&(0,t.jsx)(h.Z,{children:(0,t.jsx)(v.Z,{children:(0,t.jsx)(R,{values:en,handleFileSelect:ac,handleRemove:ax,loadingFile:V,disabled:!eq.status||Y,errors:null==e1?void 0:e1.produtos},V)})}),eb&&eb.map((e,a)=>(0,t.jsx)(d.Z,{index:a,blockKey:"parFornecedorModeloBlocoID",handleFileSelect:am,setItemResposta:ap,handleRemoveAnexoItem:ah,setBlocos:ej,values:e,control:eQ,register:eX,setValue:eW,errors:null==e1?void 0:e1.blocos,disabled:!eq.status||Y},a)),es&&es.map((e,a)=>(0,t.jsx)(p.Z,{values:{grupo:e,loadingFile:_,indexGrupo:a,handleFileSelect:au,handleRemove:af,folder:"grupo-anexo",disabled:!eq.status,error:e1}},a)),eC&&(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(h.Z,{children:(0,t.jsx)(v.Z,{children:(0,t.jsx)(g.ZP,{container:!0,spacing:4,children:(0,t.jsx)(g.ZP,{item:!0,xs:12,md:12,children:(0,t.jsxs)(I.Z,{fullWidth:!0,children:[(0,t.jsx)(D.Z,{variant:"subtitle1",sx:{fontWeight:600,mb:2},children:"Observa\xe7\xf5es (campo de uso exclusivo da validadora)"}),(0,t.jsx)(m.Z,{title:"Observa\xe7\xe3o (opcional)",name:"info.obs",multiline:!0,rows:4,value:eC.obs,disabled:!eq.status||Y,control:eQ})]})})})})})}),ef&&ef.concluded&&(0,t.jsx)(D.Z,{variant:"caption",children:"Conclu\xeddo por ".concat(ef.profissionalAprova.nome," em ").concat(ef.dataFim," ").concat(ef.horaFim,".")}),eu&&(0,t.jsx)(c.Z,{title:"Hist\xf3rico do Formul\xe1rio",text:"Listagem do hist\xf3rico das movimenta\xe7\xf5es do formul\xe1rio ".concat(s," do Fornecedor."),id:s,parFormularioID:1,formStatus:eC.status,hasFormPending:Y,canChangeStatus:!Y&&2==eo.quemPreenche&&eC.status>=40,openModal:eu,handleClose:()=>em(!1),btnCancel:!0,btnConfirm:!0,handleSubmit:e3}),(0,t.jsx)(A.Z,{openModal:eS,handleClose(){eE(!1),K(!1)},title:"Concluir Formul\xe1rio",text:"Deseja realmente concluir este formul\xe1rio?",info:eC,canChange:!Y,register:eX,setValue:eW,getValues:eJ,btnCancel:!0,btnConfirm:!0,btnConfirmColor:"primary",conclusionForm:al,listErrors:eA,canApprove:ee})]})]})]})};var X=o(60565),J=o(72819);let W=e=>{let{values:a}=e;return(0,t.jsxs)(f.Z,{display:"flex",flexDirection:"column",sx:{gap:4},children:[(0,t.jsxs)(D.Z,{variant:"body2",children:[(0,t.jsx)("strong",{children:"E-mail enviado para: "})," ",null==a?void 0:a.email]}),(0,t.jsxs)(D.Z,{variant:"body2",children:[(0,t.jsx)("strong",{children:"Link do formul\xe1rio: "})," ",null==a?void 0:a.link]})]})},Q=()=>{let{user:e,loggedUnity:a}=(0,n.useContext)(F.V),[o,l]=(0,n.useState)(null),i=(0,b.useRouter)(),d=i.pathname,{setTitle:c}=(0,n.useContext)(X.f),{id:u,setId:m}=(0,n.useContext)(C.X),[p,x]=(0,n.useState)(!1),[f,h]=(0,n.useState)(!1),[v,D]=(0,n.useState)(null),[g,I]=(0,n.useState)(!0),j=()=>{x(!0)},y=async()=>{console.log("\uD83D\uDE80 ~ user.cnpj:",e.cnpj),await r.h.post("".concat(d,"/getList/"),{unidadeID:a.unidadeID,papelID:e.papelID,cnpj:e.cnpj?e.cnpj:null}).then(e=>{l(e.data),c({title:"Fornecedor",subtitle:{id:u,count:e.data.length,new:!1}})})},S=async o=>{try{let t=await r.h.post("/formularios/fornecedor/makeFornecedor",{usuarioID:e.usuarioID,papelID:e.papelID,unidadeID:a.unidadeID,values:o.fields,habilitaQuemPreencheFormFornecedor:o.habilitaQuemPreencheFormFornecedor});200==t.status&&(w.ZP.success(t.data.message),g?(h(!0),D(t.data.result)):m(t.data.fornecedorID))}catch(n){console.error(n),console.error("Erro ao enviar email",n)}},P=()=>{let e=null==v?void 0:v.link;e&&(navigator.clipboard.writeText(e),w.ZP.success("Link copiado com sucesso!"))};(0,n.useEffect)(()=>{y()},[u]),(0,n.useEffect)(()=>{i.query.f&&m(i.query.f)},[i.query]);let A=1==e.papelID?[{headerName:"ID",field:"id",size:1},{headerName:"Fornecedor",field:"fornecedor",size:1},{headerName:"CNPJ",field:"cnpj",size:1},{headerName:"Data da Avalia\xe7\xe3o",field:"data",size:1,type:"date"},{headerName:"Cidade",field:"cidade",size:1},{headerName:"Quem preenche",field:"quemPreenche",size:1},{headerName:"Status",field:{name:"status",cor:"cor"},size:1}]:2==e.papelID?[{headerName:"ID",field:"id",size:1},{headerName:"F\xe1brica",field:"fabrica",size:1},{headerName:"CNPJ",field:"cnpj",size:1},{headerName:"Data da Avalia\xe7\xe3o",field:"data",size:1,type:"date"},{headerName:"Cidade",field:"cidade",size:1},{headerName:"Respons\xe1vel",field:"responsavel",size:1},{headerName:"Status",field:{name:"status",cor:"cor"},size:1}]:[],N=(0,Z.OL)(d,A);return(0,t.jsxs)(t.Fragment,{children:[o?u&&u>0?(0,t.jsx)(U,{id:u,makeFornecedor:S}):(0,t.jsx)(s.Z,{result:o,columns:N,openModal:1==e.papelID?j:null,btnNew:1==e.papelID}):(0,t.jsx)(E.Z,{show:!0}),(0,t.jsx)(J.Z,{title:"Habilitar Fornecedor",description:"Habilitar novo preenchimento de formul\xe1rio pro fornecedor",handleConclusion:S,setOpenModal:x,openModal:p,size:"lg",children:(0,t.jsx)(O.Z,{isNotFactory:g,setIsNotFactory:I})}),(0,t.jsx)(J.Z,{title:"Formul\xe1rio enviado ao fornecedor",description:"Um novo formul\xe1rio de qualifica\xe7\xe3o de fornecedor foi enviado",handleCopyLink:P,setOpenModal:h,openModal:f,children:(0,t.jsx)(W,{values:v})})]})};var K=Q}},function(e){e.O(0,[5131,1515,7842,9525,8934,5815,9152,9774,2888,179],function(){return e(e.s=59424)}),_N_E=e.O()}]);