"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5462],{55462:function(e,a,t){var o=t(85893),s=t(67294),n=t(87536),i=t(56531),r=t(79139),c=t(34282),l=t(96351),u=t(29308),d=t(19604),m=t(49837),p=t(91359),x=t(79072),f=t(55343),h=t(29630),D=t(11163),b=t.n(D),g=t(46749),I=t(60664),v=t(36188);t(60565);var C=t(83830),S=t(40039),j=t(39976),Z=t(47842),y=t(86501),P=t(66136),w=t(80377);let M=e=>{let{id:a}=e,{user:t,loggedUnity:D}=(0,s.useContext)(S.V),[M,R]=(0,s.useState)(!1),[E,F]=(0,s.useState)(!1),[O,_]=(0,s.useState)(!1),[k,N]=(0,s.useState)(!0),[V,T]=(0,s.useState)(null),{createNewNotification:A}=(0,s.useContext)(j.u),[W,z]=(0,s.useState)(!1),[B,G]=(0,s.useState)([]),[U,H]=(0,s.useState)(null),[J,K]=(0,s.useState)([]),[L,X]=(0,s.useState)(""),[q,Q]=(0,s.useState)(!1),[Y,$]=(0,s.useState)({status:!1,errors:[]}),{settings:ee}=(0,s.useContext)(P.J6),{setId:ea}=(0,s.useContext)(C.X),[et,eo]=(0,s.useState)({status:!1,message:"Voc\xea n\xe3o tem permiss\xf5es",messageType:"info"}),es=b(),en=a&&a>0?"edit":"new",ei=es.pathname,{reset:er,register:ec,getValues:el,setValue:eu,control:ed,watch:em,handleSubmit:ep,clearErrors:ex,setError:ef,formState:{errors:eh}}=(0,n.cI)(),eD=async e=>{let o={status:e,auth:{usuarioID:t.usuarioID,papelID:t.papelID,unidadeID:D.unidadeID}};try{F(!0),await I.h.post("".concat(ei,"/changeFormStatus/").concat(a),o).then(a=>{y.ZP.success(g.OD.successUpdate),F(!1),eZ(e,null,null)})}catch(s){console.log(s)}},eb=[{id:1,name:"Dados do Recebimento de MP",component:(0,o.jsx)(l.Z,{params:{id:a,unidadeID:1}}),route:"/relatorio/recebimentoMp/dadosRecebimentoMp",papelID:t.papelID,identification:"01",params:{fornecedorID:a}},{id:2,name:"Declara\xe7\xe3o de prolifici\xeancia",component:(0,o.jsx)(l.Z,{params:{id:a,unidadeID:1}}),route:"/relatorio/recebimentoMp/dadosRecebimentoMp",papelID:t.papelID,identification:"02",params:{fornecedorID:a}}],eg=async()=>{try{await I.h.post("".concat(ei,"/verifyFormPending/").concat(a),{parFormularioID:4}).then(e=>{N(e.data) //! true/false
})}catch(e){console.log(e)}},eI=()=>{try{R(!0),I.h.post("".concat((0,g.g_)(ei),"/new/getData"),{unidadeID:D.unidadeID}).then(e=>{console.log("getNewData: ",e.data),G(e.data.fields),K(e.data.blocos),X(e.data.info),er(e.data),eo({status:!0,message:'Esse formul\xe1rio j\xe1 foi conclu\xeddo! Para alter\xe1-lo \xe9 necess\xe1rio atualizar seu Status para "Em preenchimento" atrav\xe9s do bot\xe3o "Status"!',messageType:"info"}),R(!1)})}catch(e){console.log("\uD83D\uDE80 ~ error:",e)}},ev=()=>{R(!0),a&&I.h.post("".concat(ei,"/getData/").concat(a),{type:en,unidadeID:D.unidadeID}).then(e=>{var a,t,o,s;console.log("getData: ",e.data),G(e.data.fields),K(e.data.blocos),X(e.data.info),er(e.data),T(g.WR[null==e?void 0:null===(a=e.data)||void 0===a?void 0:null===(t=a.info)||void 0===t?void 0:t.status]),eo({status:(null==e?void 0:null===(o=e.data)||void 0===o?void 0:null===(s=o.info)||void 0===s?void 0:s.status)<40,message:'Esse formul\xe1rio j\xe1 foi conclu\xeddo! Para alter\xe1-lo \xe9 necess\xe1rio atualizar seu Status para "Em preenchimento" atrav\xe9s do bot\xe3o "Status"!',messageType:"info"}),eg(),R(!1)})},eC=()=>{ex();let e=!1,a=[];null==B||B.forEach((t,o)=>{let s=t.tabela?"fields[".concat(o,"].").concat(t.tabela):"fields[".concat(o,"].").concat(t.nomeColuna),n=el(s);1!==t.obrigatorio||n||(ef(s,{type:"manual",message:"Campo obrigat\xf3rio"}),a.push(null==t?void 0:t.nomeCampo),e=!0)}),J.forEach((t,o)=>{t.itens.forEach((t,s)=>{let n=el("blocos[".concat(o,"].itens[").concat(s,"].resposta"));(null==t?void 0:t.obrigatorio)!==1||n||(ef("blocos[".concat(o,"].itens[").concat(s,"].resposta"),{type:"manual",message:"Campo obrigat\xe1rio"}),a.push(null==t?void 0:t.nome),e=!0)})}),$({status:e,errors:a})},eS=()=>{eC(),Q(!0),_(!0)},ej=async e=>{e.conclusion=!0,await ep(ey)(e)},eZ=(e,o,s)=>{let n=30==e?"Em preenchimento":40==e?"Conclu\xeddo":50==e?"Reprovado":60==e?"Aprovado parcialmente":70==e?"Aprovado":"Pendente",i={titulo:"Formul\xe1rio de Recebimento de MP ".concat(n),descricao:"O formul\xe1rio de Recebimento de MP #".concat(a," est\xe1 ").concat(n,"."),url:"/formularios/recebimento-mp/",urlID:a,tipoNotificacaoID:4,usuarioGeradorID:t.usuarioID,usuarioID:0,unidadeID:D.unidadeID,papelID:1};if(i&&(A(i),o)){let r={titulo:"Recebimento de MP gerado",descricao:"O formul\xe1rio de Recebimento de MP #".concat(a," est\xe1 ").concat(n," e gerou uma n\xe3o conformidade."),url:"/formularios/recebimento-mp/nao-conformidade/",urlID:s,tipoNotificacaoID:5,usuarioGeradorID:t.usuarioID,usuarioID:0,unidadeID:D.unidadeID,papelID:1};A(r)}},ey=async function(e){let o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];!0===o.conclusion&&o.status>10&&(e.status=o.status,e.obsConclusao=o.obsConclusao);let s={form:e,auth:{usuarioID:t.usuarioID,papelID:t.papelID,unidadeID:D.unidadeID}};try{"edit"==en?(F(!0),await I.h.post("".concat(ei,"/updateData/").concat(a),s).then(a=>{y.ZP.success(g.OD.successUpdate),F(!1);let t=null;a.data&&a.data.naoConformidade&&a.data.id>0&&(es.push("/formularios/recebimento-mp/nao-conformidade/"),ea(a.data.id),t=a.data.id),eZ(e.status,e.naoConformidade,t)})):"new"==en?await I.h.post("".concat((0,g.g_)(ei),"/insertData"),s).then(e=>{es.push("".concat((0,g.g_)(ei))),ea(e.data),y.ZP.success(g.OD.successNew)}):y.ZP.error(g.OD.error)}catch(n){console.log(n)}};return(0,s.useEffect)(()=>{"new"==en?eI():ev()},[a,E]),(0,s.useEffect)(()=>{eC()},[]),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Z.Z,{show:M}),(0,o.jsxs)("form",{onSubmit:ep(ey),children:[!et.status&&(0,o.jsx)(d.Z,{severity:et.messageType,sx:{mb:2},children:et.message}),(0,o.jsxs)(m.Z,{children:[(0,o.jsx)(v.Z,{btnCancel:!0,btnSave:(null==L?void 0:L.status)<40||"new"==en,btnSend:"edit"==en&&(null==L?void 0:L.status)<50,btnPrint:"edit"==en,generateReport:g.generateReport,actionsData:eb,actions:!0,handleSubmit:()=>ep(ey),handleSend:eS,iconConclusion:"mdi:check-bold",titleConclusion:"Aprovar Recebimento de MP",title:"Recebimento de MP",btnStatus:"edit"==en,handleBtnStatus:()=>z(!0),type:en,status:V}),(0,o.jsx)(p.Z,{children:(0,o.jsx)(i.Z,{register:ec,errors:eh,setValue:eu,control:ed,fields:B,values:B,disabled:!et.status})})]}),J&&J.map((e,a)=>(0,o.jsx)(r.Z,{index:a,blockKey:"parRecebimentoMpModeloBlocoID",values:e,control:ed,register:ec,setValue:eu,errors:eh,disabled:!et.status},a)),L&&(0,o.jsx)(o.Fragment,{children:(0,o.jsx)(m.Z,{sx:{mt:4},children:(0,o.jsx)(p.Z,{children:(0,o.jsx)(x.ZP,{container:!0,spacing:4,children:(0,o.jsx)(x.ZP,{item:!0,xs:12,md:12,children:(0,o.jsxs)(f.Z,{fullWidth:!0,children:[(0,o.jsx)(h.Z,{variant:"subtitle1",sx:{fontWeight:600,mb:2},children:"Observa\xe7\xf5es (campo de uso exclusivo da validadora)"}),(0,o.jsx)(u.Z,{title:"Observa\xe7\xe3o (opcional)",name:"info.obs",multiline:!0,rows:4,value:L.obs,disabled:!et.status,control:ed})]})})})})})}),W&&(0,o.jsx)(c.Z,{id:a,parFormularioID:2,formStatus:L.status,hasFormPending:k,canChangeStatus:L.status>30&&!k,openModal:W,handleClose:()=>z(!1),title:"Hist\xf3rico do Formul\xe1rio",text:"Listagem do hist\xf3rico das movimenta\xe7\xf5es do formul\xe1rio ".concat(a," de Recebimento de MP."),btnCancel:!0,btnConfirm:!0,handleSubmit:eD}),(0,o.jsx)(w.Z,{openModal:q,handleClose(){Q(!1),_(!1)},title:"Concluir Formul\xe1rio",text:"Deseja realmente concluir este formul\xe1rio?",info:L,canChange:!k,register:ec,setValue:eu,getValues:el,btnCancel:!0,btnConfirm:!0,btnConfirmColor:"primary",conclusionForm:ej,listErrors:Y})]})]})};a.Z=M}}]);