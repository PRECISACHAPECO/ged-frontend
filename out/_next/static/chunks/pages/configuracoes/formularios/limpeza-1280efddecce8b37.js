(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5596],{29295:function(e,o,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/configuracoes/formularios/limpeza",function(){return t(67013)}])},67013:function(e,o,t){"use strict";t.r(o),t.d(o,{default:function(){return _}});var i=t(85893),s=t(67294),n=t(60664),l=t(93250),r=t(60565),d=t(83830),a=t(87536),c=t(49837),m=t(91359),u=t(79072),v=t(85214),x=t(29630),h=t(75084),p=t(11163),b=t.n(p),j=t(46749),Z=t(36188),g=t(40039),f=t(86501),k=t(47842),S=t(21609);t(1948);var I=t(84220),P=t(29308),C=t(67569),D=t(3893),N=t(88475);t(53934);let w=e=>{var o;let{blocks:t,errors:s,control:n,register:l,getValues:r,removeItem:d,addItem:a,removeBlock:v,setValue:p,allOptions:b,openModalConfirmScore:j,setOpenModalConfirmScore:Z,itemScore:g,setItemScore:f}=e;return r("blocks")&&t&&r("blocks").map((e,b)=>{var k,D,w,E,O,_,y,B;return(0,i.jsx)(c.Z,{md:12,sx:{mt:4},children:(0,i.jsxs)(m.Z,{children:[(0,i.jsxs)(u.ZP,{container:!0,spacing:4,children:[(0,i.jsx)(P.Z,{className:"order-1",xs:10,md:1,title:"Sequ\xeancia",name:"blocks.[".concat(b,"].dados.ordem"),value:e.dados.ordem,required:!0,control:n,errors:null==s?void 0:null===(k=s.blocks)||void 0===k?void 0:null===(D=k[b])||void 0===D?void 0:null===(w=D.dados)||void 0===w?void 0:w.ordem}),(0,i.jsx)(P.Z,{className:"order-3 md:order-2",xs:10,md:9,title:"Nome do Bloco",name:"blocks.[".concat(b,"].dados.nome"),value:e.dados.nome,required:!0,control:n,errors:null==s?void 0:null===(E=s.blocks)||void 0===E?void 0:null===(O=E[b])||void 0===O?void 0:null===(_=O.dados)||void 0===_?void 0:_.nome}),(0,i.jsx)(C.Z,{className:"order-2 md:order-3",xs:2,md:1,title:"Ativo",name:"blocks.[".concat(b,"].dados.status"),value:null===(y=t[b])||void 0===y?void 0:y.dados.status,register:l}),(0,i.jsx)(C.Z,{className:"order-4 ",xs:2,md:1,title:"Observa\xe7\xe3o",name:"blocks.[".concat(b,"].dados.obs"),value:null===(B=t[b])||void 0===B?void 0:B.dados.obs,register:l})]}),(0,i.jsx)(x.Z,{variant:"subtitle1",sx:{fontWeight:600,mt:4},children:"Itens"}),r("blocks")&&e.itens&&e.itens.map((e,r)=>{var a,c,m,v,x,h,j,Z,g,f,k,S,D,w,E,O,_,y,B,q,M,R;return(0,i.jsxs)(u.ZP,{id:"item-".concat(b,"-").concat(r),container:!0,spacing:2,sx:{my:1},children:[(0,i.jsx)(P.Z,{xs:12,md:1,title:"Sequ\xeancia",name:"blocks.[".concat(b,"].itens.[").concat(r,"].ordem"),value:e.ordem,required:!0,control:n,errors:null==s?void 0:null===(a=s.blocks)||void 0===a?void 0:null===(c=a[b])||void 0===c?void 0:null===(m=c.itens)||void 0===m?void 0:null===(v=m[r])||void 0===v?void 0:v.ordem}),(0,i.jsx)(I.Z,{xs:12,md:7,title:(null===(h=null===(x=t[b])||void 0===x?void 0:x.itens[r])||void 0===h?void 0:h.itemID)?"Item [".concat(null===(Z=null===(j=t[b])||void 0===j?void 0:j.itens[r])||void 0===Z?void 0:Z.itemID,"]"):"Item",name:"blocks.[".concat(b,"].itens.[").concat(r,"].item"),value:null!==(o=null===(f=null===(g=t[b])||void 0===g?void 0:g.itens[r])||void 0===f?void 0:f.item)&&void 0!==o?o:null,required:!0,disabled:1==e.hasPending,options:null===(k=t[b])||void 0===k?void 0:null===(S=k.optionsBlock)||void 0===S?void 0:S.itens,register:l,setValue:p,control:n,errors:null==s?void 0:null===(D=s.blocks)||void 0===D?void 0:null===(w=D[b])||void 0===w?void 0:null===(E=w.itens)||void 0===E?void 0:null===(O=E[r])||void 0===O?void 0:O.item}),(0,i.jsx)(C.Z,{xs:2,md:1,title:"Ativo",index:r,name:"blocks.[".concat(b,"].itens.[").concat(r,"].status"),value:null===(y=null===(_=t[b])||void 0===_?void 0:_.itens[r])||void 0===y?void 0:y.status,register:l}),(0,i.jsx)(C.Z,{xs:2,md:1,title:"Obs",index:r,name:"blocks.[".concat(b,"].itens.[").concat(r,"].obs"),value:null===(q=null===(B=t[b])||void 0===B?void 0:B.itens[r])||void 0===q?void 0:q.obs,register:l}),(0,i.jsx)(C.Z,{xs:2,md:1,title:"Obrigat\xf3rio",index:r,name:"blocks.[".concat(b,"].itens.[").concat(r,"].obrigatorio"),value:null===(R=null===(M=t[b])||void 0===M?void 0:M.itens[r])||void 0===R?void 0:R.obrigatorio,register:l}),(0,i.jsx)(N.Z,{xs:2,md:1,title:0==r?"Remover":"",index:b,removeItem:()=>d(e,b,r),item:e,pending:e.hasPending,textSuccess:"Remover este item",textError:"Este item n\xe3o pode mais ser removido pois j\xe1 foi respondido em um formul\xe1rio"})]},r)}),j&&g&&(0,i.jsx)(DialogConfirmScore,{openModal:j,setOpenModalConfirmScore:Z,itemScore:g,setItemScore:f}),(0,i.jsx)(u.ZP,{container:!0,spacing:4,sx:{mt:4},children:(0,i.jsxs)(u.ZP,{item:!0,xs:12,md:12,children:[(0,i.jsx)(h.Z,{variant:"outlined",color:"primary",startIcon:(0,i.jsx)(S.Z,{icon:"material-symbols:add-circle-outline-rounded"}),onClick(){a(b)},children:"Inserir Item"}),(0,i.jsx)(h.Z,{variant:"outlined",color:"error",startIcon:(0,i.jsx)(S.Z,{icon:"tabler:trash-filled"}),onClick(){v(e,b)},sx:{ml:2},children:"Remover Bloco"})]})})]})},b)})},E=e=>{var o,t;let{id:l}=e,{user:r,loggedUnity:d}=(0,s.useContext)(g.V),[p,I]=(0,s.useState)(),[N,E]=(0,s.useState)(),[O,_]=(0,s.useState)(null),[y,B]=(0,s.useState)(),[q,M]=(0,s.useState)(),[R,F]=(0,s.useState)(!1),[V,z]=(0,s.useState)(),[L,W]=(0,s.useState)(!1),[A,T]=(0,s.useState)([]),[X,U]=(0,s.useState)([]),[G,H]=(0,s.useState)(!1),J=b(),K=J.pathname,{setValue:Q,register:Y,handleSubmit:$,reset:ee,getValues:eo,control:et,formState:{errors:ei}}=(0,a.cI)(),es=async e=>{let o={id:l,unidadeID:d.unidadeID,model:e.model,header:e.header,blocks:e.blocks,arrRemovedBlocks:X,arrRemovedItems:A,orientacoes:e.orientations};E(null);try{await n.h.put("".concat(K,"/updateData"),o).then(e=>{f.ZP.success(j.OD.successUpdate),W(!L)})}catch(t){console.log(t)}},en=(e,o,t,i)=>{let s=i.itens;s=s.filter(o=>{let t=e.itens.some(e=>e.item&&o.id===e.item.id);return!t});let n=[...t];n[o].optionsBlock.itens=s,B(n)},el=e=>{var o;let t=[...y];t[e].itens.push({ordem:(null===(o=t[e].itens)||void 0===o?void 0:o.length)+1,obs:1,status:1,obrigatorio:1}),B(t),Q("blocks.[".concat(e,"].itens.[").concat(t[e].itens.length-1,"].new"),!0),en(t[e],e,y,O)},er=(e,o,t)=>{if(1===y[o].itens.length){f.ZP.error("Voc\xea deve ter ao menos um item!");return}let i=[...A];i.push(e),T(i);let s=[...eo("blocks")];s[o].itens.splice(t,1),Q("blocks",s),B(s),en(y[o],o,y,O),H(!G)},ed=(e,o)=>{let t=!0;if(e&&e.itens.map(e=>{1==e.hasPending&&(t=!1)}),!t){f.ZP.error("Este bloco n\xe3o pode ser removido pois possui itens respondidos em um formul\xe1rio");return}let i=[...X];i.push(e.dados.parLimpezaModeloBlocoID),U(i);let s=[...y];s.splice(o,1),B(s),Q("blocks",s),f.ZP.success("Bloco pr\xe9-removido. Salve para concluir!")},ea=()=>{let e=[...eo("blocks")];e.push({dados:{ordem:e.length+1,nome:"",status:1},categorias:[],atividades:[],optionsBlock:{itens:[...O.itens]},itens:[{parFormularioID:1,new:!0,ordem:"1",nome:"",status:1,item:null}]}),Q("blocks",e),B(e)},ec=()=>{try{n.h.post("".concat(K,"/getData"),{id:l,unidadeID:d.unidadeID}).then(e=>{var o;console.log("\uD83D\uDE80 ~ response:",e.data),I(e.data.model),E(e.data.header),B(e.data.blocks),_({itens:null===(o=e.data.options)||void 0===o?void 0:o.itens}),M(e.data.orientations),ee(e.data),setTimeout(()=>{var o,t;null===(o=e.data)||void 0===o||null===(t=o.blocks)||void 0===t||t.map((o,t)=>{en(o,t,e.data.blocks,e.data.options)})},3e3)})}catch(e){console.log(e)}};return(0,s.useEffect)(()=>{ec()},[l,L]),(0,i.jsx)(i.Fragment,{children:N?(0,i.jsxs)("form",{onSubmit:$(es),children:[p&&(0,i.jsxs)(c.Z,{children:[(0,i.jsx)(Z.Z,{partialRoute:!0,btnCancel:!0,btnSave:!0,handleSubmit:()=>$(es),type:"edit"}),(0,i.jsx)(m.Z,{children:(0,i.jsxs)(u.ZP,{container:!0,spacing:4,children:[(0,i.jsx)(P.Z,{className:"order-1",xs:12,md:8,title:"Modelo",name:"model.nome",value:p.nome,required:!0,control:et,errors:null==ei?void 0:null===(o=ei.model)||void 0===o?void 0:o.nome}),(0,i.jsx)(P.Z,{className:"order-1",xs:12,md:3,type:"number",title:"Ciclo (dias)",name:"model.ciclo",value:p.ciclo,required:!0,control:et,errors:null==ei?void 0:null===(t=ei.model)||void 0===t?void 0:t.ciclo,help:{text:"...",position:"top",gapLeft:"10px"}}),(0,i.jsx)(C.Z,{className:"order-2 md:order-3",xs:2,md:1,title:"Ativo",name:"model.status",value:p.status,register:Y})]})})]}),N&&(0,i.jsx)(c.Z,{sx:{mt:4},children:(0,i.jsx)(m.Z,{children:(0,i.jsx)(v.Z,{component:"nav","aria-label":"main mailbox",children:(0,i.jsxs)(u.ZP,{container:!0,spacing:2,children:[(0,i.jsx)(u.ZP,{item:!0,md:4,xs:4,children:(0,i.jsx)(x.Z,{variant:"subtitle1",sx:{fontWeight:600},children:"Nome do Campo"})}),(0,i.jsx)(u.ZP,{item:!0,md:3,xs:4,children:(0,i.jsx)(x.Z,{variant:"subtitle1",sx:{fontWeight:600},children:"Mostra no Formul\xe1rio"})}),(0,i.jsx)(u.ZP,{item:!0,md:3,xs:4,children:(0,i.jsx)(x.Z,{variant:"subtitle1",sx:{fontWeight:600},children:"Obrigat\xf3rio"})}),N.map((e,o)=>(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(u.ZP,{item:!0,md:4,xs:6,children:e.nomeCampo}),(0,i.jsx)(u.ZP,{item:!0,md:3,xs:3,children:(0,i.jsx)(D.Z,{title:"",name:"header.[".concat(o,"].mostra"),value:e.mostra,register:Y,disabled:"cnpj"==e.nomeColuna})}),(0,i.jsx)(u.ZP,{item:!0,md:3,xs:3,children:(0,i.jsx)(D.Z,{title:"",name:"header.[".concat(o,"].obrigatorio"),value:e.obrigatorio,register:Y,disabled:"cnpj"==e.nomeColuna})})]}))]})})})}),y?(0,i.jsx)(w,{blocks:y,errors:ei,control:et,register:Y,removeItem:er,addItem:el,getValues:eo,removeBlock:ed,setValue:Q,openModalConfirmScore:R,setOpenModalConfirmScore:F,itemScore:V,allOptions:O},G):(0,i.jsx)(k.Z,{}),(0,i.jsx)(u.ZP,{item:!0,xs:12,md:12,sx:{mt:4},children:(0,i.jsx)(h.Z,{variant:"outlined",color:"primary",startIcon:(0,i.jsx)(S.Z,{icon:"material-symbols:add-circle-outline-rounded"}),onClick(){ea()},children:"Inserir Bloco"})}),q&&(0,i.jsx)(c.Z,{md:12,sx:{mt:4},children:(0,i.jsx)(m.Z,{children:(0,i.jsx)(u.ZP,{container:!0,spacing:4,children:(0,i.jsx)(P.Z,{xs:12,md:12,title:"Orienta\xe7\xf5es",name:"orientations.obs",required:!1,value:null==q?void 0:q.obs,multiline:!0,rows:4,control:et})})})})]}):(0,i.jsx)(k.Z,{})})},O=()=>{let[e,o]=(0,s.useState)(null),t=(0,p.useRouter)(),a=t.pathname,{setTitle:c}=(0,s.useContext)(r.f),{id:m,setId:u}=(0,s.useContext)(d.X),{loggedUnity:v}=(0,s.useContext)(g.V);(0,s.useEffect)(()=>{let e=async()=>{await n.h.get("".concat(a,"/getList/").concat(v.unidadeID)).then(e=>{o(e.data),c({title:"Formul\xe1rios modelo de limpeza",subtitle:{id:m,count:e.data.length,new:!1}})})};e()},[m]),(0,s.useEffect)(()=>{u(null)},[]);let x=(0,j.OL)(a,[{title:"ID",field:"id",size:.2},{title:"Nome",field:"nome",size:.8}]);return(0,i.jsx)(i.Fragment,{children:e?m&&m>0?(0,i.jsx)(E,{id:m}):(0,i.jsx)(l.Z,{result:e,columns:x,btnBack:!0}):(0,i.jsx)(k.Z,{show:!0})})};var _=O}},function(e){e.O(0,[4186,1445,1111,5999,7536,6668,2187,7630,9516,2708,8233,9774,2888,179],function(){return e(e.s=29295)}),_N_E=e.O()}]);