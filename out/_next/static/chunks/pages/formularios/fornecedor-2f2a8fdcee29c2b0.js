(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7463],{59424:function(e,o,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/formularios/fornecedor",function(){return a(18442)}])},93250:function(e,o,a){"use strict";var r=a(85893),n=a(49837),s=a(91359),i=a(40372);let t=e=>{let{result:o,columns:a,btnNew:t=!0,btnPrint:l=!0,openModal:d}=e;return(0,r.jsx)(n.Z,{children:(0,r.jsx)(s.Z,{sx:{pt:"0"},children:(0,r.jsx)(i.Z,{rows:o,columns:a,buttonsHeader:{btnNew:t,btnPrint:l,openModal:d}})})})};o.Z=t},18442:function(e,o,a){"use strict";a.r(o),a.d(o,{default:function(){return T}});var r=a(85893),n=a(67294),s=a(60664),i=a(93250),t=a(73312),l=a(60565),d=a(83830),c=a(40039),u=a(29620),m=a(77745),x=a(95398),h=a(44642),p=a(79072),f=a(55343),j=a(67836),v=a(29630),g=a(19604),F=a(75084),C=a(35966),Z=a(76779),b=a(11163);a(84220);var D=a(21609),I=a(49540),N=a(34175),P=a(82747),y=a(87536),S=a(86501),w=a(45061);let E=e=>{var o;let{handleClose:a,openModal:i,makeFornecedor:t,loadingSave:d}=e;(0,b.useRouter)();let[E,z]=(0,n.useState)(!1),{user:k,loggedUnity:A}=(0,n.useContext)(c.V),{handleSearch:T}=(0,n.useContext)(l.f),[_,J]=(0,n.useState)(null),[M,H]=(0,n.useState)(null),[V,q]=(0,n.useState)(!1),[G,L]=(0,n.useState)(null),[O,R]=(0,n.useState)(!1),[W,X]=(0,n.useState)(!1),[B,K]=(0,n.useState)(!1),[U,Q]=(0,n.useState)(!1),[Y,$]=(0,n.useState)([]),[ee,eo]=(0,n.useState)([]),[ea,er]=(0,n.useState)("");console.log("\uD83D\uDE80 ~ nomeFornecedor:",ea);let{handleSubmit:en,formState:{errors:es},setValue:ei,register:et}=(0,y.cI)({}),el=()=>{Q(!0),setTimeout(()=>{Q(!1)},5e3);let e=(0,I.q)((0,I.X1)(M)),o=(0,I.q)(A.unidadeID),a=window.location.origin,r="".concat(a,"/fornecedor?c=").concat(e,"&u=").concat(o);navigator.clipboard.writeText(r)},ed=async e=>{e&&18===e.length&&(console.log("getFornecedorByCnpj: ",e),(0,P.zk)(e)?(z(!0),R(!1),await s.h.post("/formularios/fornecedor/cnpj",{unidadeID:A.unidadeID,cnpj:e}).then(o=>{console.log("\uD83D\uDE80 ~ getFornecedorByCnpj response:",o.data),J(o.data),H(e),z(!1)})):(H(null),R(!0)))},ec=async()=>{console.log("filtra no contexto..."),T(M),a()},eu=async()=>{z(!0),await s.h.post("/formularios/fornecedor/fornecedorStatus",{unidadeID:A.unidadeID,cnpj:M,status:1}).then(e=>{200===e.status?(J(e.data),S.Am.success("Fornecedor reativado com sucesso")):S.Am.error("Erro ao reativar fornecedor"),z(!1)})},em=()=>{K(!0)},ex=async()=>{await s.h.post("/formularios/fornecedor/getGruposAnexo",{unidadeID:A.unidadeID}).then(e=>{$(e.data)}).catch(e=>{console.log("\uD83D\uDE80 ~ error:",e)})},eh=e=>{console.log("\uD83D\uDE80 ~ onSubmit ~ values:",e)};return(0,n.useEffect)(()=>{ex()},[]),(0,n.useEffect)(()=>{ed(M),J(null),en(eh),H(null),L(null)},[i,d]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(u.Z,{open:i,onClose:a,"aria-labelledby":"form-dialog-title",children:[(0,r.jsx)(m.Z,{id:"form-dialog-title",children:"Habilitar novo fornecedor"}),(0,r.jsxs)(x.Z,{children:[(0,r.jsxs)(h.Z,{sx:{mb:3},children:["Insira o CNPJ da empresa que deseja habilitar como um novo fornecedor. Com isso, a empresa ficar\xe1 apta a preencher formul\xe1rios para a ",A.nomeFantasia,"."]}),(0,r.jsx)("form",{onSubmit:en(eh),children:(0,r.jsxs)(p.ZP,{container:!0,children:[(0,r.jsx)(p.ZP,{item:!0,xs:12,md:12,children:(0,r.jsxs)(f.Z,{fullWidth:!0,children:[(0,r.jsx)(j.Z,{defaultValue:(null==_?void 0:_.cnpj)?_.cnpj:"",label:"CNPJ",placeholder:"CNPJ","aria-describedby":"validation-schema-nome",name:"cnpj",error:O,...et("cnpj",{required:!0,validate:e=>(0,P.zk)(e)||"CNPJ inv\xe1lido"}),helperText:null===(o=es.cnpj)||void 0===o?void 0:o.message,inputProps:{maxLength:18,onChange(e){J(null),ei("cnpj",(0,N.PK)(e.target.value)),H((0,N.PK)(e.target.value)),ed(e.target.value),q(!1)}}}),O&&(0,r.jsx)(v.Z,{variant:"body2",color:"error",children:"Por favor, insira um CNPJ v\xe1lido!"})]})}),_&&_.isFornecedor&&!_.hasFormulario&&V&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(p.ZP,{item:!0,xs:12,md:12,sx:{mt:4},children:(0,r.jsx)(f.Z,{fullWidth:!0,children:(0,r.jsx)(j.Z,{defaultValue:"",type:"email",label:"E-mail",placeholder:"E-mail","aria-describedby":"validation-schema-nome",name:"email",...et("email",{required:!0,validate:e=>e.includes("@")||"E-mail inv\xe1lido"}),error:W,helperText:W?"Insira um e-mail v\xe1lido":null,inputProps:{onChange(e){ei("email",e.target.value),L(e.target.value),X(!(0,P.dI)(e.target.value))}}})})}),(0,r.jsx)(p.ZP,{item:!0,xs:12,md:12,sx:{mt:2},children:(0,r.jsx)(g.Z,{severity:"info",children:"Um e-mail ser\xe1 enviado para o fornecedor com as instru\xe7\xf5es de cadastro e preenchimento do formul\xe1rio"})})]})]})}),_&&(0,r.jsx)(p.ZP,{container:!0,sx:{mt:2},children:(0,r.jsx)(p.ZP,{item:!0,xs:12,md:12,children:_.isFornecedor&&_.hasFormulario?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(g.Z,{severity:"success",children:["Esse CNPJ est\xe1 habilitado como um Fornecedor da ",A.nomeFantasia]}),(0,r.jsx)(F.Z,{startIcon:(0,r.jsx)(D.Z,{icon:U?"mdi:check-bold":"iconamoon:copy-bold"}),sx:{mt:2},onClick:U?null:el,style:{cursor:U?"default":"pointer"},children:U?"Copiado!":"Copiar Link do Formul\xe1rio"})]}):_.isFornecedor&&!_.hasFormulario?(0,r.jsx)(g.Z,{severity:"warning",children:"Esse CNPJ j\xe1 \xe9 seu fornecedor, mas n\xe3o h\xe1 nenhum formul\xe1rio criado"}):!_.isFornecedor&&_.hasFormulario?(0,r.jsx)(g.Z,{severity:"warning",children:"Esse CNPJ n\xe3o est\xe1 mais ativo como um fornecedor mas possui formul\xe1rios preenchidos"}):_.isFornecedor||_.hasFormulario?null:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(p.ZP,{item:!0,xs:12,md:12,sx:{my:1},children:(0,r.jsx)(f.Z,{fullWidth:!0,children:(0,r.jsx)(j.Z,{defaultValue:"",label:"Nome do Fornecedor",placeholder:"Nome do Fornecedor","aria-describedby":"validation-schema-nome",name:"nomeFornecedor",inputProps:{onChange(e){ei("nomeFornecedor",e.target.value),er(e.target.value)}}})})}),(0,r.jsx)(p.ZP,{item:!0,xs:12,md:12,sx:{mt:3},children:(0,r.jsx)(f.Z,{fullWidth:!0,children:(0,r.jsx)(C.Z,{multiple:!0,limitTags:5,options:Y,getOptionLabel:e=>e.nome,defaultValue:[],onChange(e,o){console.log("\uD83D\uDE80 Select => onChange:",o),eo(o)},renderInput:e=>(0,r.jsx)(j.Z,{...e,label:"Grupos de Anexo",placeholder:"Grupos de Anexo"})})})}),(0,r.jsx)(g.Z,{severity:"info",sx:{mt:3},children:"Esse CNPJ ainda n\xe3o \xe9 seu fornecedor"})]})})})]}),(0,r.jsxs)(Z.Z,{className:"dialog-actions-dense",sx:{mx:2,mb:2},children:[(0,r.jsx)(F.Z,{variant:"outlined",onClick:a,children:"Fechar"}),_&&(_.isFornecedor&&_.hasFormulario||!_.isFornecedor&&_.hasFormulario||!_.isFornecedor&&!_.hasFormulario)&&(0,r.jsx)(F.Z,{variant:"contained",onClick:_.isFornecedor&&_.hasFormulario?ec:!_.isFornecedor&&_.hasFormulario?eu:_.isFornecedor||_.hasFormulario?null:em,children:_.isFornecedor&&_.hasFormulario?"Filtrar formul\xe1rios":!_.isFornecedor&&_.hasFormulario?"Reativar fornecedor":_.isFornecedor||_.hasFormulario?null:"Tornar meu fornecedor"})]})]}),(0,r.jsx)(w.Z,{title:"Confirmar novo fornecedor",text:"Tem certeza que deseja tornar o CNPJ ".concat(M," um fornecedor ativo na ").concat(A.nomeFantasia," ? Se sim, o mesmo poder\xe1 preencher formul\xe1rios de Fornecedor para a sua empresa."),handleClose(){K(!1)},openModal:B,handleSubmit:t,inputEmail:!0,closeAfterSave:!0,cnpj:M,gruposAnexo:ee,nomeFornecedor:ea,grupoAnexosFornecedor:!0,btnCancel:!0,btnConfirm:!0,btnConfirmColor:"primary"})]})};var z=a(47842),k=a(46749);let A=()=>{let{user:e,loggedUnity:o}=(0,n.useContext)(c.V),[a,u]=(0,n.useState)(null),m=(0,b.useRouter)(),x=m.pathname,{setTitle:h,setSubtitle:p}=(0,n.useContext)(l.f),[f,j]=(0,n.useState)(!1),[v,g]=(0,n.useState)(!1),{id:F}=(0,n.useContext)(d.X),C=()=>{j(!0)},Z=async(a,r,n,i)=>{try{g(!0),await s.h.post("".concat(x,"/makeFornecedor"),{usuarioID:e.usuarioID,unidadeID:o.unidadeID,papelID:e.papelID,cnpj:a,nomeFornecedor:r,gruposAnexo:n}).then(e=>{200===e.status?(S.Am.success("Fornecedor habilitado com sucesso"),i&&D(i,a)):S.Am.error("Erro ao tornar fornecedor"),g(!1)})}catch(t){console.log(t)}},D=(e,a)=>{if(e&&(0,P.dI)(e)){let r={unidadeID:o.unidadeID,cnpj:a,destinatario:e};console.log("\uD83D\uDE80 ~ sendMail:",r),s.h.post("".concat(x,"/sendMail"),{data:r}).then(e=>{S.Am.success("E-mail enviado com sucesso")}).catch(e=>{console.error("Erro ao enviar email",e)})}},I=async()=>{await s.h.post("".concat(x,"/getList"),{unidadeID:o.unidadeID,papelID:e.papelID,cnpj:e.cnpj?e.cnpj:null}).then(e=>{u(e.data),h("Fornecedor"),p(F?"ID: ".concat(F):"Total de registros: ".concat(e.data.length))})};(0,n.useEffect)(()=>{I()},[F,v]);let N=1==e.papelID?[{headerName:"ID",field:"id",size:1},{headerName:"Fornecedor",field:"fornecedor",size:1},{headerName:"CNPJ",field:"cnpj",size:1},{headerName:"Data da Avalia\xe7\xe3o",field:"data",size:1},{headerName:"Cidade",field:"cidade",size:1},{headerName:"Respons\xe1vel",field:"responsavel",size:1},{headerName:"Status",field:"status",size:1}]:2==e.papelID?[{headerName:"ID",field:"id",size:1},{headerName:"F\xe1brica",field:"fabrica",size:1},{headerName:"CNPJ",field:"cnpj",size:1},{headerName:"Data da Avalia\xe7\xe3o",field:"data",size:1},{headerName:"Cidade",field:"cidade",size:1},{headerName:"Respons\xe1vel",field:"responsavel",size:1},{headerName:"Status",field:"status",size:1}]:[],y=(0,k.OL)(x,N);return(0,r.jsxs)(r.Fragment,{children:[a?F&&F>0?(0,r.jsx)(t.Z,{id:F}):(0,r.jsx)(i.Z,{result:a,columns:y,btnNew:1==e.papelID,openModal:1==e.papelID?C:null}):(0,r.jsx)(z.Z,{}),(0,r.jsx)(E,{openModal:f,handleClose:()=>j(!1),makeFornecedor:Z,loadingSave:v})]})};var T=A},40372:function(e,o,a){"use strict";a.d(o,{Z:function(){return D}});var r=a(85893),n=a(67294),s=a(87630),i=a(75680),t=a(61953),l=a(67836),d=a(80562),c=a(50853),u=a(11163),m=a.n(u),x=a(91359),h=a(75084),p=a(41664),f=a.n(p),j=a(40039),v=a(21609);let g=e=>{let{btnNew:o,btnPrint:a,openModal:s}=e,i=m(),{routes:l}=(0,n.useContext)(j.V);return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(x.Z,{sx:{display:"flex",justifyContent:"end",alignItems:"center",p:"0",m:"0"},children:(0,r.jsxs)(t.Z,{sx:{display:"flex",gap:"8px"},children:[a&&(0,r.jsx)(h.Z,{onClick:()=>window.print(),type:"button",variant:"outlined",color:"primary",size:"medium",startIcon:(0,r.jsx)(v.Z,{icon:"mdi:printer"}),children:"Imprimir"}),o&&l.find(e=>e.rota===i.pathname&&e.inserir)&&(0,r.jsx)(f(),{href:s?"":"".concat(i.pathname,"/novo"),children:(0,r.jsx)(h.Z,{type:"button",variant:"outlined",color:"primary",size:"medium",startIcon:(0,r.jsx)(v.Z,{icon:"ic:outline-plus"}),onClick:s||null,children:"Novo"})})]})})})},F=e=>(0,r.jsxs)(t.Z,{sx:{display:"flex",flexWrap:"wrap",alignItems:"baseline",justifyContent:"space-between",p:e=>e.spacing(8,0,0,0)},children:[(0,r.jsxs)(t.Z,{sx:{display:"flex",gap:"8px",textAlig:"end"},children:[(0,r.jsx)(l.Z,{size:"medium",value:e.value,onChange:e.onChange,placeholder:"Buscar…",variant:"standard",InputProps:{startAdornment:(0,r.jsx)(t.Z,{sx:{mr:2,display:"flex"},children:(0,r.jsx)(v.Z,{icon:"mdi:magnify",fontSize:20})}),endAdornment:(0,r.jsx)(d.Z,{size:"medium",title:"Clear","aria-label":"Clear",onClick:e.clearSearch,children:(0,r.jsx)(v.Z,{icon:"mdi:close",fontSize:20})})},sx:{width:{xs:1,sm:"auto"},"& .MuiInputBase-root > svg":{mr:2}}}),(0,r.jsx)(c.M,{})]}),(0,r.jsx)(t.Z,{children:(0,r.jsx)(g,{btnNew:e.buttonsHeader.btnNew,btnPrint:e.buttonsHeader.btnPrint,openModal:e.buttonsHeader.openModal})})]});var C=a(60565),Z=a(83830);let b=e=>{let{rows:o,columns:a,buttonsHeader:t}=e,{handleSearch:l,pageSize:d,setPageSize:c,searchText:u,filteredData:m,setData:x,data:h}=(0,n.useContext)(C.f),{setId:p}=(0,n.useContext)(Z.X);return x(o),(0,r.jsx)(s._,{localeText:i.F.components.MuiDataGrid.defaultProps.localeText,autoHeight:!0,columns:a,pageSize:d,rowsPerPageOptions:[10,20,30,40,50,100],components:{Toolbar:F},rows:u?m:h,onCellClick(e,o){p(e.row.id)},onPageSizeChange:e=>c(e),sx:{"& .MuiDataGrid-cell":{cursor:"pointer"}},componentsProps:{toolbar:{value:u,clearSearch:()=>l(""),onChange:e=>l(e.target.value),buttonsHeader:t}}})};var D=b}},function(e){e.O(0,[4186,1445,1111,5999,7536,2064,2187,1082,1515,8213,6896,3312,9774,2888,179],function(){return e(e.s=59424)}),_N_E=e.O()}]);