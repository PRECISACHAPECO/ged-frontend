"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5462],{91359:function(e,t,o){o.d(t,{Z:function(){return b}});var a=o(87462),n=o(63366),s=o(67294),r=o(86010),i=o(94780),c=o(67074),u=o(78884),d=o(1588),l=o(34867);function m(e){return(0,l.Z)("MuiCardContent",e)}(0,d.Z)("MuiCardContent",["root"]);var p=o(85893);let f=["className","component"],x=e=>{let{classes:t}=e;return(0,i.Z)({root:["root"]},m,t)},h=(0,c.ZP)("div",{name:"MuiCardContent",slot:"Root",overridesResolver:(e,t)=>t.root})(()=>({padding:16,"&:last-child":{paddingBottom:24}})),D=s.forwardRef(function(e,t){let o=(0,u.Z)({props:e,name:"MuiCardContent"}),{className:s,component:i="div"}=o,c=(0,n.Z)(o,f),d=(0,a.Z)({},o,{component:i}),l=x(d);return(0,p.jsx)(h,(0,a.Z)({as:i,className:(0,r.Z)(l.root,s),ownerState:d,ref:t},c))});var b=D},49837:function(e,t,o){o.d(t,{Z:function(){return v}});var a=o(87462),n=o(63366),s=o(67294),r=o(86010),i=o(94780),c=o(67074),u=o(78884),d=o(70918),l=o(1588),m=o(34867);function p(e){return(0,m.Z)("MuiCard",e)}(0,l.Z)("MuiCard",["root"]);var f=o(85893);let x=["className","raised"],h=e=>{let{classes:t}=e;return(0,i.Z)({root:["root"]},p,t)},D=(0,c.ZP)(d.Z,{name:"MuiCard",slot:"Root",overridesResolver:(e,t)=>t.root})(()=>({overflow:"hidden"})),b=s.forwardRef(function(e,t){let o=(0,u.Z)({props:e,name:"MuiCard"}),{className:s,raised:i=!1}=o,c=(0,n.Z)(o,x),d=(0,a.Z)({},o,{raised:i}),l=h(d);return(0,f.jsx)(D,(0,a.Z)({className:(0,r.Z)(l.root,s),elevation:i?8:void 0,ref:t,ownerState:d},c))});var v=b},55462:function(e,t,o){var a=o(85893),n=o(67294),s=o(87536),r=o(56531),i=o(99734),c=o(34282),u=o(29308),d=o(19604),l=o(49837),m=o(91359),p=o(79072),f=o(55343),x=o(29630),h=o(11163),D=o.n(h),b=o(46749),v=o(60664),g=o(86887);o(60565);var I=o(83830),Z=o(40039),C=o(39976),S=o(47842),j=o(86501),M=o(66136),R=o(80377);let P=e=>{let{id:t}=e,{user:o,loggedUnity:h}=(0,n.useContext)(Z.V),[P,w]=(0,n.useState)(!1),[y,E]=(0,n.useState)(!1),[F,N]=(0,n.useState)(!1),[O,_]=(0,n.useState)(!0),[k,V]=(0,n.useState)(null),{createNewNotification:T}=(0,n.useContext)(C.u),[A,B]=(0,n.useState)(!1),[W,z]=(0,n.useState)([]),[G,U]=(0,n.useState)(null),[H,J]=(0,n.useState)([]),[K,L]=(0,n.useState)(""),[X,q]=(0,n.useState)(!1),[Q,Y]=(0,n.useState)({status:!1,errors:[]}),{settings:$}=(0,n.useContext)(M.J6),{setId:ee}=(0,n.useContext)(I.X),[et,eo]=(0,n.useState)({status:!1,message:"Voc\xea n\xe3o tem permiss\xf5es",messageType:"info"}),ea=D(),en=t&&t>0?"edit":"new",es=ea.pathname,{reset:er,register:ei,getValues:ec,setValue:eu,control:ed,watch:el,handleSubmit:em,clearErrors:ep,setError:ef,formState:{errors:ex}}=(0,s.cI)(),eh=async e=>{let a={status:e,auth:{usuarioID:o.usuarioID,papelID:o.papelID,unidadeID:h.unidadeID}};try{E(!0),await v.h.post("".concat(es,"/changeFormStatus/").concat(t),a).then(t=>{j.ZP.success(b.OD.successUpdate),E(!1),eS(e,null,null)})}catch(n){console.log(n)}},eD=[{id:1,name:"Dados do Recebimento de MP",component:(0,a.jsx)(ReportRecebimentoMP,{params:{id:t,unidadeID:1}}),route:"/relatorio/recebimentoMp/dadosRecebimentoMp",papelID:o.papelID,identification:"01",params:{fornecedorID:t}},{id:2,name:"Declara\xe7\xe3o de prolifici\xeancia",component:(0,a.jsx)(ReportRecebimentoMP,{params:{id:t,unidadeID:1}}),route:"/relatorio/recebimentoMp/dadosRecebimentoMp",papelID:o.papelID,identification:"02",params:{fornecedorID:t}}],eb=async()=>{try{await v.h.post("".concat(es,"/verifyFormPending/").concat(t),{parFormularioID:4}).then(e=>{_(e.data) //! true/false
})}catch(e){console.log(e)}},ev=()=>{try{w(!0),v.h.post("".concat((0,b.g_)(es),"/new/getData"),{unidadeID:h.unidadeID}).then(e=>{console.log("getNewData: ",e.data),z(e.data.fields),J(e.data.blocos),L(e.data.info),er(e.data),eo({status:!0,message:'Esse formul\xe1rio j\xe1 foi conclu\xeddo! Para alter\xe1-lo \xe9 necess\xe1rio atualizar seu Status para "Em preenchimento" atrav\xe9s do bot\xe3o "Status"!',messageType:"info"}),w(!1)})}catch(e){console.log("\uD83D\uDE80 ~ error:",e)}},eg=()=>{w(!0),t&&v.h.post("".concat(es,"/getData/").concat(t),{type:en,unidadeID:h.unidadeID}).then(e=>{var t,o,a,n;console.log("getData: ",e.data),z(e.data.fields),J(e.data.blocos),L(e.data.info),er(e.data),V(b.WR[null==e?void 0:null===(t=e.data)||void 0===t?void 0:null===(o=t.info)||void 0===o?void 0:o.status]),eo({status:(null==e?void 0:null===(a=e.data)||void 0===a?void 0:null===(n=a.info)||void 0===n?void 0:n.status)<40,message:'Esse formul\xe1rio j\xe1 foi conclu\xeddo! Para alter\xe1-lo \xe9 necess\xe1rio atualizar seu Status para "Em preenchimento" atrav\xe9s do bot\xe3o "Status"!',messageType:"info"}),eb(),w(!1)})},eI=()=>{ep();let e=!1,t=[];null==W||W.forEach((o,a)=>{let n=o.tabela?"fields[".concat(a,"].").concat(o.tabela):"fields[".concat(a,"].").concat(o.nomeColuna),s=ec(n);1!==o.obrigatorio||s||(ef(n,{type:"manual",message:"Campo obrigat\xf3rio"}),t.push(null==o?void 0:o.nomeCampo),e=!0)}),H.forEach((o,a)=>{o.itens.forEach((o,n)=>{let s=ec("blocos[".concat(a,"].itens[").concat(n,"].resposta"));(null==o?void 0:o.obrigatorio)!==1||s||(ef("blocos[".concat(a,"].itens[").concat(n,"].resposta"),{type:"manual",message:"Campo obrigat\xe1rio"}),t.push(null==o?void 0:o.nome),e=!0)})}),Y({status:e,errors:t})},eZ=()=>{eI(),q(!0),N(!0)},eC=async e=>{e.conclusion=!0,await em(ej)(e)},eS=(e,a,n)=>{let s=30==e?"Em preenchimento":40==e?"Conclu\xeddo":50==e?"Reprovado":60==e?"Aprovado parcialmente":70==e?"Aprovado":"Pendente",r={titulo:"Formul\xe1rio de Recebimento de MP ".concat(s),descricao:"O formul\xe1rio de Recebimento de MP #".concat(t," est\xe1 ").concat(s,"."),url:"/formularios/recebimento-mp/",urlID:t,tipoNotificacaoID:4,usuarioGeradorID:o.usuarioID,usuarioID:0,unidadeID:h.unidadeID,papelID:1};if(r&&(T(r),a)){let i={titulo:"Recebimento de MP gerado",descricao:"O formul\xe1rio de Recebimento de MP #".concat(t," est\xe1 ").concat(s," e gerou uma n\xe3o conformidade."),url:"/formularios/recebimento-mp/nao-conformidade/",urlID:n,tipoNotificacaoID:5,usuarioGeradorID:o.usuarioID,usuarioID:0,unidadeID:h.unidadeID,papelID:1};T(i)}},ej=async function(e){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];!0===a.conclusion&&a.status>10&&(e.status=a.status,e.obsConclusao=a.obsConclusao);let n={form:e,auth:{usuarioID:o.usuarioID,papelID:o.papelID,unidadeID:h.unidadeID}};try{"edit"==en?(E(!0),await v.h.post("".concat(es,"/updateData/").concat(t),n).then(t=>{j.ZP.success(b.OD.successUpdate),E(!1);let o=null;t.data&&t.data.naoConformidade&&t.data.id>0&&(ea.push("/formularios/recebimento-mp/nao-conformidade/"),ee(t.data.id),o=t.data.id),eS(e.status,e.naoConformidade,o)})):"new"==en?await v.h.post("".concat((0,b.g_)(es),"/insertData"),n).then(e=>{ea.push("".concat((0,b.g_)(es))),ee(e.data),j.ZP.success(b.OD.successNew)}):j.ZP.error(b.OD.error)}catch(s){console.log(s)}};return(0,n.useEffect)(()=>{"new"==en?ev():eg()},[t,y]),(0,n.useEffect)(()=>{eI()},[]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(S.Z,{show:P}),(0,a.jsxs)("form",{onSubmit:em(ej),children:[!et.status&&(0,a.jsx)(d.Z,{severity:et.messageType,sx:{mb:2},children:et.message}),(0,a.jsxs)(l.Z,{children:[(0,a.jsx)(g.Z,{btnCancel:!0,btnSave:(null==K?void 0:K.status)<40||"new"==en,btnSend:"edit"==en&&(null==K?void 0:K.status)<50,btnPrint:"edit"==en,generateReport:b.generateReport,actionsData:eD,actions:!0,handleSubmit:()=>em(ej),handleSend:eZ,iconConclusion:"mdi:check-bold",titleConclusion:"Aprovar Recebimento de MP",title:"Recebimento de MP",btnStatus:"edit"==en,handleBtnStatus:()=>B(!0),type:en,status:k}),(0,a.jsx)(m.Z,{children:(0,a.jsx)(r.Z,{register:ei,errors:ex,setValue:eu,control:ed,fields:W,values:W,disabled:!et.status})})]}),H&&H.map((e,t)=>(0,a.jsx)(i.Z,{index:t,blockKey:"parRecebimentoMpModeloBlocoID",values:e,control:ed,register:ei,setValue:eu,errors:ex,disabled:!et.status},t)),K&&(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(l.Z,{sx:{mt:4},children:(0,a.jsx)(m.Z,{children:(0,a.jsx)(p.ZP,{container:!0,spacing:4,children:(0,a.jsx)(p.ZP,{item:!0,xs:12,md:12,children:(0,a.jsxs)(f.Z,{fullWidth:!0,children:[(0,a.jsx)(x.Z,{variant:"subtitle1",sx:{fontWeight:600,mb:2},children:"Observa\xe7\xf5es (campo de uso exclusivo da validadora)"}),(0,a.jsx)(u.Z,{title:"Observa\xe7\xe3o (opcional)",name:"info.obs",multiline:!0,rows:4,value:K.obs,disabled:!et.status,control:ed})]})})})})})}),A&&(0,a.jsx)(c.Z,{id:t,parFormularioID:2,formStatus:K.status,hasFormPending:O,canChangeStatus:K.status>30&&!O,openModal:A,handleClose:()=>B(!1),title:"Hist\xf3rico do Formul\xe1rio",text:"Listagem do hist\xf3rico das movimenta\xe7\xf5es do formul\xe1rio ".concat(t," de Recebimento de MP."),btnCancel:!0,btnConfirm:!0,handleSubmit:eh}),(0,a.jsx)(R.Z,{openModal:X,handleClose(){q(!1),N(!1)},title:"Concluir Formul\xe1rio",text:"Deseja realmente concluir este formul\xe1rio?",info:K,canChange:!O,register:ei,setValue:eu,getValues:ec,btnCancel:!0,btnConfirm:!0,btnConfirmColor:"primary",conclusionForm:eC,listErrors:Q})]})]})};t.Z=P}}]);