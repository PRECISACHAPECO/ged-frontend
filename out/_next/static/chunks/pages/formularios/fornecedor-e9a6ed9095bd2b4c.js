(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7463],{59424:function(e,o,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/formularios/fornecedor",function(){return a(18442)}])},93250:function(e,o,a){"use strict";var r=a(85893),n=a(49837),s=a(91359),i=a(40372);let t=e=>{let{result:o,columns:a,btnNew:t=!0,btnPrint:l=!0,openModal:d}=e;return(0,r.jsx)(n.Z,{children:(0,r.jsx)(s.Z,{sx:{pt:"0"},children:(0,r.jsx)(i.Z,{rows:o,columns:a,buttonsHeader:{btnNew:t,btnPrint:l,openModal:d}})})})};o.Z=t},18442:function(e,o,a){"use strict";a.r(o),a.d(o,{default:function(){return _}});var r=a(85893),n=a(67294),s=a(60664),i=a(93250),t=a(3803),l=a(60565),d=a(83830),c=a(40039),u=a(29620),m=a(77745),x=a(95398),p=a(44642),h=a(79072),f=a(55343),j=a(67836),v=a(29630),g=a(19604),C=a(75084),F=a(35966),Z=a(76779),b=a(11163);a(84220);var D=a(21609),I=a(49540),N=a(34175),y=a(82747),P=a(87536),S=a(86501),w=a(45061);let z=e=>{var o;let{handleClose:a,openModal:i,makeFornecedor:t,loadingSave:d}=e;(0,b.useRouter)();let[z,E]=(0,n.useState)(!1),{user:A,loggedUnity:k}=(0,n.useContext)(c.V),{handleSearch:_}=(0,n.useContext)(l.f),[J,T]=(0,n.useState)(null),[M,H]=(0,n.useState)(null),[q,L]=(0,n.useState)(!1),[V,G]=(0,n.useState)(null),[O,R]=(0,n.useState)(!1),[X,B]=(0,n.useState)(!1),[W,K]=(0,n.useState)(!1),[U,Q]=(0,n.useState)(!1),[Y,$]=(0,n.useState)([]),[ee,eo]=(0,n.useState)([]),{handleSubmit:ea,formState:{errors:er},setValue:en,register:es}=(0,P.cI)({}),ei=()=>{Q(!0),setTimeout(()=>{Q(!1)},5e3);let e=(0,I.q)((0,I.X1)(M)),o=(0,I.q)(k.unidadeID),a=window.location.origin,r="".concat(a,"/fornecedor?c=").concat(e,"&u=").concat(o);navigator.clipboard.writeText(r)},et=async e=>{e&&18===e.length&&(console.log("getFornecedorByCnpj: ",e),(0,y.zk)(e)?(E(!0),R(!1),await s.h.post("/formularios/fornecedor/cnpj",{unidadeID:k.unidadeID,cnpj:e}).then(o=>{console.log("\uD83D\uDE80 ~ getFornecedorByCnpj response:",o.data),T(o.data),H(e),E(!1)})):(H(null),R(!0)))},el=async()=>{console.log("filtra no contexto..."),_(M),a()},ed=async()=>{E(!0),await s.h.post("/formularios/fornecedor/fornecedorStatus",{unidadeID:k.unidadeID,cnpj:M,status:1}).then(e=>{200===e.status?(T(e.data),S.Am.success("Fornecedor reativado com sucesso")):S.Am.error("Erro ao reativar fornecedor"),E(!1)})},ec=()=>{K(!0)},eu=async()=>{await s.h.post("/formularios/fornecedor/getGruposAnexo",{unidadeID:k.unidadeID}).then(e=>{$(e.data)}).catch(e=>{console.log("\uD83D\uDE80 ~ error:",e)})},em=e=>{console.log("\uD83D\uDE80 ~ onSubmit ~ values:",e)};return(0,n.useEffect)(()=>{eu()},[]),(0,n.useEffect)(()=>{et(M),T(null),ea(em),H(null),G(null)},[i,d]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(u.Z,{open:i,onClose:a,"aria-labelledby":"form-dialog-title",children:[(0,r.jsx)(m.Z,{id:"form-dialog-title",children:"Habilitar novo fornecedor"}),(0,r.jsxs)(x.Z,{children:[(0,r.jsxs)(p.Z,{sx:{mb:3},children:["Insira o CNPJ da empresa que deseja habilitar como um novo fornecedor. Com isso, a empresa ficar\xe1 apta a preencher formul\xe1rios para a ",k.nomeFantasia,"."]}),(0,r.jsx)("form",{onSubmit:ea(em),children:(0,r.jsxs)(h.ZP,{container:!0,children:[(0,r.jsx)(h.ZP,{item:!0,xs:12,md:12,children:(0,r.jsxs)(f.Z,{fullWidth:!0,children:[(0,r.jsx)(j.Z,{defaultValue:(null==J?void 0:J.cnpj)?J.cnpj:"",label:"CNPJ",placeholder:"CNPJ","aria-describedby":"validation-schema-nome",name:"cnpj",error:O,...es("cnpj",{required:!0,validate:e=>(0,y.zk)(e)||"CNPJ inv\xe1lido"}),helperText:null===(o=er.cnpj)||void 0===o?void 0:o.message,inputProps:{maxLength:18,onChange(e){T(null),en("cnpj",(0,N.PK)(e.target.value)),H((0,N.PK)(e.target.value)),et(e.target.value),L(!1)}}}),O&&(0,r.jsx)(v.Z,{variant:"body2",color:"error",children:"Por favor, insira um CNPJ v\xe1lido!"})]})}),J&&J.isFornecedor&&!J.hasFormulario&&q&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(h.ZP,{item:!0,xs:12,md:12,sx:{mt:4},children:(0,r.jsx)(f.Z,{fullWidth:!0,children:(0,r.jsx)(j.Z,{defaultValue:"",type:"email",label:"E-mail",placeholder:"E-mail","aria-describedby":"validation-schema-nome",name:"email",...es("email",{required:!0,validate:e=>e.includes("@")||"E-mail inv\xe1lido"}),error:X,helperText:X?"Insira um e-mail v\xe1lido":null,inputProps:{onChange(e){en("email",e.target.value),G(e.target.value),B(!(0,y.dI)(e.target.value))}}})})}),(0,r.jsx)(h.ZP,{item:!0,xs:12,md:12,sx:{mt:2},children:(0,r.jsx)(g.Z,{severity:"info",children:"Um e-mail ser\xe1 enviado para o fornecedor com as instru\xe7\xf5es de cadastro e preenchimento do formul\xe1rio"})})]})]})}),J&&(0,r.jsx)(h.ZP,{container:!0,sx:{mt:2},children:(0,r.jsx)(h.ZP,{item:!0,xs:12,md:12,children:J.isFornecedor&&J.hasFormulario?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(g.Z,{severity:"success",children:["Esse CNPJ est\xe1 habilitado como um Fornecedor da ",k.nomeFantasia]}),(0,r.jsx)(C.Z,{startIcon:(0,r.jsx)(D.Z,{icon:U?"mdi:check-bold":"iconamoon:copy-bold"}),sx:{mt:2},onClick:U?null:ei,style:{cursor:U?"default":"pointer"},children:U?"Copiado!":"Copiar Link do Formul\xe1rio"})]}):J.isFornecedor&&!J.hasFormulario?(0,r.jsx)(g.Z,{severity:"warning",children:"Esse CNPJ j\xe1 \xe9 seu fornecedor, mas n\xe3o h\xe1 nenhum formul\xe1rio criado"}):!J.isFornecedor&&J.hasFormulario?(0,r.jsx)(g.Z,{severity:"warning",children:"Esse CNPJ n\xe3o est\xe1 mais ativo como um fornecedor mas possui formul\xe1rios preenchidos"}):J.isFornecedor||J.hasFormulario?null:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(h.ZP,{item:!0,xs:12,md:12,sx:{my:1},children:(0,r.jsx)(f.Z,{fullWidth:!0,children:(0,r.jsx)(F.Z,{multiple:!0,limitTags:5,options:Y,getOptionLabel:e=>e.nome,defaultValue:[],...es("gruposAnexo"),onChange(e,o){console.log("\uD83D\uDE80 Select => onChange:",o),eo(o)},renderInput:e=>(0,r.jsx)(j.Z,{...e,label:"Grupos de Anexo",placeholder:"Grupos de Anexo"})})})}),(0,r.jsx)(g.Z,{severity:"info",sx:{mt:3},children:"Esse CNPJ ainda n\xe3o \xe9 seu fornecedor"})]})})})]}),(0,r.jsxs)(Z.Z,{className:"dialog-actions-dense",sx:{mx:2,mb:2},children:[(0,r.jsx)(C.Z,{variant:"outlined",onClick:a,children:"Fechar"}),J&&(J.isFornecedor&&J.hasFormulario||!J.isFornecedor&&J.hasFormulario||!J.isFornecedor&&!J.hasFormulario)&&(0,r.jsx)(C.Z,{variant:"contained",onClick:J.isFornecedor&&J.hasFormulario?el:!J.isFornecedor&&J.hasFormulario?ed:J.isFornecedor||J.hasFormulario?null:ec,children:J.isFornecedor&&J.hasFormulario?"Filtrar formul\xe1rios":!J.isFornecedor&&J.hasFormulario?"Reativar fornecedor":J.isFornecedor||J.hasFormulario?null:"Tornar meu fornecedor"})]})]}),(0,r.jsx)(w.Z,{title:"Confirmar novo fornecedor",text:"Tem certeza que deseja tornar o CNPJ ".concat(M," um fornecedor ativo na ").concat(k.nomeFantasia," ? Se sim, o mesmo poder\xe1 preencher formul\xe1rios de Fornecedor para a sua empresa."),handleClose(){K(!1)},openModal:W,handleSubmit:t,inputEmail:!0,closeAfterSave:!0,cnpj:M,gruposAnexo:ee,grupoAnexosFornecedor:!0,btnCancel:!0,btnConfirm:!0,btnConfirmColor:"primary"})]})};var E=a(47842),A=a(46749);let k=()=>{let{user:e,loggedUnity:o}=(0,n.useContext)(c.V),[a,u]=(0,n.useState)(null),m=(0,b.useRouter)(),x=m.pathname,{setTitle:p}=(0,n.useContext)(l.f),[h,f]=(0,n.useState)(!1),[j,v]=(0,n.useState)(!1),{id:g}=(0,n.useContext)(d.X),C=()=>{f(!0)},F=async(a,r,n)=>{console.log("\uD83D\uDE80 ~ makeFornecedor => gruposAnexo:",r);try{v(!0),await s.h.post("".concat(x,"/makeFornecedor"),{usuarioID:e.usuarioID,unidadeID:o.unidadeID,papelID:e.papelID,cnpj:a,gruposAnexo:r}).then(e=>{200===e.status?(S.Am.success("Fornecedor habilitado com sucesso"),n&&Z(n,a)):S.Am.error("Erro ao tornar fornecedor"),v(!1)})}catch(i){console.log(i)}},Z=(e,a)=>{if(e&&(0,y.dI)(e)){let r={unidadeID:o.unidadeID,cnpj:a,destinatario:e};s.h.post("".concat(x,"/sendMail"),{data:r}).then(e=>{S.Am.success("E-mail enviado com sucesso")}).catch(e=>{console.error("Erro ao enviar email",e)})}},D=async()=>{console.log("getList> ",x),await s.h.post("".concat(x,"/getList"),{unidadeID:o.unidadeID,papelID:e.papelID,cnpj:e.cnpj?e.cnpj:null}).then(e=>{u(e.data),p("Fornecedor")})};(0,n.useEffect)(()=>{D()},[g,j]);let I=1==e.papelID?[{headerName:"ID",field:"id",size:1},{headerName:"Data da Avalia\xe7\xe3o",field:"data",size:1},{headerName:"Fornecedor",field:"fornecedor",size:1},{headerName:"CNPJ",field:"cnpj",size:1},{headerName:"Cidade",field:"cidade",size:1},{headerName:"Respons\xe1vel",field:"responsavel",size:1},{headerName:"Status",field:"status",size:1}]:2==e.papelID?[{headerName:"ID",field:"id",size:1},{headerName:"Data da Avalia\xe7\xe3o",field:"data",size:1},{headerName:"F\xe1brica",field:"fabrica",size:1},{headerName:"CNPJ",field:"cnpj",size:1},{headerName:"Cidade",field:"cidade",size:1},{headerName:"Respons\xe1vel",field:"responsavel",size:1},{headerName:"Status",field:"status",size:1}]:[],N=(0,A.OL)(x,I);return(0,r.jsxs)(r.Fragment,{children:[a?g&&g>0?(0,r.jsx)(t.Z,{id:g}):(0,r.jsx)(i.Z,{result:a,columns:N,btnNew:1==e.papelID,openModal:1==e.papelID?C:null}):(0,r.jsx)(E.Z,{}),(0,r.jsx)(z,{openModal:h,handleClose:()=>f(!1),makeFornecedor:F,loadingSave:j})]})};var _=k},40372:function(e,o,a){"use strict";a.d(o,{Z:function(){return D}});var r=a(85893),n=a(67294),s=a(87630),i=a(75680),t=a(61953),l=a(67836),d=a(80562),c=a(50853),u=a(11163),m=a.n(u),x=a(91359),p=a(75084),h=a(41664),f=a.n(h),j=a(40039),v=a(21609);let g=e=>{let{btnNew:o,btnPrint:a,openModal:s}=e,i=m(),{routes:l}=(0,n.useContext)(j.V);return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(x.Z,{sx:{display:"flex",justifyContent:"end",alignItems:"center",p:"0",m:"0"},children:(0,r.jsxs)(t.Z,{sx:{display:"flex",gap:"8px"},children:[a&&(0,r.jsx)(p.Z,{onClick:()=>window.print(),type:"button",variant:"outlined",color:"primary",size:"medium",startIcon:(0,r.jsx)(v.Z,{icon:"mdi:printer"}),children:"Imprimir"}),o&&l.find(e=>e.rota===i.pathname&&e.inserir)&&(0,r.jsx)(f(),{href:s?"":"".concat(i.pathname,"/novo"),children:(0,r.jsx)(p.Z,{type:"button",variant:"outlined",color:"primary",size:"medium",startIcon:(0,r.jsx)(v.Z,{icon:"ic:outline-plus"}),onClick:s||null,children:"Novo"})})]})})})},C=e=>(0,r.jsxs)(t.Z,{sx:{display:"flex",flexWrap:"wrap",alignItems:"baseline",justifyContent:"space-between",p:e=>e.spacing(8,0,0,0)},children:[(0,r.jsxs)(t.Z,{sx:{display:"flex",gap:"8px",textAlig:"end"},children:[(0,r.jsx)(l.Z,{size:"medium",value:e.value,onChange:e.onChange,placeholder:"Buscar…",variant:"standard",InputProps:{startAdornment:(0,r.jsx)(t.Z,{sx:{mr:2,display:"flex"},children:(0,r.jsx)(v.Z,{icon:"mdi:magnify",fontSize:20})}),endAdornment:(0,r.jsx)(d.Z,{size:"medium",title:"Clear","aria-label":"Clear",onClick:e.clearSearch,children:(0,r.jsx)(v.Z,{icon:"mdi:close",fontSize:20})})},sx:{width:{xs:1,sm:"auto"},"& .MuiInputBase-root > svg":{mr:2}}}),(0,r.jsx)(c.M,{})]}),(0,r.jsx)(t.Z,{children:(0,r.jsx)(g,{btnNew:e.buttonsHeader.btnNew,btnPrint:e.buttonsHeader.btnPrint,openModal:e.buttonsHeader.openModal})})]});var F=a(60565),Z=a(83830);let b=e=>{let{rows:o,columns:a,buttonsHeader:t}=e,{handleSearch:l,pageSize:d,setPageSize:c,searchText:u,filteredData:m,setData:x,data:p}=(0,n.useContext)(F.f),{setId:h}=(0,n.useContext)(Z.X);return x(o),(0,r.jsx)(s._,{localeText:i.F.components.MuiDataGrid.defaultProps.localeText,autoHeight:!0,columns:a,pageSize:d,rowsPerPageOptions:[10,20,30,40,50,100],components:{Toolbar:C},rows:u?m:p,onCellClick(e,o){h(e.row.id)},onPageSizeChange:e=>c(e),sx:{"& .MuiDataGrid-cell":{cursor:"pointer"}},componentsProps:{toolbar:{value:u,clearSearch:()=>l(""),onChange:e=>l(e.target.value),buttonsHeader:t}}})};var D=b}},function(e){e.O(0,[4186,1445,1111,5999,7536,2064,2187,1082,1953,4107,6896,3803,9774,2888,179],function(){return e(e.s=59424)}),_N_E=e.O()}]);