"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7180],{69418:function(e,o,a){a.d(o,{Z:function(){return D}});var n=a(85893),t=a(44642),i=a(79072),l=a(61953),s=a(49837),r=a(91359),d=a(29630),c=a(67294),u=a(40039),x=a(82747),m=a(60664),p=a(29308),h=a(84220);let v=e=>{var o,a,t,i,s,r,x,v,f;let{fields:g,setFields:D,handleCnpj:j,validCnpj:I,getValues:Z,control:b,errors:A,setValue:C,register:S,reset:y}=e,{loggedUnity:F}=(0,c.useContext)(u.V),[w,E]=(0,c.useState)([]),[P,N]=(0,c.useState)([]),[z,k]=(0,c.useState)([]),R=async()=>{let e=await m.h.post("/formularios/fornecedor/getModels",{unidadeID:F.unidadeID});E(e.data)},M=async()=>{let e=await m.h.post("/formularios/fornecedor/getProducts",{unidadeID:F.unidadeID});N(e.data)},O=async()=>{let e=await m.h.post("/formularios/fornecedor/getGruposAnexo",{unidadeID:F.unidadeID});k(e.data)},G=()=>{D(null),C("fields.cnpj",""),C("fields.razaoSocial",""),C("fields.email",""),C("fields.modelo",null),C("fields.gruposAnexo",[]),C("fields.produtos",[])};return(0,c.useEffect)(()=>{y(),R(),M(),O()},[]),w&&P&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(l.Z,{children:[(0,n.jsx)(p.Z,{xs:12,md:12,title:"CNPJ",name:"fields.cnpj",value:null==g?void 0:g.cnpj,onChange:j,clearField:Z("fields.cnpj")?G:null,mask:"cnpj",required:!0,control:b,errors:null==A?void 0:null===(o=A.fields)||void 0===o?void 0:o.cnpj}),!1==I&&(0,n.jsx)(d.Z,{variant:"body2",color:"error",children:"CNPJ inv\xe1lido!"})]}),(0,n.jsx)(p.Z,{xs:12,md:12,title:"Raz\xe3o Social",name:"fields.razaoSocial",value:null==g?void 0:g.razaoSocial,disabled:!I,required:!0,control:b,errors:null==A?void 0:null===(a=A.fields)||void 0===a?void 0:a.razaoSocial}),(0,n.jsx)(p.Z,{xs:12,md:12,title:"Nome Fantasia",name:"fields.nomeFantasia",value:null==g?void 0:g.nomeFantasia,disabled:!I,required:!0,control:b,errors:null==A?void 0:null===(t=A.fields)||void 0===t?void 0:t.nomeFantasia}),(0,n.jsx)(p.Z,{xs:12,md:12,type:"email",title:"E-mail",name:"fields.email",value:null==g?void 0:g.email,disabled:!I,required:!0,control:b,errors:null==A?void 0:null===(i=A.fields)||void 0===i?void 0:i.email}),(0,n.jsx)(h.Z,{xs:12,md:12,title:"Modelo de Formul\xe1rio",name:"fields.modelo",options:w,required:!0,value:null==g?void 0:g.modelo,disabled:!I,register:S,setValue:C,control:b,errors:null==A?void 0:null===(s=A.fields)||void 0===s?void 0:s.modelo}),(0,n.jsx)(h.Z,{xs:12,md:12,title:"Grupos de Anexo",multiple:!0,name:"fields.gruposAnexo",value:null!==(v=null==g?void 0:g.gruposAnexo)&&void 0!==v?v:[],disabled:!I,options:null!=z?z:[],register:S,setValue:C,control:b,errors:null==A?void 0:null===(r=A.fields)||void 0===r?void 0:r.gruposAnexo}),(0,n.jsx)(h.Z,{xs:12,md:12,title:"Produtos",name:"fields.produtos",value:null!==(f=null==g?void 0:g.produtos)&&void 0!==f?f:[],disabled:!I,multiple:!0,required:!0,options:null!=P?P:[],register:S,setValue:C,control:b,errors:null==A?void 0:null===(x=A.fields)||void 0===x?void 0:x.produtos})]})};var f=a(34175);let g=e=>{var o,a,p,h,g,D;let{cnpj:j,control:I,setValue:Z,register:b,errors:A,reset:C,getValues:S}=e,[y,F]=(0,c.useState)(!1),{loggedUnity:w}=(0,c.useContext)(u.V),[E,P]=(0,c.useState)(null),[N,z]=(0,c.useState)(null),k=e=>{18==e.length?(0,x.zk)(e)?(z(!0),R(e)):z(!1):(z(null),P(null))},R=async e=>{try{let o=await m.h.post("/formularios/fornecedor/cnpj",{unidadeID:w.unidadeID,cnpj:e}),a={new:o.data.new,fornecedorID:o.data.fornecedorID,data:o.data.dataAvaliacao,modelo:o.data.modelo.nome,produtos:o.data.produtos,gruposAnexo:o.data.gruposAnexo},n="";a.new&&(n=await M(e)),P({...E,cnpj:a.new?(0,f.PK)(n.data.CNPJ):e,status:a.new?n.data.STATUS:"",dataAbertura:a.new?n.data["DATA ABERTURA"]:"",telefone:a.new?n.data.DDD+" "+n.data.TELEFONE:"",razaoSocial:a.new?n.data["RAZAO SOCIAL"]:o.data.fields.razaoSocial,nomeFantasia:a.new?n.data["NOME FANTASIA"]:o.data.fields.nomeFantasia,email:a.new?n.data.EMAIL:o.data.fields.email,cidade:a.new?n.data.MUNICIPIO+"/"+n.data.UF:"",preenchimento:a}),Z("fields.cnpj",e),Z("fields.razaoSocial",a.new?n.data["RAZAO SOCIAL"]:o.data.fields.razaoSocial),Z("fields.nomeFantasia",a.new?n.data["NOME FANTASIA"]:o.data.fields.nomeFantasia),Z("fields.nome",a.new?n.data["NOME FANTASIA"]:""),Z("fields.email",a.new?n.data.EMAIL:o.data.fields.email),Z("fields.modelo",o.data.modelo.id>0?o.data.modelo:null),Z("fields.gruposAnexo",o.data.gruposAnexo),Z("fields.produtos",o.data.produtos)}catch(t){console.error(t)}},M=async e=>{let o=e.replace(/\D/g,""),a=await m.h.get("https://api-publica.speedio.com.br/buscarcnpj?cnpj=".concat(o));return a};return(0,c.useEffect)(()=>{F(!y),j&&j.length>0&&k(j)},[]),(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(t.Z,{children:(0,n.jsxs)(i.ZP,{container:!0,spacing:4,children:[(0,n.jsx)(i.ZP,{item:!0,xs:12,md:6,children:(0,n.jsx)(l.Z,{display:"flex",flexDirection:"column",sx:{gap:4},children:(0,n.jsx)(v,{setFields:P,fields:null!=E?E:null,control:I,errors:A,reset:C,setValue:Z,getValues:S,register:b,handleCnpj:k,validCnpj:N},y)})}),(0,n.jsxs)(i.ZP,{item:!0,xs:12,md:6,children:[(0,n.jsx)(s.Z,{children:(0,n.jsx)(r.Z,{children:(0,n.jsxs)(l.Z,{display:"flex",flexDirection:"column",sx:{gap:4},children:[(0,n.jsx)(d.Z,{variant:"body2",children:(0,n.jsx)("strong",{children:"Dados consultados da Receita Federal"})}),(0,n.jsxs)(d.Z,{variant:"caption",children:[(0,n.jsx)("strong",{children:"Raz\xe3o Social:"})," ",null==E?void 0:E.razaoSocial]}),(0,n.jsxs)(d.Z,{variant:"caption",children:[(0,n.jsx)("strong",{children:"Nome Fantasia:"})," ",null==E?void 0:E.nomeFantasia]}),(0,n.jsxs)(d.Z,{variant:"caption",children:[(0,n.jsx)("strong",{children:"CNPJ:"})," ",null==E?void 0:E.cnpj]}),(0,n.jsxs)(d.Z,{variant:"caption",children:[(0,n.jsx)("strong",{children:"Status:"})," ",null==E?void 0:E.status]}),(0,n.jsxs)(d.Z,{variant:"caption",children:[(0,n.jsx)("strong",{children:"Data Abertura:"})," ",null==E?void 0:E.dataAbertura]}),(0,n.jsxs)(d.Z,{variant:"caption",children:[(0,n.jsx)("strong",{children:"Telefone:"})," ",null==E?void 0:E.telefone]}),(0,n.jsxs)(d.Z,{variant:"caption",children:[(0,n.jsx)("strong",{children:"E-mail:"})," ",null==E?void 0:E.email]}),(0,n.jsxs)(d.Z,{variant:"caption",children:[(0,n.jsx)("strong",{children:"Cidade:"})," ",null==E?void 0:E.cidade]})]})})}),(0,n.jsx)(s.Z,{sx:{mt:4},children:(0,n.jsx)(r.Z,{children:(0,n.jsxs)(l.Z,{display:"flex",flexDirection:"column",sx:{gap:4},children:[(0,n.jsx)(d.Z,{variant:"body2",children:(0,n.jsx)("strong",{children:"Dados do \xfaltimo formul\xe1rio deste fornecedor"})}),(null==E?void 0:null===(o=E.preenchimento)||void 0===o?void 0:o.new)?(0,n.jsx)(d.Z,{variant:"body2",color:"primary",children:(0,n.jsx)("strong",{children:"Novo fornecedor"})}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(d.Z,{variant:"caption",children:[(0,n.jsx)("strong",{children:"ID: "})," ",null==E?void 0:null===(a=E.preenchimento)||void 0===a?void 0:a.fornecedorID]}),(0,n.jsxs)(d.Z,{variant:"caption",children:[(0,n.jsx)("strong",{children:"Data de preenchimento:"})," ",null==E?void 0:null===(p=E.preenchimento)||void 0===p?void 0:p.data]}),(0,n.jsxs)(d.Z,{variant:"caption",children:[(0,n.jsx)("strong",{children:"Modelo:"})," ",null==E?void 0:null===(h=E.preenchimento)||void 0===h?void 0:h.modelo]}),(0,n.jsxs)(d.Z,{variant:"caption",children:[(0,n.jsx)("strong",{children:"Grupos de anexo: "}),null==E?void 0:null===(g=E.preenchimento)||void 0===g?void 0:g.gruposAnexo.map((e,o)=>{var a;return"".concat(e.nome).concat(o<(null==E?void 0:null===(a=E.preenchimento)||void 0===a?void 0:a.gruposAnexo.length)-1?", ":"")})]}),(0,n.jsxs)(d.Z,{variant:"caption",children:[(0,n.jsx)("strong",{children:"Produtos: "}),null==E?void 0:null===(D=E.preenchimento)||void 0===D?void 0:D.produtos.map((e,o)=>{var a;return"".concat(e.nome).concat(o<(null==E?void 0:null===(a=E.preenchimento)||void 0===a?void 0:a.produtos.length)-1?", ":"")})]})]})]})})})]})]})})})};var D=g},47180:function(e,o,a){a.d(o,{Z:function(){return Y}});var n=a(85893),t=a(67294),i=a(87536),l=a(56531),s=a(79139),r=a(34282),d=a(29308),c=a(66136),u=a(79072),x=a(72389),m=a(80562),p=a(21609),h=a(10179),v=a(42107),f=a(73731),g=a(53934);let D=e=>{var o;let{key:a,item:t,handleFileClick:i,indexGrupo:l,indexItem:s,selectedItem:r,handleFileSelect:d,handleRemove:c,loadingFile:D,folder:j,error:I,disabled:Z,modeTheme:b,inputRef:A}=e;return console.log("\uD83D\uDE80 ~ AnexoGrid item:",t),(0,n.jsx)(u.ZP,{item:!0,xs:12,md:3,children:(0,n.jsxs)("div",{className:"".concat((null==I?void 0:I[a])?"border border-red-500":"dark"===b?"bg-[#202023]":"bg-[#F6F6F8]"," rounded-lg flex flex-col relative z-10"),children:[(0,n.jsx)("div",{className:"flex items-center justify-center p-2 mt-1 ",children:(0,n.jsx)("p",{className:"font-medium text-sm ",children:t.nome})}),(0,n.jsx)("div",{className:"flex justify-center items-center cursor-pointer p-1 h-[100px] w-full ",disabled:Z,onClick(){t.anexo&&t.anexo.path&&t.anexo.exist?window.open(t.anexo.path,"_blank"):Z||i(t)},children:(0,n.jsxs)("div",{className:"flex p-1 justify-center items-center gap-2 rounded-lg w-full h-full m-3 border-2 border-dashed hover:border-[#4A8B57] transition-colors ".concat("dark"===b?" border-[#27272a]":"rgba(76, 78, 100, 0.12)"),children:[r&&r.grupoAnexoItemID==t.grupoAnexoItemID&&(0,n.jsx)(f.Z,{show:D,title:"Enviando anexo..."}),(0,n.jsx)("div",{className:"flex items-center gap-3",children:t.anexo&&t.anexo.exist?(0,n.jsx)("div",{children:(0,n.jsxs)("div",{className:"flex flex-col items-center gap-1",children:[(0,n.jsx)(v.Z,{data:t.anexo}),(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsxs)("p",{className:"text-sm opacity-80",children:[t.anexo.nome,(0,n.jsx)("span",{className:"text-xs opacity-50 ml-1",children:"(".concat((t.anexo.size/1024/1024).toFixed(2),"MB)")})]}),t.descricao&&(0,n.jsx)(g.Z,{text:t.descricao})]}),(0,n.jsx)("p",{className:"text-xs opacity-50",children:new Date(t.anexo.time).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})})]})}):(0,n.jsxs)("div",{className:"flex flex-col items-center gap-1",children:[(0,n.jsx)(h.Z,{className:"w-8 h-8 ".concat(t.anexo&&t.anexo.exist?"fill-[#666CFF]":"fill-current")}),(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsx)("h6",{className:"text-sm font-normal opacity-80",children:"Adicione um arquivo"}),t.descricao&&(0,n.jsx)(g.Z,{text:t.descricao})]})]})})]})}),(0,n.jsx)("div",{className:"flex items-center justify-between gap-1 p-2 py-3 pl-4",children:(0,n.jsx)(x.Z,{title:1==t.hasPending?"Este item n\xe3o pode mais ser removido pois j\xe1 foi respondido em um formul\xe1rio":"Remover este item",children:(0,n.jsx)(m.Z,{color:"error",onClick:()=>c(t),disabled:!(null===(o=t.anexo)||void 0===o?void 0:o.exist)||Z,children:(0,n.jsx)(p.Z,{icon:"tabler:trash-filled"})})})}),(0,n.jsx)("input",{type:"file",ref:A,style:{display:"none"},onChange:e=>d(e,r,j)})]})})};a(88475);var j=a(92945),I=a(49837),Z=a(91359),b=a(29630),A=a(85390),C=a(87054),S=function(e){return(0,n.jsx)("svg",{fill:"currentColor",viewBox:"0 0 16 16",height:"1em",width:"1em",...e,children:(0,n.jsx)("path",{fillRule:"evenodd",d:"M2.5 12a.5.5 0 01.5-.5h10a.5.5 0 010 1H3a.5.5 0 01-.5-.5zm0-4a.5.5 0 01.5-.5h10a.5.5 0 010 1H3a.5.5 0 01-.5-.5zm0-4a.5.5 0 01.5-.5h10a.5.5 0 010 1H3a.5.5 0 01-.5-.5z"})})},y=function(e){return(0,n.jsx)("svg",{fill:"currentColor",viewBox:"0 0 16 16",height:"1em",width:"1em",...e,children:(0,n.jsx)("path",{d:"M1 2.5A1.5 1.5 0 012.5 1h3A1.5 1.5 0 017 2.5v3A1.5 1.5 0 015.5 7h-3A1.5 1.5 0 011 5.5v-3zM2.5 2a.5.5 0 00-.5.5v3a.5.5 0 00.5.5h3a.5.5 0 00.5-.5v-3a.5.5 0 00-.5-.5h-3zm6.5.5A1.5 1.5 0 0110.5 1h3A1.5 1.5 0 0115 2.5v3A1.5 1.5 0 0113.5 7h-3A1.5 1.5 0 019 5.5v-3zm1.5-.5a.5.5 0 00-.5.5v3a.5.5 0 00.5.5h3a.5.5 0 00.5-.5v-3a.5.5 0 00-.5-.5h-3zM1 10.5A1.5 1.5 0 012.5 9h3A1.5 1.5 0 017 10.5v3A1.5 1.5 0 015.5 15h-3A1.5 1.5 0 011 13.5v-3zm1.5-.5a.5.5 0 00-.5.5v3a.5.5 0 00.5.5h3a.5.5 0 00.5-.5v-3a.5.5 0 00-.5-.5h-3zm6.5.5A1.5 1.5 0 0110.5 9h3a1.5 1.5 0 011.5 1.5v3a1.5 1.5 0 01-1.5 1.5h-3A1.5 1.5 0 019 13.5v-3zm1.5-.5a.5.5 0 00-.5.5v3a.5.5 0 00.5.5h3a.5.5 0 00.5-.5v-3a.5.5 0 00-.5-.5h-3z"})})};let F=e=>{let{values:o}=e,[a,i]=(0,t.useState)(null);console.log("\uD83D\uDE80 ~ selectedItem:",a);let{settings:l}=(0,t.useContext)(c.J6),s=l.mode,r=(0,t.useRef)(null),d=e=>{r.current.click(),i(e)};(0,t.useEffect)(()=>{r.current.value=""},[o.handleFileSelect]);let[x,m]=(0,t.useState)("list"),p=(e,o)=>{m(o)};return(0,n.jsx)(I.Z,{sx:{mt:4},children:(0,n.jsxs)(Z.Z,{children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,n.jsxs)(b.Z,{variant:"subtitle1",sx:{fontWeight:600},children:[o.grupo.nome,(0,n.jsx)(b.Z,{variant:"body2",sx:{mb:2},children:o.grupo.descricao})]}),(0,n.jsx)("div",{children:(0,n.jsxs)(A.Z,{exclusive:!0,color:"primary",value:x,onChange:p,children:[(0,n.jsx)(C.Z,{value:"list",children:(0,n.jsx)(S,{})}),(0,n.jsx)(C.Z,{value:"grid",children:(0,n.jsx)(y,{})})]})})]}),(0,n.jsx)(u.ZP,{container:!0,spacing:4,children:o.grupo.itens.map((e,t)=>"list"===x?(0,n.jsx)(j.Z,{modeTheme:s,handleFileClick:d,selectedItem:a,inputRef:r,item:e,loadingFile:o.loadingFile,grupo:o.grupo,indexBlock:o.indexGrupo,indexItem:t,handleFileSelect:o.handleFileSelect,handleRemove:o.handleRemove,folder:o.folder,error:o.error,disabled:o.disabled},"".concat(o.indexGrupo,"-").concat(t)):(0,n.jsx)(D,{modeTheme:s,handleFileClick:d,selectedItem:a,inputRef:r,item:e,loadingFile:o.loadingFile,grupo:o.grupo,indexGrupo:o.indexGrupo,indexItem:t,handleFileSelect:o.handleFileSelect,handleRemove:o.handleRemove,folder:o.folder,error:o.error,disabled:o.disabled},"".concat(o.indexGrupo,"-").concat(t)))})]})})};var w=a(19604),E=a(55343),P=a(11163),N=a.n(P),z=a(46749),k=a(60664),R=a(86887),M=a(83830),O=a(40039),G=a(39976),B=a(47842),T=a(86501),V=a(80377),q=a(22416),L=a(61953),_=a(22841),J=a(16056);let U=e=>{let{xs:o,md:a,title:t,index:i,name:l,typePage:s,value:r,disabled:d,register:c,...x}=e;return(0,n.jsx)(u.ZP,{item:!0,xs:o,md:a,children:(0,n.jsx)(L.Z,{display:"flex",flexDirection:"column",alignItems:"start",children:(0,n.jsx)(_.Z,{control:(0,n.jsx)(J.Z,{...x,name:l,...c(l),defaultChecked:r,disabled:d,onChange(e){x.onChange&&x.onChange(e.target.checked,i,l,s)}}),label:t,size:"small",sx:{"&:hover":{"& .MuiFormControlLabel-label":{color:"primary.main"}}}})})})},H=e=>{let{data:o,control:a,setValue:i,register:l,errors:s}=e,[r,c]=(0,t.useState)(!0);return i("emailDestinatario",o.email),(0,n.jsxs)("div",{className:"flex flex-col gap-2 pt-2",children:[r&&(0,n.jsx)(d.Z,{name:"emailDestinatario",type:"email",title:"E-mail do destinat\xe1rio",required:!0,control:a,errors:s.emailDestinatario}),(0,n.jsx)(d.Z,{name:"assunto",title:"Assunto",required:!0,register:l,control:a,defaultValue:"",errors:s.assunto}),(0,n.jsx)(d.Z,{name:"descricao",title:"Descri\xe7\xe3o",multiline:!0,rows:4,required:!0,control:a,defaultValue:"",errors:s.descricao}),(0,n.jsxs)(q.Z,{row:!0,children:[(0,n.jsx)(U,{name:"email",title:"E-mail",value:!0,register:l,onChange:()=>c(!r)}),(0,n.jsx)(U,{name:"alerta",title:"Alerta",value:!0,register:l})]})]})};var W=a(69418),K=a(44373);let X=e=>{let{values:o,handleFileSelect:a,handleRemove:i,loadingFile:l,disabled:s,errors:r}=e,{settings:d}=(0,t.useContext)(c.J6),x=d.mode,[m,p]=(0,t.useState)(null),h=(0,t.useRef)(null),v=e=>{h.current.click(),p(e)};return(0,t.useEffect)(()=>{h.current&&(h.current.value="")},[a]),(0,n.jsx)("div",{className:"flex flex-col gap-2",children:o&&o.map((e,t)=>(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(u.ZP,{container:!0,spacing:2,children:(0,n.jsx)(u.ZP,{item:!0,xs:12,sm:6,children:(0,n.jsxs)(L.Z,{display:"flex",alignItems:"center",sx:{gap:1},children:[(0,n.jsx)(b.Z,{color:"primary",variant:"subtitle1",sx:{fontWeight:700},children:e.nome}),(0,n.jsx)(b.Z,{variant:"body2",children:"(".concat(e.unidadeMedida,")")})]})})},t),e.produtoAnexosDescricao&&e.produtoAnexosDescricao.length>0&&(0,n.jsx)(u.ZP,{container:!0,spacing:4,children:e.produtoAnexosDescricao.map((e,o)=>(0,n.jsx)(j.Z,{modeTheme:x,handleFileClick:v,selectedItem:m,inputRef:h,item:e,loadingFile:l,indexBlock:t,indexItem:o,handleFileSelect:a,folder:"produto",handleRemove:i,error:r,disabled:s},"".concat(t,"-").concat(o)))}),e.anexos&&0===e.anexos.length&&(0,n.jsx)(b.Z,{variant:"body2",sx:{mb:2},children:"Este produto n\xe3o exige anexos"}),t<o.length-1&&(0,n.jsx)(K.Z,{sx:{my:4}})]}))})},Q=e=>{var o,a;let{id:x,makeFornecedor:m}=e,{user:p,loggedUnity:h}=(0,t.useContext)(O.V),[v,f]=(0,t.useState)(!1),[g,D]=(0,t.useState)(!1),[j,A]=(0,t.useState)(!1),[C,S]=(0,t.useState)(!1),[y,P]=(0,t.useState)(!1),[q,L]=(0,t.useState)(!1),[_,J]=(0,t.useState)(!0),[U,K]=(0,t.useState)(null),[Q,Y]=(0,t.useState)([]),[$,ee]=(0,t.useState)([]),[eo,ea]=(0,t.useState)(null),{createNewNotification:en}=(0,t.useContext)(G.u),[et,ei]=(0,t.useState)(!1),[el,es]=(0,t.useState)([]),[er,ed]=(0,t.useState)(null),[ec,eu]=(0,t.useState)([]),[ex,em]=(0,t.useState)(null),[ep,eh]=(0,t.useState)(""),[ev,ef]=(0,t.useState)(!1),[eg,eD]=(0,t.useState)(!1),[ej,eI]=(0,t.useState)({status:!1,errors:[]}),{settings:eZ}=(0,t.useContext)(c.J6),{setId:eb}=(0,t.useContext)(M.X),[eA,eC]=(0,t.useState)({status:!1,message:"Voc\xea n\xe3o tem permiss\xf5es",messageType:"info"}),eS=N(),ey=x&&x>0?"edit":"new",eF=eS.pathname,{reset:ew,register:eE,getValues:eP,setValue:eN,control:ez,watch:ek,handleSubmit:eR,clearErrors:eM,setError:eO,formState:{errors:eG}}=(0,i.cI)();console.log("formFornecedor errors: ",eG);let eB=async(e,o)=>{let a={status:e,observacao:o,auth:{usuarioID:p.usuarioID,papelID:p.papelID,unidadeID:h.unidadeID}};try{P(!0),await k.h.post("".concat(eF,"/changeFormStatus/").concat(x),a).then(o=>{T.ZP.success(z.OD.successUpdate),P(!1),e0(e,null,null)})}catch(n){console.log(n)}},eT=async e=>{try{if(!e.email&&!e.alerta)return T.ZP.error("Selecione ao menos um tipo de notifica\xe7\xe3o!");let o={titulo:e.assunto,descricao:e.descricao,url:"/formularios/fornecedor/",urlID:x,tipoNotificacaoID:3,usuarioGeradorID:p.usuarioID,usuarioID:0,unidadeID:U.fornecedor.unidadeID,papelID:2,email:e.email,alerta:e.alerta};if(console.log("\uD83D\uDE80 ~ data dat notifica\xe7\xe3o:",o),en(o),e.email){let a={values:e,auth:{id:x,usuarioID:p.usuarioID,papelID:p.papelID,unidadeID:h.unidadeID}};await k.h.post("".concat(eF,"/sendNotification"),a)}let n=e.alerta&&e.email?"E-mail e alerta enviados com sucesso!":e.alerta&&!e.email?"Alerta criado com sucesso!":!e.alerta&&e.email?"E-mail enviado com sucesso!":null;T.ZP.success(n)}catch(t){console.log(t)}},eV=()=>{navigator.clipboard.writeText(er),T.ZP.success("Link copiado com sucesso!")},eq={id:1,name:"Gerar novo formul\xe1rio",description:"Gerar um novo formul\xe1rio de preenchimento para este fornecedor.",component:(0,n.jsx)(W.Z,{cnpj:null==U?void 0:null===(o=U.fornecedor)||void 0===o?void 0:o.cnpj}),route:null,type:null,modal:!0,action:m,size:"lg",icon:"fluent:form-new-20-regular",identification:null},eL={id:2,name:"Gerar notifica\xe7\xe3o",description:"Gerar uma nova notifica\xe7\xe3o para o fornecedor, podendo ser um e-mail e/ou alerta do sistema.",component:(0,n.jsx)(H,{data:{email:null===(a=el.find(e=>"email"==e.nomeColuna))||void 0===a?void 0:a.email}}),route:null,type:null,modal:!0,action:eT,icon:"cil:bell",identification:null},e_={id:3,name:"Copiar link do formul\xe1rio",description:"Copiar o link deste formul\xe1rio.",component:(0,n.jsx)(W.Z,{}),route:null,type:null,action:eV,modal:!1,icon:"solar:copy-outline",identification:null},eJ={id:4,name:"Formul\xe1rio do fornecedor",type:"report",papelID:p.papelID,fornecedorID:x,unidadeID:h.unidadeID,icon:"fluent:print-24-regular"},eU=[];1==p.papelID&&eU.push(eq),eU.push(eL),eU.push(e_),eU.push(eJ);let eH=async()=>{try{await k.h.post("".concat(eF,"/verifyFormPending/").concat(x),{parFormularioID:1}).then(e=>{J(e.data) //! true/false
})}catch(e){console.log(e)}},eW=()=>{try{f(!0),k.h.post("".concat((0,z.g_)(eF),"/new/getData"),{unidadeID:h.unidadeID}).then(e=>{console.log("getNewData: ",e.data),es(e.data.fields),eu(e.data.blocos),eh(e.data.info),ew(e.data),eC({status:!0,message:'Esse formul\xe1rio j\xe1 foi conclu\xeddo! Para alter\xe1-lo \xe9 necess\xe1rio atualizar seu Status para "Em preenchimento" atrav\xe9s do bot\xe3o "Status"!',messageType:"info"}),f(!1)})}catch(e){console.log("\uD83D\uDE80 ~ error:",e)}},eK=()=>{f(!0),x&&k.h.post("".concat(eF,"/getData/").concat(x),{type:ey,unidadeID:h.unidadeID}).then(e=>{var o,a;console.log("getData: ",e.data),es(e.data.fields),Y(e.data.produtos),eu(e.data.blocos),ee(e.data.grupoAnexo),eh(e.data.info),K(e.data.unidade),ed(e.data.link),em(e.data.ultimaMovimentacao),ew(e.data),ea(z.WR[null==e?void 0:null===(o=e.data)||void 0===o?void 0:null===(a=o.info)||void 0===a?void 0:a.status]),eC({status:2==p.papelID&&e.data.info.status<40,message:2==p.papelID?"Esse formul\xe1rio j\xe1 foi conclu\xeddo e enviado pra f\xe1brica, n\xe3o \xe9 mais poss\xedvel alterar as informa\xe7\xf5es!":"Somente o fornecedor pode alterar as informa\xe7\xf5es deste formul\xe1rio!",messageType:2==p.papelID?"warning":"info"}),eH(),f(!1)})},eX=()=>{eM();let e=!1,o=[];null==el||el.forEach((a,n)=>{let t=a.tabela?"fields[".concat(n,"].").concat(a.tabela):"fields[".concat(n,"].").concat(a.nomeColuna),i=eP(t);1!==a.obrigatorio||i||(eO(t,{type:"manual",message:"Campo obrigat\xf3rio"}),o.push(null==a?void 0:a.nomeCampo),e=!0)}),Q&&Q.length>0&&Q.forEach((a,n)=>{a.produtoAnexosDescricao.forEach((t,i)=>{1===t.obrigatorio&&0==t.anexos.length&&(eO("produtos[".concat(n,"].produtoAnexosDescricao[").concat(i,"].anexos"),{type:"manual",message:"Campo obrigat\xf3rio"}),o.push("Anexo: ".concat(null==a?void 0:a.nome," / ").concat(null==t?void 0:t.nome)),e=!0)})}),ec.forEach((a,n)=>{a.itens.forEach((a,t)=>{console.log("\uD83D\uDE80 ~ checkErrors -> item: ",a);let i=eP("blocos[".concat(n,"].itens[").concat(t,"].resposta"));(null==a?void 0:a.obrigatorio)!==1||i||(eO("blocos[".concat(n,"].itens[").concat(t,"].resposta"),{type:"manual",message:"Campo obrigat\xe1rio"}),o.push(null==a?void 0:a.nome),e=!0),a.respostaConfig&&1==a.respostaConfig.anexo&&a.respostaConfig.anexosSolicitados.length>0&&a.respostaConfig.anexosSolicitados.forEach((i,l)=>{1==i.obrigatorio&&0==i.anexos.length&&(eO("blocos[".concat(n,"].itens[").concat(t,"].respostaConfig.anexosSolicitados[").concat(l,"].anexos"),{type:"manual",message:"Campo obrigat\xe1rio"}),o.push("Anexo: ".concat(null==a?void 0:a.nome," / ").concat(null==i?void 0:i.nome)),e=!0)})})}),$&&$.length>0&&$.forEach((a,n)=>{a.itens.forEach((t,i)=>{1===t.obrigatorio&&0==t.anexos.length&&(console.log("gera erro grupo"),eO("grupoAnexo[".concat(n,"].itens[").concat(i,"].anexos"),{type:"manual",message:"Campo obrigat\xe1rio"}),o.push("Anexo: ".concat(null==a?void 0:a.nome," / ").concat(null==t?void 0:t.nome)),e=!0)})}),eI({status:e,errors:o})},eQ=async e=>{if(9===e.length){let o=e.replace(/[^0-9]/g,"");try{let a=await k.h.get("https://viacep.com.br/ws/".concat(o,"/json/"));a.data.localidade?(el.forEach(async(e,o)=>{("logradouro"===e.nomeColuna||"bairro"===e.nomeColuna||"cidade"===e.nomeColuna||"estado"===e.nomeColuna)&&(await eN("fields[".concat(o,"].logradouro"),a.data.logradouro),await eN("fields[".concat(o,"].bairro"),a.data.bairro),await eN("fields[".concat(o,"].cidade"),a.data.localidade),await eN("fields[".concat(o,"].estado"),a.data.uf))}),T.ZP.success("Endere\xe7o encontrado!")):T.ZP.error("Endere\xe7o n\xe3o encontrado!")}catch(n){console.error(n)}}},eY=()=>{eX(),ef(!0),L(!0)},e$=async e=>{e.conclusion=!0,await eR(e1)(e)},e0=(e,o,a)=>{let n=30==e?"Em preenchimento":40==e?"Conclu\xeddo":50==e?"Reprovado":60==e?"Aprovado parcialmente":70==e?"Aprovado":"Pendente",t={titulo:"Formul\xe1rio de Fornecedor ".concat(n),descricao:"O formul\xe1rio de Fornecedor #".concat(x," est\xe1 ").concat(n,"."),url:"/formularios/fornecedor/",urlID:x,tipoNotificacaoID:6,usuarioGeradorID:p.usuarioID,usuarioID:0,unidadeID:h.unidadeID,papelID:1};if(t&&(en(t),o)){let i={titulo:"Fornecedor gerado",descricao:"O formul\xe1rio de Fornecedor #".concat(x," est\xe1 ").concat(n," e gerou uma n\xe3o conformidade."),url:"/formularios/fornecedor/nao-conformidade/",urlID:a,tipoNotificacaoID:5,usuarioGeradorID:p.usuarioID,usuarioID:0,unidadeID:h.unidadeID,papelID:1};en(i)}},e1=async function(e){let o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];!0===o.conclusion&&(e.status=p&&1==p.papelID?o.status:40,e.obsConclusao=o.obsConclusao);let a={form:e,auth:{usuarioID:p.usuarioID,papelID:p.papelID,unidadeID:h.unidadeID}};console.log("\uD83D\uDE80 ~ onSubmit: ",a);try{"edit"==ey?(P(!0),await k.h.post("".concat(eF,"/updateData/").concat(x),a).then(o=>{T.ZP.success(z.OD.successUpdate),P(!1);let a=null;o.data&&o.data.naoConformidade&&o.data.id>0&&(eS.push("/formularios/fornecedor/nao-conformidade/"),eb(o.data.id),a=o.data.id),e0(e.status,e.naoConformidade,a)})):"new"==ey?await k.h.post("".concat((0,z.g_)(eF),"/insertData"),a).then(e=>{eS.push("".concat((0,z.g_)(eF))),eb(e.data),T.ZP.success(z.OD.successNew)}):T.ZP.error(z.OD.error)}catch(n){console.log(n)}},e5=async(e,o)=>{A(!0);let a=e.target.files;if(a&&a.length>0){var n;let t=new FormData;for(let i=0;i<a.length;i++)t.append("files[]",a[i]);t.append("usuarioID",p.usuarioID),t.append("unidadeID",h.unidadeID),t.append("produtoAnexoID",null!==(n=o.produtoAnexoID)&&void 0!==n?n:null),await k.h.post("".concat(eF,"/saveAnexo/").concat(x,"/produto/").concat(p.usuarioID,"/").concat(U.unidadeID),t).then(e=>{A(!1),console.log("response: ",e.data),T.ZP.success("Anexo adicionado com sucesso!");let a=Q.map(a=>a.produtoID==o.produtoID?{...a,produtoAnexosDescricao:a.produtoAnexosDescricao.map(a=>a.produtoAnexoID==o.produtoAnexoID?{...a,anexos:[...a.anexos,...e.data]}:a)}:a);Y(a)}).catch(e=>{var o,a,n;A(!1),T.ZP.error(null!==(n=null===(o=e.response)||void 0===o?void 0:null===(a=o.data)||void 0===a?void 0:a.message)&&void 0!==n?n:"Erro ao atualizar anexo, tente novamente!")})}},e3=async(e,o)=>{D(!0);let a=e.target.files;if(a&&a.length>0){var n;let t=new FormData;for(let i=0;i<a.length;i++)t.append("files[]",a[i]);t.append("usuarioID",p.usuarioID),t.append("unidadeID",h.unidadeID),t.append("grupoAnexoItemID",null!==(n=o.grupoAnexoItemID)&&void 0!==n?n:null),await k.h.post("".concat(eF,"/saveAnexo/").concat(x,"/grupo-anexo/").concat(p.usuarioID,"/").concat(U.unidadeID),t).then(e=>{D(!1),T.ZP.success("Anexo adicionado com sucesso!");let a=$.map(a=>a.grupoAnexoID==o.grupoAnexoID?{...a,itens:a.itens.map(a=>a.grupoAnexoItemID==o.grupoAnexoItemID?{...a,anexos:[...a.anexos,...e.data]}:a)}:a);ee(a)}).catch(e=>{var o,a,n;D(!1),T.ZP.error(null!==(n=null===(o=e.response)||void 0===o?void 0:null===(a=o.data)||void 0===a?void 0:a.message)&&void 0!==n?n:"Erro ao atualizar anexo, tente novamente!")})}},e2=async(e,o)=>{S(!0);let a=e.target.files;if(a&&a.length>0){var n,t;let i=new FormData;for(let l=0;l<a.length;l++)i.append("files[]",a[l]);i.append("usuarioID",p.usuarioID),i.append("unidadeID",h.unidadeID),i.append("parFornecedorModeloBlocoID",null!==(n=o.parFornecedorModeloBlocoID)&&void 0!==n?n:null),i.append("itemOpcaoAnexoID",null!==(t=o.itemOpcaoAnexoID)&&void 0!==t?t:null),await k.h.post("".concat(eF,"/saveAnexo/").concat(x,"/item/").concat(p.usuarioID,"/").concat(U.unidadeID),i).then(e=>{S(!1),T.ZP.success("Anexo adicionado com sucesso!");let a=ec.map(a=>a.parFornecedorModeloBlocoID==o.parFornecedorModeloBlocoID?{...a,itens:a.itens.map(a=>({...a,respostaConfig:{...a.respostaConfig,anexosSolicitados:a.respostaConfig.anexosSolicitados.map(a=>a.itemOpcaoAnexoID==o.itemOpcaoAnexoID?{...a,anexos:[...a.anexos,...e.data]}:a)}}))}:a);eu(a)}).catch(e=>{var o,a,n;S(!1),T.ZP.error(null!==(n=null===(o=e.response)||void 0===o?void 0:null===(a=o.data)||void 0===a?void 0:a.message)&&void 0!==n?n:"Erro ao atualizar anexo, tente novamente!")})}},e4=async e=>{try{let o=await k.h.post("/cadastros/item/getItemConfigs",{itemID:e.itemID,alternativaItemID:e.alternativa.id}),a=ec.map(a=>({...a,itens:a.itens.map(a=>a.itemID==e.itemID?(console.log("setItemResposta IGUAL: ",a),{...a,respostaConfig:{...o.data}}):a)}));eu(a)}catch(n){console.log("error",n)}},e6=async e=>{console.log("\uD83D\uDE80 ~ item:",e),e&&await k.h.delete("".concat(eF,"/deleteAnexo/").concat(x,"/").concat(e.anexoID,"/").concat(U.unidadeID,"/").concat(p.usuarioID,"/produto")).then(e=>{T.ZP.success("Anexo removido com sucesso!");let o=e.data,a=Q.map(e=>({...e,produtoAnexosDescricao:e.produtoAnexosDescricao.map(e=>({...e,anexos:e.anexos.filter(e=>e.anexoID!=o)}))}));Y(a)}).catch(e=>{var o,a,n;T.ZP.error(null!==(n=null===(o=e.response)||void 0===o?void 0:null===(a=o.data)||void 0===a?void 0:a.message)&&void 0!==n?n:"Erro ao remover anexo, tente novamente!")})},e7=async e=>{e&&await k.h.delete("".concat(eF,"/deleteAnexo/").concat(x,"/").concat(e.anexoID,"/").concat(U.unidadeID,"/").concat(p.usuarioID,"/grupo-anexo")).then(e=>{T.ZP.success("Anexo removido com sucesso!");let o=e.data,a=$.map(e=>({...e,itens:e.itens.map(e=>({...e,anexos:e.anexos.filter(e=>e.anexoID!=o)}))}));ee(a)}).catch(e=>{var o,a,n;T.ZP.error(null!==(n=null===(o=e.response)||void 0===o?void 0:null===(a=o.data)||void 0===a?void 0:a.message)&&void 0!==n?n:"Erro ao remover anexo, tente novamente!")})},e8=async e=>{e&&await k.h.delete("".concat(eF,"/deleteAnexo/").concat(x,"/").concat(e.anexoID,"/").concat(U.unidadeID,"/").concat(p.usuarioID,"/item")).then(e=>{T.ZP.success("Anexo removido com sucesso!");let o=e.data,a=ec.map(e=>({...e,itens:e.itens.map(e=>({...e,respostaConfig:{...e.respostaConfig,anexosSolicitados:e.respostaConfig.anexosSolicitados.map(e=>({...e,anexos:e.anexos.filter(e=>e.anexoID!=o)}))}}))}));eu(a)}).catch(e=>{var o,a,n;T.ZP.error(null!==(n=null===(o=e.response)||void 0===o?void 0:null===(a=o.data)||void 0===a?void 0:a.message)&&void 0!==n?n:"Erro ao remover anexo, tente novamente!")})};return(0,t.useEffect)(()=>{"new"==ey?eW():eK()},[x,y]),(0,t.useEffect)(()=>{eX()},[]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(B.Z,{show:v}),(0,n.jsxs)("form",{onSubmit:eR(e1),children:[!eA.status&&(0,n.jsx)(w.Z,{severity:"warning",sx:{mb:2},children:eA.message}),ex&&(0,n.jsxs)(w.Z,{severity:"info",sx:{mb:2},children:["\xdaltima movimenta\xe7\xe3o: Profissional ".concat(ex.nome," do(a) ").concat(ex.nomeFantasia," movimentou o formul\xe1rio de ").concat(ex.statusAnterior," para ").concat(ex.statusAtual," em ").concat(ex.dataHora,"."),ex.observacao&&(0,n.jsxs)("p",{children:[(0,n.jsx)("br",{}),'Mensagem: "',ex.observacao,'"']})]}),(0,n.jsxs)(I.Z,{children:[(0,n.jsx)(R.Z,{btnCancel:!0,btnSave:2==p.papelID&&ep.status<40,btnSend:1==p.papelID&&"edit"==ey&&ep.status>=40||2==p.papelID&&ep.status<40,btnPrint:"edit"==ey,actionsData:eU,actions:!0,handleSubmit:()=>eR(e1),handleSend:eY,iconConclusion:"mdi:check-bold",titleConclusion:"Concluir Formul\xe1rio",title:"Fornecedor",btnStatus:"edit"==ey,handleBtnStatus:()=>ei(!0),type:ey,status:eo}),(0,n.jsx)(Z.Z,{children:(0,n.jsx)(l.Z,{register:eE,errors:eG,setValue:eN,control:ez,fields:el,values:el,getAddressByCep:eQ,disabled:!eA.status})})]}),U&&(null==U?void 0:U.obrigatorioProdutoFornecedor)&&Q&&Q.length>0&&(0,n.jsx)(I.Z,{sx:{mt:4},children:(0,n.jsx)(Z.Z,{children:(0,n.jsx)(X,{values:Q,handleFileSelect:e5,handleRemove:e6,loadingFile:j,disabled:!eA.status,errors:null==eG?void 0:eG.produtos},j)})}),ec&&ec.map((e,o)=>(0,n.jsx)(s.Z,{index:o,blockKey:"parFornecedorModeloBlocoID",handleFileSelect:e2,setItemResposta:e4,handleRemoveAnexoItem:e8,setBlocos:eu,values:e,control:ez,register:eE,setValue:eN,errors:null==eG?void 0:eG.blocos,disabled:!eA.status},o)),$&&$.map((e,o)=>(0,n.jsx)(F,{values:{grupo:e,loadingFile:g,indexGrupo:o,handleFileSelect:e3,handleRemove:e7,folder:"grupo-anexo",disabled:!eA.status,error:eG}},o)),ep&&(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(I.Z,{sx:{mt:4},children:(0,n.jsx)(Z.Z,{children:(0,n.jsx)(u.ZP,{container:!0,spacing:4,children:(0,n.jsx)(u.ZP,{item:!0,xs:12,md:12,children:(0,n.jsxs)(E.Z,{fullWidth:!0,children:[(0,n.jsx)(b.Z,{variant:"subtitle1",sx:{fontWeight:600,mb:2},children:"Observa\xe7\xf5es (campo de uso exclusivo da validadora)"}),(0,n.jsx)(d.Z,{title:"Observa\xe7\xe3o (opcional)",name:"info.obs",multiline:!0,rows:4,value:ep.obs,disabled:!eA.status,control:ez})]})})})})})}),et&&(0,n.jsx)(r.Z,{title:"Hist\xf3rico do Formul\xe1rio",text:"Listagem do hist\xf3rico das movimenta\xe7\xf5es do formul\xe1rio ".concat(x," do Fornecedor."),id:x,parFormularioID:1,formStatus:ep.status,hasFormPending:_,canChangeStatus:1==p.papelID&&!_&&ep.status>30,openModal:et,handleClose:()=>ei(!1),btnCancel:!0,btnConfirm:!0,handleSubmit:eB}),(0,n.jsx)(V.Z,{openModal:ev,handleClose(){ef(!1),L(!1)},title:"Concluir Formul\xe1rio",text:"Deseja realmente concluir este formul\xe1rio?",info:ep,canChange:!_,register:eE,setValue:eN,getValues:eP,btnCancel:!0,btnConfirm:!0,btnConfirmColor:"primary",conclusionForm:e$,listErrors:ej})]})]})};var Y=Q}}]);