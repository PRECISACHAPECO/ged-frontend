"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2350],{82350:function(e,o,s){s.d(o,{Z:function(){return N}});var t=s(85893),a=s(11163),l=s.n(a),i=s(67294),n=s(60565),r=s(83830),d=s(60664),c=s(49837),u=s(91359),x=s(79072),m=s(44373),v=s(87536),p=s(86501),f=s(47842),h=s(45061),j=s(86887),g=s(46749),Z=s(29308),b=s(84220),D=s(67569),y=s(40039),w=s(29630),C=s(61953),I=s(54225),S=s(3893),F=s(88475);let A=e=>{var o,s,a,l,i;let{data:n,index:r,indexAnexo:d,handleRemoveAnexo:c,control:u,register:x,errors:m}=e;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Z.Z,{xs:12,md:9,title:"Nome",name:"fields.opcoes[".concat(r,"].anexos[").concat(d,"].nome"),required:!0,control:u,errors:null==m?void 0:null===(o=m.fields)||void 0===o?void 0:null===(s=o.opcoes)||void 0===s?void 0:null===(a=s[r])||void 0===a?void 0:null===(l=a.anexos)||void 0===l?void 0:null===(i=l[d])||void 0===i?void 0:i.nome}),(0,t.jsx)(S.Z,{xs:6,md:2,title:"Obrigat\xf3rio",name:"fields.opcoes[".concat(r,"].anexos[").concat(d,"].obrigatorio"),value:n.obrigatorio,register:x}),(0,t.jsx)(F.Z,{xs:6,md:1,title:0==d?"Remover":"",index:r,removeItem:()=>c(n,r,d),item:n,pending:!1,textSuccess:"Remover este anexo",textError:"Este anexo n\xe3o pode mais ser removido pois possui v\xednculo atrelado a ele"})]})};var P=s(21609);s(74865);let k=e=>{let{data:o,addAnexo:s,register:a,control:l,errors:n,handleRemoveAnexo:r,getValues:d,watch:m}=e,[v,p]=(0,i.useState)(!1),[f,h]=(0,i.useState)((()=>{let e=[];return o&&o.map(o=>{e.push(1==o.anexo)}),e})()),j=e=>{let o=[...f];o[e]=!o[e],h(o)};return o&&o.map((e,o)=>(0,t.jsx)(c.Z,{sx:{mt:3},children:(0,t.jsxs)(u.Z,{children:[(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(w.Z,{variant:"h6",sx:{my:3},children:(0,t.jsxs)(C.Z,{display:"flex",alignItems:"center",sx:{gap:2},children:[(0,t.jsx)(P.Z,{icon:"akar-icons:edit"}),(0,t.jsx)("p",{children:e.nome})]})}),(0,t.jsxs)(C.Z,{display:"flex",alignItems:"center",sx:{gap:4},children:[(0,t.jsx)(C.Z,{children:(0,t.jsx)(S.Z,{title:"Solicita anexo",name:"fields.opcoes[".concat(o,"].anexo"),onClick:()=>j(o),value:e.anexo,register:a})}),(0,t.jsx)(C.Z,{children:(0,t.jsx)(S.Z,{title:"Gera N\xe3o Conformidade (NC)",name:"fields.opcoes[".concat(o,"].bloqueiaFormulario"),value:e.bloqueiaFormulario,register:a,helpText:"Se marcada esta resposta, bloqueia a aprova\xe7\xe3o do formul\xe1rio e obrigatoriamente gera uma n\xe3o conformidade (Plano de a\xe7\xe3o)"})}),(0,t.jsx)(C.Z,{children:(0,t.jsx)(S.Z,{title:"Observa\xe7\xe3o",name:"fields.opcoes[".concat(o,"].observacao"),value:e.observacao,register:a})})]})]}),f[o]&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(w.Z,{variant:"body1",sx:{my:3},children:"Anexos do item"}),(0,t.jsx)(x.ZP,{container:!0,spacing:4,children:e.anexos.map((e,s)=>(0,t.jsx)(A,{index:o,indexAnexo:s,data:e,control:l,handleRemoveAnexo:r,register:a,errors:n},v))}),(0,t.jsx)(C.Z,{sx:{mt:3},children:(0,t.jsx)(I.Z,{type:"button",variant:"outlined",startIcon:(0,t.jsx)(P.Z,{icon:"material-symbols:add-circle-outline-rounded"}),onClick:()=>s(o),children:"Inserir"})})]})]})}))};var q=s(41088);let E=e=>{var o,s,a,w,C,I,S,F,A,P,E,N;let{id:O,btnClose:R,handleModalClose:_,setNewChange:V,newChange:T,outsideID:M,handleConfirmNew:U,manualUrl:z}=e,[G,X]=(0,i.useState)(!1),[B,H]=(0,i.useState)(!1),[J,K]=(0,i.useState)(null),L=l(),Q=O&&O>0?"edit":"new",W=L.pathname,{title:Y}=(0,i.useContext)(n.f),{setId:$}=(0,i.useContext)(r.X),{loggedUnity:ee,user:eo}=(0,i.useContext)(y.V);console.log("\uD83D\uDE80 ~ user:",eo);let{startLoading:es,stopLoading:et}=(0,q.Z)(),{trigger:ea,handleSubmit:el,watch:ei,getValues:en,setValue:er,reset:ed,control:ec,formState:{errors:eu},register:ex}=(0,v.cI)(),em=async e=>{es();let o={...e,usuarioID:eo.usuarioID,unidadeID:ee.unidadeID};try{"new"===Q?await d.h.post("cadastros/item/new/insertData",o).then(e=>{M?($(M),U(e.data)):(L.push("".concat((0,g.g_)(W))),$(e.data)),p.ZP.success(g.OD.successNew)}):"edit"===Q&&(await d.h.post("/cadastros/item/updateData/".concat(O),o),p.ZP.success(g.OD.successUpdate),ep()),setSavingForm(!savingForm)}catch(s){s.response&&409===s.response.status?p.ZP.error(g.OD.errorRepeated):console.log(s)}finally{et()}},ev=async()=>{try{await d.h.delete("".concat(W,"/").concat(O,"/").concat(eo.usuarioID,"/").concat(ee.unidadeID)),$(null),X(!1),p.ZP.success(g.OD.successDelete)}catch(e){e.response&&409===e.response.status?(p.ZP.error(g.OD.pendingDelete),X(!1)):console.log(e)}},ep=async()=>{try{await d.h.post("new"===Q?"cadastros/item/new/getData":"cadastros/item/getData/".concat(O)).then(e=>{K(e.data),ed(e.data)})}catch(e){console.log(e)}},ef=e=>{let o=[...en("fields.opcoes")];o[e].anexos.push({nome:"",obrigatorio:!1});let s={...J,fields:{...J.fields,opcoes:o}};K(s),er("fields.opcoes",o)},eh=async e=>{try{let o=await d.h.post("cadastros/item/getAlternatives",{alternativa:e});o.data&&(H(!B),er("fields.opcoes",o.data),K({...J,fields:{...J.fields,opcoes:o.data}}))}catch(s){console.log(s)}},ej=(e,o,s)=>{let t=[...en("fields.opcoes")];t[o].anexos.splice(s,1);let a={...J,fields:{...J.fields,opcoes:t}};K(a),er("fields.opcoes",t),H(!B)};return(0,i.useEffect)(()=>{ep(),"new"===Q&&setTimeout(()=>{ea()},300)},[O]),(0,i.useEffect)(()=>{T&&el(em)()},[T]),(0,t.jsxs)(t.Fragment,{children:[!J&&(0,t.jsx)(f.Z,{}),J&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("form",{onSubmit:el(em),id:"formItem",children:[(0,t.jsx)(j.Z,{btnCancel:!0,btnNew:!0,btnSave:!0,manualUrl:z,btnClose:R,handleModalClose:_,handleSubmit:()=>el(em),btnDelete:"edit"===Q,onclickDelete:()=>X(!0),type:Q,outsideID:M}),(0,t.jsx)(c.Z,{children:(0,t.jsx)(u.Z,{children:(0,t.jsxs)(x.ZP,{container:!0,spacing:5,children:[(0,t.jsx)(b.Z,{xs:12,md:11,title:"Formul\xe1rios",name:"fields.formulario",value:null==J?void 0:null===(o=J.fields)||void 0===o?void 0:o.formulario,required:!0,options:null==J?void 0:null===(s=J.fields)||void 0===s?void 0:null===(a=s.formulario)||void 0===a?void 0:a.opcoes,register:ex,setValue:er,control:ec,errors:null==eu?void 0:null===(w=eu.fields)||void 0===w?void 0:w.formulario}),(0,t.jsx)(D.Z,{xs:1,md:1,title:"Ativo",name:"fields.status",value:null==J?void 0:null===(C=J.fields)||void 0===C?void 0:C.status,typePage:Q,register:ex}),(0,t.jsx)(Z.Z,{xs:12,md:12,title:"Nome",name:"fields.nome",required:!0,control:ec,errors:null==eu?void 0:null===(I=eu.fields)||void 0===I?void 0:I.nome}),(0,t.jsx)(b.Z,{xs:12,md:12,title:"Alternativa",name:"fields.alternativa",value:null==J?void 0:null===(S=J.fields)||void 0===S?void 0:S.alternativa,onChange:eh,required:!0,options:null==J?void 0:null===(F=J.fields)||void 0===F?void 0:null===(A=F.alternativa)||void 0===A?void 0:A.opcoes,register:ex,setValue:er,control:ec,errors:null==eu?void 0:null===(P=eu.fields)||void 0===P?void 0:P.alternativa}),(0,t.jsx)(Z.Z,{xs:12,md:12,multiline:!0,rows:4,title:"Ajuda do item (mostrado em (?))",name:"fields.ajuda",control:ec,errors:null==eu?void 0:null===(E=eu.fields)||void 0===E?void 0:E.ajuda}),(0,t.jsx)(m.Z,{})]})})})]}),(0,t.jsx)(k,{data:null==J?void 0:null===(N=J.fields)||void 0===N?void 0:N.opcoes,handleRemoveAnexo:ej,register:ex,control:ec,errors:eu,getValues:en,addAnexo:ef,watch:ei},B)]}),(0,t.jsx)(h.Z,{text:"Tem certeza que deseja excluir?",title:"Excluir "+Y.title,openModal:G,handleClose:()=>X(!1),handleSubmit:ev,btnCancel:!0,btnConfirm:!0})]})};var N=E}}]);