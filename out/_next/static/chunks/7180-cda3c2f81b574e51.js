"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7180],{69418:function(e,o,a){a.d(o,{Z:function(){return j}});var t=a(85893),n=a(44642),l=a(79072),i=a(61953),s=a(49837),r=a(91359),d=a(29630),c=a(67294),u=a(40039),x=a(82747),m=a(60664),p=a(29308),h=a(84220);let v=e=>{var o,a,n,l,s,r,x,v;let{fields:f,setFields:g,handleCnpj:j,validCnpj:D,getValues:I,control:b,errors:Z,setValue:y,register:A,reset:C}=e,{loggedUnity:S}=(0,c.useContext)(u.V),[F,w]=(0,c.useState)([]),[E,P]=(0,c.useState)([]),[N,G]=(0,c.useState)([]),W=async()=>{let e=await m.h.post("/formularios/fornecedor/getModels",{unidadeID:S.unidadeID});w(e.data)},z=async()=>{let e=await m.h.post("/formularios/fornecedor/getProducts",{unidadeID:S.unidadeID});P(e.data)},R=async()=>{let e=await m.h.post("/formularios/fornecedor/getGruposAnexo",{unidadeID:S.unidadeID});G(e.data)},T=()=>{g(null),y("fields.cnpj",""),y("fields.razaoSocial",""),y("fields.email",""),y("fields.modelo",null),y("fields.gruposAnexo",[]),y("fields.produtos",[])};return(0,c.useEffect)(()=>{C(),W(),z(),R()},[]),F&&E&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(i.Z,{children:[(0,t.jsx)(p.Z,{xs:12,md:12,title:"CNPJ",name:"fields.cnpj",value:null==f?void 0:f.cnpj,onChange:j,clearField:I("fields.cnpj")?T:null,mask:"cnpj",required:!0,control:b,errors:null==Z?void 0:null===(o=Z.fields)||void 0===o?void 0:o.cnpj}),!1==D&&(0,t.jsx)(d.Z,{variant:"body2",color:"error",children:"CNPJ inv\xe1lido!"})]}),(0,t.jsx)(p.Z,{xs:12,md:12,title:"Raz\xe3o Social",name:"fields.razaoSocial",value:null==f?void 0:f.razaoSocial,disabled:!D,required:!0,control:b,errors:null==Z?void 0:null===(a=Z.fields)||void 0===a?void 0:a.razaoSocial}),(0,t.jsx)(p.Z,{xs:12,md:12,type:"email",title:"E-mail",name:"fields.email",value:null==f?void 0:f.email,disabled:!D,required:!0,control:b,errors:null==Z?void 0:null===(n=Z.fields)||void 0===n?void 0:n.email}),(0,t.jsx)(h.Z,{xs:12,md:12,title:"Modelo de Formul\xe1rio",name:"fields.modelo",options:F,required:!0,value:null==f?void 0:f.modelo,disabled:!D,register:A,setValue:y,control:b,errors:null==Z?void 0:null===(l=Z.fields)||void 0===l?void 0:l.modelo}),(0,t.jsx)(h.Z,{xs:12,md:12,title:"Grupos de Anexo",multiple:!0,name:"fields.gruposAnexo",value:null!==(x=null==f?void 0:f.gruposAnexo)&&void 0!==x?x:[],disabled:!D,options:null!=N?N:[],register:A,setValue:y,control:b,errors:null==Z?void 0:null===(s=Z.fields)||void 0===s?void 0:s.gruposAnexo}),(0,t.jsx)(h.Z,{xs:12,md:12,title:"Produtos",name:"fields.produtos",value:null!==(v=null==f?void 0:f.produtos)&&void 0!==v?v:[],disabled:!D,multiple:!0,required:!0,options:null!=E?E:[],register:A,setValue:y,control:b,errors:null==Z?void 0:null===(r=Z.fields)||void 0===r?void 0:r.produtos})]})};a(86501);var f=a(34175);let g=e=>{var o,a,p,h,g,j;let{cnpj:D,control:I,setValue:b,register:Z,errors:y,reset:A,getValues:C}=e,[S,F]=(0,c.useState)(!1),{loggedUnity:w}=(0,c.useContext)(u.V),[E,P]=(0,c.useState)(null),[N,G]=(0,c.useState)(null),W=e=>{console.log("\uD83D\uDE80 ~ handleCnpj:",e),18==e.length?(0,x.zk)(e)?(G(!0),z(e)):G(!1):(G(null),P(null))},z=async e=>{try{let o=await m.h.post("/formularios/fornecedor/cnpj",{unidadeID:w.unidadeID,cnpj:e}),a={new:o.data.new,fornecedorID:o.data.fornecedorID,data:o.data.dataAvaliacao,modelo:o.data.modelo.nome,produtos:o.data.produtos,gruposAnexo:o.data.gruposAnexo},t=await R(e);P({...E,cnpj:(0,f.PK)(t.data.CNPJ),status:t.data.STATUS,dataAbertura:t.data["DATA ABERTURA"],telefone:t.data.DDD+" "+t.data.TELEFONE,razaoSocial:t.data["RAZAO SOCIAL"],nomeFantasia:t.data["NOME FANTASIA"],email:t.data.EMAIL,cidade:t.data.MUNICIPIO+"/"+t.data.UF,preenchimento:a}),b("fields.cnpj",e),b("fields.razaoSocial",t.data["RAZAO SOCIAL"]),b("fields.nome",t.data["NOME FANTASIA"]),b("fields.email",t.data.EMAIL),b("fields.modelo",o.data.modelo.id>0?o.data.modelo:null),b("fields.gruposAnexo",o.data.gruposAnexo),b("fields.produtos",o.data.produtos)}catch(n){console.error(n)}},R=async e=>{let o=e.replace(/\D/g,""),a=await m.h.get("https://api-publica.speedio.com.br/buscarcnpj?cnpj=".concat(o));return a};return(0,c.useEffect)(()=>{F(!S),D&&D.length>0&&W(D)},[]),(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(n.Z,{children:(0,t.jsxs)(l.ZP,{container:!0,spacing:4,children:[(0,t.jsx)(l.ZP,{item:!0,xs:12,md:6,children:(0,t.jsx)(i.Z,{display:"flex",flexDirection:"column",sx:{gap:4},children:(0,t.jsx)(v,{setFields:P,fields:null!=E?E:null,control:I,errors:y,reset:A,setValue:b,getValues:C,register:Z,handleCnpj:W,validCnpj:N},S)})}),(0,t.jsxs)(l.ZP,{item:!0,xs:12,md:6,children:[(0,t.jsx)(s.Z,{children:(0,t.jsx)(r.Z,{children:(0,t.jsxs)(i.Z,{display:"flex",flexDirection:"column",sx:{gap:4},children:[(0,t.jsx)(d.Z,{variant:"body2",children:(0,t.jsx)("strong",{children:"Dados consultados da Receita Federal"})}),(0,t.jsxs)(d.Z,{variant:"caption",children:[(0,t.jsx)("strong",{children:"Raz\xe3o Social:"})," ",null==E?void 0:E.razaoSocial]}),(0,t.jsxs)(d.Z,{variant:"caption",children:[(0,t.jsx)("strong",{children:"Nome Fantasia:"})," ",null==E?void 0:E.razaoSocial]}),(0,t.jsxs)(d.Z,{variant:"caption",children:[(0,t.jsx)("strong",{children:"CNPJ:"})," ",null==E?void 0:E.cnpj]}),(0,t.jsxs)(d.Z,{variant:"caption",children:[(0,t.jsx)("strong",{children:"Status:"})," ",null==E?void 0:E.status]}),(0,t.jsxs)(d.Z,{variant:"caption",children:[(0,t.jsx)("strong",{children:"Data Abertura:"})," ",null==E?void 0:E.dataAbertura]}),(0,t.jsxs)(d.Z,{variant:"caption",children:[(0,t.jsx)("strong",{children:"Telefone:"})," ",null==E?void 0:E.telefone]}),(0,t.jsxs)(d.Z,{variant:"caption",children:[(0,t.jsx)("strong",{children:"E-mail:"})," ",null==E?void 0:E.email]}),(0,t.jsxs)(d.Z,{variant:"caption",children:[(0,t.jsx)("strong",{children:"Cidade:"})," ",null==E?void 0:E.cidade]})]})})}),(0,t.jsx)(s.Z,{sx:{mt:4},children:(0,t.jsx)(r.Z,{children:(0,t.jsxs)(i.Z,{display:"flex",flexDirection:"column",sx:{gap:4},children:[(0,t.jsx)(d.Z,{variant:"body2",children:(0,t.jsx)("strong",{children:"Dados do \xfaltimo formul\xe1rio deste fornecedor"})}),(null==E?void 0:null===(o=E.preenchimento)||void 0===o?void 0:o.new)?(0,t.jsx)(d.Z,{variant:"body2",color:"primary",children:(0,t.jsx)("strong",{children:"Novo fornecedor"})}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(d.Z,{variant:"caption",children:[(0,t.jsx)("strong",{children:"ID: "})," ",null==E?void 0:null===(a=E.preenchimento)||void 0===a?void 0:a.fornecedorID]}),(0,t.jsxs)(d.Z,{variant:"caption",children:[(0,t.jsx)("strong",{children:"Data de preenchimento:"})," ",null==E?void 0:null===(p=E.preenchimento)||void 0===p?void 0:p.data]}),(0,t.jsxs)(d.Z,{variant:"caption",children:[(0,t.jsx)("strong",{children:"Modelo:"})," ",null==E?void 0:null===(h=E.preenchimento)||void 0===h?void 0:h.modelo]}),(0,t.jsxs)(d.Z,{variant:"caption",children:[(0,t.jsx)("strong",{children:"Grupos de anexo: "}),null==E?void 0:null===(g=E.preenchimento)||void 0===g?void 0:g.gruposAnexo.map((e,o)=>{var a;return"".concat(e.nome).concat(o<(null==E?void 0:null===(a=E.preenchimento)||void 0===a?void 0:a.gruposAnexo.length)-1?", ":"")})]}),(0,t.jsxs)(d.Z,{variant:"caption",children:[(0,t.jsx)("strong",{children:"Produtos: "}),null==E?void 0:null===(j=E.preenchimento)||void 0===j?void 0:j.produtos.map((e,o)=>{var a;return"".concat(e.nome).concat(o<(null==E?void 0:null===(a=E.preenchimento)||void 0===a?void 0:a.produtos.length)-1?", ":"")})]})]})]})})})]})]})})})};var j=g},47180:function(e,o,a){a.d(o,{Z:function(){return $}});var t=a(85893),n=a(67294),l=a(87536),i=a(56531),s=a(79139),r=a(34282);a(96351);var d=a(29308),c=a(66136),u=a(79072),x=a(72389),m=a(80562),p=a(21609),h=a(10179),v=a(42107),f=a(73731),g=a(53934);let j=e=>{var o;let{key:a,item:n,handleFileClick:l,indexGrupo:i,indexItem:s,selectedItem:r,handleFileSelect:d,handleRemove:c,loadingFile:j,folder:D,error:I,disabled:b,modeTheme:Z,inputRef:y}=e;return console.log("\uD83D\uDE80 ~ AnexoGrid item:",n),(0,t.jsx)(u.ZP,{item:!0,xs:12,md:3,children:(0,t.jsxs)("div",{className:"".concat((null==I?void 0:I[a])?"border border-red-500":"dark"===Z?"bg-[#202023]":"bg-[#F6F6F8]"," rounded-lg flex flex-col relative z-10"),children:[(0,t.jsx)("div",{className:"flex items-center justify-center p-2 mt-1 ",children:(0,t.jsx)("p",{className:"font-medium text-sm ",children:n.nome})}),(0,t.jsx)("div",{className:"flex justify-center items-center cursor-pointer p-1 h-[100px] w-full ",disabled:b,onClick(){n.anexo&&n.anexo.path&&n.anexo.exist?window.open(n.anexo.path,"_blank"):b||l(n)},children:(0,t.jsxs)("div",{className:"flex p-1 justify-center items-center gap-2 rounded-lg w-full h-full m-3 border-2 border-dashed hover:border-[#4A8B57] transition-colors ".concat("dark"===Z?" border-[#27272a]":"rgba(76, 78, 100, 0.12)"),children:[r&&r.grupoAnexoItemID==n.grupoAnexoItemID&&(0,t.jsx)(f.Z,{show:j,title:"Enviando anexo..."}),(0,t.jsx)("div",{className:"flex items-center gap-3",children:n.anexo&&n.anexo.exist?(0,t.jsx)("div",{children:(0,t.jsxs)("div",{className:"flex flex-col items-center gap-1",children:[(0,t.jsx)(v.Z,{data:n.anexo}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsxs)("p",{className:"text-sm opacity-80",children:[n.anexo.nome,(0,t.jsx)("span",{className:"text-xs opacity-50 ml-1",children:"(".concat((n.anexo.size/1024/1024).toFixed(2),"MB)")})]}),n.descricao&&(0,t.jsx)(g.Z,{text:n.descricao})]}),(0,t.jsx)("p",{className:"text-xs opacity-50",children:new Date(n.anexo.time).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})})]})}):(0,t.jsxs)("div",{className:"flex flex-col items-center gap-1",children:[(0,t.jsx)(h.Z,{className:"w-8 h-8 ".concat(n.anexo&&n.anexo.exist?"fill-[#666CFF]":"fill-current")}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)("h6",{className:"text-sm font-normal opacity-80",children:"Adicione um arquivo"}),n.descricao&&(0,t.jsx)(g.Z,{text:n.descricao})]})]})})]})}),(0,t.jsx)("div",{className:"flex items-center justify-between gap-1 p-2 py-3 pl-4",children:(0,t.jsx)(x.Z,{title:1==n.hasPending?"Este item n\xe3o pode mais ser removido pois j\xe1 foi respondido em um formul\xe1rio":"Remover este item",children:(0,t.jsx)(m.Z,{color:"error",onClick:()=>c(n),disabled:!(null===(o=n.anexo)||void 0===o?void 0:o.exist)||b,children:(0,t.jsx)(p.Z,{icon:"tabler:trash-filled"})})})}),(0,t.jsx)("input",{type:"file",ref:y,style:{display:"none"},onChange:e=>d(e,r,D)})]})})};a(88475);var D=a(92945),I=a(49837),b=a(91359),Z=a(29630),y=a(85390),A=a(87054),C=function(e){return(0,t.jsx)("svg",{fill:"currentColor",viewBox:"0 0 16 16",height:"1em",width:"1em",...e,children:(0,t.jsx)("path",{fillRule:"evenodd",d:"M2.5 12a.5.5 0 01.5-.5h10a.5.5 0 010 1H3a.5.5 0 01-.5-.5zm0-4a.5.5 0 01.5-.5h10a.5.5 0 010 1H3a.5.5 0 01-.5-.5zm0-4a.5.5 0 01.5-.5h10a.5.5 0 010 1H3a.5.5 0 01-.5-.5z"})})},S=function(e){return(0,t.jsx)("svg",{fill:"currentColor",viewBox:"0 0 16 16",height:"1em",width:"1em",...e,children:(0,t.jsx)("path",{d:"M1 2.5A1.5 1.5 0 012.5 1h3A1.5 1.5 0 017 2.5v3A1.5 1.5 0 015.5 7h-3A1.5 1.5 0 011 5.5v-3zM2.5 2a.5.5 0 00-.5.5v3a.5.5 0 00.5.5h3a.5.5 0 00.5-.5v-3a.5.5 0 00-.5-.5h-3zm6.5.5A1.5 1.5 0 0110.5 1h3A1.5 1.5 0 0115 2.5v3A1.5 1.5 0 0113.5 7h-3A1.5 1.5 0 019 5.5v-3zm1.5-.5a.5.5 0 00-.5.5v3a.5.5 0 00.5.5h3a.5.5 0 00.5-.5v-3a.5.5 0 00-.5-.5h-3zM1 10.5A1.5 1.5 0 012.5 9h3A1.5 1.5 0 017 10.5v3A1.5 1.5 0 015.5 15h-3A1.5 1.5 0 011 13.5v-3zm1.5-.5a.5.5 0 00-.5.5v3a.5.5 0 00.5.5h3a.5.5 0 00.5-.5v-3a.5.5 0 00-.5-.5h-3zm6.5.5A1.5 1.5 0 0110.5 9h3a1.5 1.5 0 011.5 1.5v3a1.5 1.5 0 01-1.5 1.5h-3A1.5 1.5 0 019 13.5v-3zm1.5-.5a.5.5 0 00-.5.5v3a.5.5 0 00.5.5h3a.5.5 0 00.5-.5v-3a.5.5 0 00-.5-.5h-3z"})})};let F=e=>{let{values:o}=e,[a,l]=(0,n.useState)(null);console.log("\uD83D\uDE80 ~ selectedItem:",a);let{settings:i}=(0,n.useContext)(c.J6),s=i.mode,r=(0,n.useRef)(null),d=e=>{r.current.click(),l(e)};(0,n.useEffect)(()=>{r.current.value=""},[o.handleFileSelect]);let[x,m]=(0,n.useState)("list"),p=(e,o)=>{m(o)};return(0,t.jsx)(I.Z,{sx:{mt:4},children:(0,t.jsxs)(b.Z,{children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,t.jsxs)(Z.Z,{variant:"subtitle1",sx:{fontWeight:600},children:[o.grupo.nome,(0,t.jsx)(Z.Z,{variant:"body2",sx:{mb:2},children:o.grupo.descricao})]}),(0,t.jsx)("div",{children:(0,t.jsxs)(y.Z,{exclusive:!0,color:"primary",value:x,onChange:p,children:[(0,t.jsx)(A.Z,{value:"list",children:(0,t.jsx)(C,{})}),(0,t.jsx)(A.Z,{value:"grid",children:(0,t.jsx)(S,{})})]})})]}),(0,t.jsx)(u.ZP,{container:!0,spacing:4,children:o.grupo.itens.map((e,n)=>"list"===x?(0,t.jsx)(D.Z,{modeTheme:s,handleFileClick:d,selectedItem:a,inputRef:r,item:e,loadingFile:o.loadingFile,grupo:o.grupo,indexGrupo:o.indexGrupo,indexItem:n,handleFileSelect:o.handleFileSelect,handleRemove:o.handleRemove,folder:o.folder,error:o.error,disabled:o.disabled},"".concat(o.indexGrupo,"-").concat(n)):(0,t.jsx)(j,{modeTheme:s,handleFileClick:d,selectedItem:a,inputRef:r,item:e,loadingFile:o.loadingFile,grupo:o.grupo,indexGrupo:o.indexGrupo,indexItem:n,handleFileSelect:o.handleFileSelect,handleRemove:o.handleRemove,folder:o.folder,error:o.error,disabled:o.disabled},"".concat(o.indexGrupo,"-").concat(n)))})]})})};var w=a(19604),E=a(55343),P=a(11163),N=a.n(P),G=a(46749),W=a(60664),z=a(36188);a(60565);var R=a(83830),T=a(40039),k=a(39976),M=a(47842),O=a(86501),V=a(80377),B=a(22416),L=a(61953),q=a(22841),_=a(16056);let J=e=>{let{xs:o,md:a,title:n,index:l,name:i,typePage:s,value:r,disabled:d,register:c,...x}=e;return(0,t.jsx)(u.ZP,{item:!0,xs:o,md:a,children:(0,t.jsx)(L.Z,{display:"flex",flexDirection:"column",alignItems:"start",children:(0,t.jsx)(q.Z,{control:(0,t.jsx)(_.Z,{...x,name:i,...c(i),defaultChecked:r,disabled:d,onChange(e){x.onChange&&x.onChange(e.target.checked,l,i,s)}}),label:n,size:"small",sx:{"&:hover":{"& .MuiFormControlLabel-label":{color:"primary.main"}}}})})})},U=e=>{let{data:o,control:a,setValue:l,register:i,errors:s}=e,[r,c]=(0,n.useState)(!0);return l("emailDestinatario",o.email),(0,t.jsxs)("div",{className:"flex flex-col gap-2 pt-2",children:[r&&(0,t.jsx)(d.Z,{name:"emailDestinatario",type:"email",title:"E-mail do destinat\xe1rio",required:!0,control:a,errors:s.emailDestinatario}),(0,t.jsx)(d.Z,{name:"assunto",title:"Assunto",required:!0,register:i,control:a,defaultValue:"",errors:s.assunto}),(0,t.jsx)(d.Z,{name:"descricao",title:"Descri\xe7\xe3o",multiline:!0,rows:4,required:!0,control:a,defaultValue:"",errors:s.descricao}),(0,t.jsxs)(B.Z,{row:!0,children:[(0,t.jsx)(J,{name:"email",title:"E-mail",value:!0,register:i,onChange:()=>c(!r)}),(0,t.jsx)(J,{name:"alerta",title:"Alerta",value:!0,register:i})]})]})};var H=a(99188),K=a(69418),Q=a(44373);let X=e=>{let{values:o,handleFileSelect:a,handleRemove:l,loadingFile:i,disabled:s}=e,{settings:r}=(0,n.useContext)(c.J6),d=r.mode,[x,m]=(0,n.useState)(null),p=(0,n.useRef)(null),h=e=>{p.current.click(),m(e)};return(0,n.useEffect)(()=>{p.current&&(p.current.value="")},[a]),(0,t.jsx)("div",{className:"flex flex-col gap-2",children:o&&o.map((e,n)=>(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(u.ZP,{container:!0,spacing:2,children:(0,t.jsx)(u.ZP,{item:!0,xs:12,sm:6,children:(0,t.jsxs)(L.Z,{display:"flex",alignItems:"center",sx:{gap:1},children:[(0,t.jsx)(Z.Z,{color:"primary",variant:"subtitle1",sx:{fontWeight:700},children:e.nome}),(0,t.jsx)(Z.Z,{variant:"body2",children:"(".concat(e.unidadeMedida,")")})]})})},n),e.produtoAnexosDescricao&&e.produtoAnexosDescricao.length>0&&(0,t.jsx)(u.ZP,{container:!0,spacing:4,children:e.produtoAnexosDescricao.map((e,o)=>(0,t.jsx)(D.Z,{modeTheme:d,handleFileClick:h,selectedItem:x,inputRef:p,item:e,loadingFile:i,indexGrupo:n,indexItem:o,handleFileSelect:a,folder:"produto",handleRemove:l,error:!1,disabled:s},"".concat(n,"-").concat(o)))}),e.anexos&&0===e.anexos.length&&(0,t.jsx)(Z.Z,{variant:"body2",sx:{mb:2},children:"Este produto n\xe3o exige anexos"}),n<o.length-1&&(0,t.jsx)(Q.Z,{sx:{my:4}})]}))})},Y=e=>{var o,a;let{id:x,makeFornecedor:m}=e,{user:p,loggedUnity:h}=(0,n.useContext)(T.V),[v,f]=(0,n.useState)(!1),[g,j]=(0,n.useState)(!1),[D,y]=(0,n.useState)(!1),[A,C]=(0,n.useState)(!1),[S,P]=(0,n.useState)(!1),[B,L]=(0,n.useState)(!1),[q,_]=(0,n.useState)(!0),[J,Q]=(0,n.useState)(null),[Y,$]=(0,n.useState)([]),[ee,eo]=(0,n.useState)([]),[ea,et]=(0,n.useState)(null),{createNewNotification:en}=(0,n.useContext)(k.u),[el,ei]=(0,n.useState)(!1),[es,er]=(0,n.useState)([]),[ed,ec]=(0,n.useState)(null),[eu,ex]=(0,n.useState)([]),[em,ep]=(0,n.useState)(""),[eh,ev]=(0,n.useState)(!1),[ef,eg]=(0,n.useState)(!1),[ej,eD]=(0,n.useState)({status:!1,errors:[]}),{settings:eI}=(0,n.useContext)(c.J6),{setId:eb}=(0,n.useContext)(R.X),[eZ,ey]=(0,n.useState)({status:!1,message:"Voc\xea n\xe3o tem permiss\xf5es",messageType:"info"}),eA=N(),eC=x&&x>0?"edit":"new",eS=eA.pathname,{reset:eF,register:ew,getValues:eE,setValue:eP,control:eN,watch:eG,handleSubmit:eW,clearErrors:ez,setError:eR,formState:{errors:eT}}=(0,l.cI)(),ek=async(e,o)=>{let a={status:e,observacao:o,auth:{usuarioID:p.usuarioID,papelID:p.papelID,unidadeID:h.unidadeID}};try{P(!0),await W.h.post("".concat(eS,"/changeFormStatus/").concat(x),a).then(o=>{O.ZP.success(G.OD.successUpdate),P(!1),e$(e,null,null)})}catch(t){console.log(t)}},eM=async e=>{try{if(!e.email&&!e.alerta)return O.ZP.error("Selecione ao menos um tipo de notifica\xe7\xe3o!");let o={titulo:e.assunto,descricao:e.descricao,url:"/formularios/fornecedor/",urlID:x,tipoNotificacaoID:3,usuarioGeradorID:p.usuarioID,usuarioID:0,unidadeID:J.fornecedor.unidadeID,papelID:2,email:e.email,alerta:e.alerta};if(console.log("\uD83D\uDE80 ~ data dat notifica\xe7\xe3o:",o),en(o),e.email){let a={values:e,auth:{id:x,usuarioID:p.usuarioID,papelID:p.papelID,unidadeID:h.unidadeID}};await W.h.post("".concat(eS,"/sendNotification"),a)}let t=e.alerta&&e.email?"E-mail e alerta enviados com sucesso!":e.alerta&&!e.email?"Alerta criado com sucesso!":!e.alerta&&e.email?"E-mail enviado com sucesso!":null;O.ZP.success(t)}catch(n){console.log(n)}},eO=()=>{navigator.clipboard.writeText(ed),O.ZP.success("Link copiado com sucesso!")},eV={id:1,name:"Gerar novo formul\xe1rio",description:"Gerar um novo formul\xe1rio de preenchimento para este fornecedor.",component:(0,t.jsx)(K.Z,{cnpj:null==J?void 0:null===(o=J.fornecedor)||void 0===o?void 0:o.cnpj}),route:null,type:null,modal:!0,action:m,size:"lg",icon:"fluent:form-new-20-regular",identification:null},eB={id:2,name:"Gerar notifica\xe7\xe3o",description:"Gerar uma nova notifica\xe7\xe3o para o fornecedor, podendo ser um e-mail e/ou alerta do sistema.",component:(0,t.jsx)(U,{data:{email:null===(a=es.find(e=>"email"==e.nomeColuna))||void 0===a?void 0:a.email}}),route:null,type:null,modal:!0,action:eM,icon:"cil:bell",identification:null},eL={id:3,name:"Copiar link do formul\xe1rio",description:"Copiar o link deste formul\xe1rio.",component:(0,t.jsx)(K.Z,{}),route:null,type:null,action:eO,modal:!1,icon:"solar:copy-outline",identification:null},eq={id:4,name:"Formul\xe1rio do fornecedor",component:(0,t.jsx)(H.Z,{params:{id:x}}),route:"/relatorio/fornecedor/dadosFornecedor",papelID:p.papelID,modal:!1,type:"report",icon:"fluent:print-24-regular",identification:null,params:{fornecedorID:x}},e_=[];1==p.papelID&&e_.push(eV),e_.push(eB),e_.push(eL),e_.push(eq);let eJ=async()=>{try{await W.h.post("".concat(eS,"/verifyFormPending/").concat(x),{parFormularioID:1}).then(e=>{_(e.data) //! true/false
})}catch(e){console.log(e)}},eU=()=>{try{f(!0),W.h.post("".concat((0,G.g_)(eS),"/new/getData"),{unidadeID:h.unidadeID}).then(e=>{console.log("getNewData: ",e.data),er(e.data.fields),ex(e.data.blocos),ep(e.data.info),eF(e.data),ey({status:!0,message:'Esse formul\xe1rio j\xe1 foi conclu\xeddo! Para alter\xe1-lo \xe9 necess\xe1rio atualizar seu Status para "Em preenchimento" atrav\xe9s do bot\xe3o "Status"!',messageType:"info"}),f(!1)})}catch(e){console.log("\uD83D\uDE80 ~ error:",e)}},eH=()=>{f(!0),x&&W.h.post("".concat(eS,"/getData/").concat(x),{type:eC,unidadeID:h.unidadeID}).then(e=>{var o,a;console.log("getData: ",e.data),er(e.data.fields),$(e.data.produtos),ex(e.data.blocos),eo(e.data.grupoAnexo),ep(e.data.info),Q(e.data.unidade),ec(e.data.link),eF(e.data),et(G.WR[null==e?void 0:null===(o=e.data)||void 0===o?void 0:null===(a=o.info)||void 0===a?void 0:a.status]),ey({status:2==p.papelID&&e.data.info.status<40,message:2==p.papelID?"Esse formul\xe1rio j\xe1 foi conclu\xeddo e enviado pra f\xe1brica, n\xe3o \xe9 mais poss\xedvel alterar as informa\xe7\xf5es!":"Somente o fornecedor pode alterar as informa\xe7\xf5es deste formul\xe1rio!",messageType:2==p.papelID?"warning":"info"}),eJ(),f(!1)})},eK=()=>{ez();let e=!1,o=[];null==es||es.forEach((a,t)=>{let n=a.tabela?"fields[".concat(t,"].").concat(a.tabela):"fields[".concat(t,"].").concat(a.nomeColuna),l=eE(n);1!==a.obrigatorio||l||(eR(n,{type:"manual",message:"Campo obrigat\xf3rio"}),o.push(null==a?void 0:a.nomeCampo),e=!0)}),eu.forEach((a,t)=>{a.itens.forEach((a,n)=>{let l=eE("blocos[".concat(t,"].itens[").concat(n,"].resposta"));(null==a?void 0:a.obrigatorio)!==1||l||(eR("blocos[".concat(t,"].itens[").concat(n,"].resposta"),{type:"manual",message:"Campo obrigat\xe1rio"}),o.push(null==a?void 0:a.nome),e=!0)})}),eD({status:e,errors:o})},eQ=async e=>{if(9===e.length){let o=e.replace(/[^0-9]/g,"");try{let a=await W.h.get("https://viacep.com.br/ws/".concat(o,"/json/"));a.data.localidade?(es.forEach(async(e,o)=>{("logradouro"===e.nomeColuna||"bairro"===e.nomeColuna||"cidade"===e.nomeColuna||"estado"===e.nomeColuna)&&(await eP("fields[".concat(o,"].logradouro"),a.data.logradouro),await eP("fields[".concat(o,"].bairro"),a.data.bairro),await eP("fields[".concat(o,"].cidade"),a.data.localidade),await eP("fields[".concat(o,"].estado"),a.data.uf))}),O.ZP.success("Endere\xe7o encontrado!")):O.ZP.error("Endere\xe7o n\xe3o encontrado!")}catch(t){console.error(t)}}},eX=()=>{eK(),ev(!0),L(!0)},eY=async e=>{e.conclusion=!0,await eW(e0)(e)},e$=(e,o,a)=>{let t=30==e?"Em preenchimento":40==e?"Conclu\xeddo":50==e?"Reprovado":60==e?"Aprovado parcialmente":70==e?"Aprovado":"Pendente",n={titulo:"Formul\xe1rio de Fornecedor ".concat(t),descricao:"O formul\xe1rio de Fornecedor #".concat(x," est\xe1 ").concat(t,"."),url:"/formularios/fornecedor/",urlID:x,tipoNotificacaoID:6,usuarioGeradorID:p.usuarioID,usuarioID:0,unidadeID:h.unidadeID,papelID:1};if(n&&(en(n),o)){let l={titulo:"Fornecedor gerado",descricao:"O formul\xe1rio de Fornecedor #".concat(x," est\xe1 ").concat(t," e gerou uma n\xe3o conformidade."),url:"/formularios/fornecedor/nao-conformidade/",urlID:a,tipoNotificacaoID:5,usuarioGeradorID:p.usuarioID,usuarioID:0,unidadeID:h.unidadeID,papelID:1};en(l)}},e0=async function(e){let o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];!0===o.conclusion&&(e.status=p&&1==p.papelID?o.status:40,e.obsConclusao=o.obsConclusao);let a={form:e,auth:{usuarioID:p.usuarioID,papelID:p.papelID,unidadeID:h.unidadeID}};console.log("\uD83D\uDE80 ~ onSubmit: ",a);try{"edit"==eC?(P(!0),await W.h.post("".concat(eS,"/updateData/").concat(x),a).then(o=>{O.ZP.success(G.OD.successUpdate),P(!1);let a=null;o.data&&o.data.naoConformidade&&o.data.id>0&&(eA.push("/formularios/fornecedor/nao-conformidade/"),eb(o.data.id),a=o.data.id),e$(e.status,e.naoConformidade,a)})):"new"==eC?await W.h.post("".concat((0,G.g_)(eS),"/insertData"),a).then(e=>{eA.push("".concat((0,G.g_)(eS))),eb(e.data),O.ZP.success(G.OD.successNew)}):O.ZP.error(G.OD.error)}catch(t){console.log(t)}},e1=async(e,o)=>{y(!0);let a=e.target.files;if(a&&a.length>0){var t;let n=new FormData;for(let l=0;l<a.length;l++)n.append("files[]",a[l]);n.append("usuarioID",p.usuarioID),n.append("unidadeID",h.unidadeID),n.append("produtoAnexoID",null!==(t=o.produtoAnexoID)&&void 0!==t?t:null),await W.h.post("".concat(eS,"/saveAnexo/").concat(x,"/produto/").concat(p.usuarioID,"/").concat(J.unidadeID),n).then(e=>{y(!1),console.log("response: ",e.data),O.ZP.success("Anexo adicionado com sucesso!");let a=Y.map(a=>a.produtoID==o.produtoID?{...a,produtoAnexosDescricao:a.produtoAnexosDescricao.map(a=>a.produtoAnexoID==o.produtoAnexoID?{...a,anexos:[...a.anexos,...e.data]}:a)}:a);$(a)}).catch(e=>{var o,a,t;y(!1),O.ZP.error(null!==(t=null===(o=e.response)||void 0===o?void 0:null===(a=o.data)||void 0===a?void 0:a.message)&&void 0!==t?t:"Erro ao atualizar anexo, tente novamente!")})}},e5=async(e,o)=>{j(!0);let a=e.target.files;if(a&&a.length>0){var t;let n=new FormData;for(let l=0;l<a.length;l++)n.append("files[]",a[l]);n.append("usuarioID",p.usuarioID),n.append("unidadeID",h.unidadeID),n.append("grupoAnexoItemID",null!==(t=o.grupoAnexoItemID)&&void 0!==t?t:null),await W.h.post("".concat(eS,"/saveAnexo/").concat(x,"/grupo-anexo/").concat(p.usuarioID,"/").concat(J.unidadeID),n).then(e=>{j(!1),O.ZP.success("Anexo adicionado com sucesso!");let a=ee.map(a=>a.grupoAnexoID==o.grupoAnexoID?{...a,itens:a.itens.map(a=>a.grupoAnexoItemID==o.grupoAnexoItemID?{...a,anexos:[...a.anexos,...e.data]}:a)}:a);eo(a)}).catch(e=>{var o,a,t;j(!1),O.ZP.error(null!==(t=null===(o=e.response)||void 0===o?void 0:null===(a=o.data)||void 0===a?void 0:a.message)&&void 0!==t?t:"Erro ao atualizar anexo, tente novamente!")})}},e3=async(e,o)=>{C(!0);let a=e.target.files;if(a&&a.length>0){var t,n;let l=new FormData;for(let i=0;i<a.length;i++)l.append("files[]",a[i]);l.append("usuarioID",p.usuarioID),l.append("unidadeID",h.unidadeID),l.append("parFornecedorModeloBlocoID",null!==(t=o.parFornecedorModeloBlocoID)&&void 0!==t?t:null),l.append("itemOpcaoAnexoID",null!==(n=o.itemOpcaoAnexoID)&&void 0!==n?n:null),await W.h.post("".concat(eS,"/saveAnexo/").concat(x,"/item/").concat(p.usuarioID,"/").concat(J.unidadeID),l).then(e=>{C(!1),O.ZP.success("Anexo adicionado com sucesso!");let a=eu.map(a=>a.parFornecedorModeloBlocoID==o.parFornecedorModeloBlocoID?{...a,itens:a.itens.map(a=>({...a,respostaConfig:{...a.respostaConfig,anexosSolicitados:a.respostaConfig.anexosSolicitados.map(a=>a.itemOpcaoAnexoID==o.itemOpcaoAnexoID?{...a,anexos:[...a.anexos,...e.data]}:a)}}))}:a);ex(a)}).catch(e=>{var o,a,t;C(!1),O.ZP.error(null!==(t=null===(o=e.response)||void 0===o?void 0:null===(a=o.data)||void 0===a?void 0:a.message)&&void 0!==t?t:"Erro ao atualizar anexo, tente novamente!")})}},e2=async e=>{try{let o=await W.h.post("/cadastros/item/getItemConfigs",{itemID:e.itemID,alternativaItemID:e.alternativa.id}),a=eu.map(e=>({...e,itens:e.itens.map(e=>({...e,respostaConfig:{...e.respostaConfig,anexosSolicitados:o.data.anexos.map(e=>({...e,anexos:[]}))}}))}));ex(a)}catch(t){console.log("error",t)}},e7=async e=>{console.log("\uD83D\uDE80 ~ item:",e),e&&await W.h.delete("".concat(eS,"/deleteAnexo/").concat(x,"/").concat(e.anexoID,"/").concat(J.unidadeID,"/").concat(p.usuarioID,"/produto")).then(e=>{O.ZP.success("Anexo removido com sucesso!");let o=e.data,a=Y.map(e=>({...e,produtoAnexosDescricao:e.produtoAnexosDescricao.map(e=>({...e,anexos:e.anexos.filter(e=>e.anexoID!=o)}))}));$(a)}).catch(e=>{var o,a,t;O.ZP.error(null!==(t=null===(o=e.response)||void 0===o?void 0:null===(a=o.data)||void 0===a?void 0:a.message)&&void 0!==t?t:"Erro ao remover anexo, tente novamente!")})},e4=async e=>{e&&await W.h.delete("".concat(eS,"/deleteAnexo/").concat(x,"/").concat(e.anexoID,"/").concat(J.unidadeID,"/").concat(p.usuarioID,"/grupo-anexo")).then(e=>{O.ZP.success("Anexo removido com sucesso!");let o=e.data,a=ee.map(e=>({...e,itens:e.itens.map(e=>({...e,anexos:e.anexos.filter(e=>e.anexoID!=o)}))}));eo(a)}).catch(e=>{var o,a,t;O.ZP.error(null!==(t=null===(o=e.response)||void 0===o?void 0:null===(a=o.data)||void 0===a?void 0:a.message)&&void 0!==t?t:"Erro ao remover anexo, tente novamente!")})},e6=async e=>{e&&await W.h.delete("".concat(eS,"/deleteAnexo/").concat(x,"/").concat(e.anexoID,"/").concat(J.unidadeID,"/").concat(p.usuarioID,"/item")).then(e=>{O.ZP.success("Anexo removido com sucesso!");let o=e.data,a=eu.map(e=>({...e,itens:e.itens.map(e=>({...e,respostaConfig:{...e.respostaConfig,anexosSolicitados:e.respostaConfig.anexosSolicitados.map(e=>({...e,anexos:e.anexos.filter(e=>e.anexoID!=o)}))}}))}));ex(a)}).catch(e=>{var o,a,t;O.ZP.error(null!==(t=null===(o=e.response)||void 0===o?void 0:null===(a=o.data)||void 0===a?void 0:a.message)&&void 0!==t?t:"Erro ao remover anexo, tente novamente!")})};return(0,n.useEffect)(()=>{"new"==eC?eU():eH()},[x,S]),(0,n.useEffect)(()=>{eK()},[]),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(M.Z,{show:v}),(0,t.jsxs)("form",{onSubmit:eW(e0),children:[!eZ.status&&(0,t.jsx)(w.Z,{severity:eZ.messageType,sx:{mb:2},children:eZ.message}),(0,t.jsxs)(I.Z,{children:[(0,t.jsx)(z.Z,{btnCancel:!0,btnSave:2==p.papelID&&em.status<40,btnSend:1==p.papelID&&"edit"==eC&&em.status>=40||2==p.papelID&&em.status<40,btnPrint:"edit"==eC,actionsData:e_,actions:!0,handleSubmit:()=>eW(e0),handleSend:eX,iconConclusion:"mdi:check-bold",titleConclusion:"Concluir Formul\xe1rio",title:"Fornecedor",btnStatus:"edit"==eC,handleBtnStatus:()=>ei(!0),type:eC,status:ea}),(0,t.jsx)(b.Z,{children:(0,t.jsx)(i.Z,{register:ew,errors:eT,setValue:eP,control:eN,fields:es,values:es,getAddressByCep:eQ,disabled:!eZ.status})})]}),J&&(null==J?void 0:J.obrigatorioProdutoFornecedor)&&Y&&Y.length>0&&(0,t.jsx)(I.Z,{sx:{mt:4},children:(0,t.jsx)(b.Z,{children:(0,t.jsx)(X,{values:Y,handleFileSelect:e1,handleRemove:e7,loadingFile:D,disabled:!eZ.status},D)})}),eu&&eu.map((e,o)=>(0,t.jsx)(s.Z,{index:o,blockKey:"parFornecedorModeloBlocoID",handleFileSelect:e3,setItemResposta:e2,handleRemoveAnexoItem:e6,setBlocos:ex,values:e,control:eN,register:ew,setValue:eP,errors:eT,disabled:!eZ.status},o)),ee&&ee.map((e,o)=>{var a,n;return(0,t.jsx)(F,{values:{grupo:e,loadingFile:g,indexGrupo:o,handleFileSelect:e5,handleRemove:e4,folder:"grupo-anexo",disabled:!eZ.status,error:null==eT?void 0:null===(a=eT.grupoAnexo)||void 0===a?void 0:null===(n=a[o])||void 0===n?void 0:n.itens}},o)}),em&&(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(I.Z,{sx:{mt:4},children:(0,t.jsx)(b.Z,{children:(0,t.jsx)(u.ZP,{container:!0,spacing:4,children:(0,t.jsx)(u.ZP,{item:!0,xs:12,md:12,children:(0,t.jsxs)(E.Z,{fullWidth:!0,children:[(0,t.jsx)(Z.Z,{variant:"subtitle1",sx:{fontWeight:600,mb:2},children:"Observa\xe7\xf5es (campo de uso exclusivo da validadora)"}),(0,t.jsx)(d.Z,{title:"Observa\xe7\xe3o (opcional)",name:"info.obs",multiline:!0,rows:4,value:em.obs,disabled:!eZ.status,control:eN})]})})})})})}),el&&(0,t.jsx)(r.Z,{title:"Hist\xf3rico do Formul\xe1rio",text:"Listagem do hist\xf3rico das movimenta\xe7\xf5es do formul\xe1rio ".concat(x," do Fornecedor."),id:x,parFormularioID:1,formStatus:em.status,hasFormPending:q,canChangeStatus:1==p.papelID&&!q&&em.status>30,openModal:el,handleClose:()=>ei(!1),btnCancel:!0,btnConfirm:!0,handleSubmit:ek}),(0,t.jsx)(V.Z,{openModal:eh,handleClose(){ev(!1),L(!1)},title:"Concluir Formul\xe1rio",text:"Deseja realmente concluir este formul\xe1rio?",info:em,canChange:!q,register:ew,setValue:eP,getValues:eE,btnCancel:!0,btnConfirm:!0,btnConfirmColor:"primary",conclusionForm:eY,listErrors:ej})]})]})};var $=Y},99188:function(e,o,a){a.d(o,{Z:function(){return c}});var t=a(85893),n=a(67294),l=a(99070),i=a(40874),s=a(60664);let r=e=>{let[o,a]=(0,n.useState)([]);return(0,n.useEffect)(()=>{let o=async()=>{await s.h.post("relatorio/fornecedor/dadosFornecedor",{data:e}).then(e=>a(e.data))};o()},[e]),o},d=e=>{var o,a,s,d,c,u,x,m,p;let{params:h}=e,v=r(h);return(0,t.jsx)(t.Fragment,{children:v&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(l.G7,{style:i.W.containerFields,children:null===(o=v.fields)||void 0===o?void 0:o.map((e,o)=>(0,t.jsxs)(n.Fragment,{children:[(0,t.jsxs)(l.G7,{style:[i.W.fields,{width:"33%"}],children:[(0,t.jsx)(l.xv,{style:i.W.fieldTitle,children:null!==(s=e.title)&&void 0!==s?s:"NI"}),(0,t.jsx)(l.xv,{style:i.W.fieldValue,children:null!==(d=e.value)&&void 0!==d?d:"NI"})]}),(o+1)%3==0&&(0,t.jsx)(l.G7,{style:i.W.separator})]},o))}),(0,t.jsx)(l.G7,{style:i.W.separator}),(0,t.jsxs)(l.G7,{style:{display:"flex",flexDirection:"column",gap:7,paddingVertical:10,paddingBottom:10},children:[(0,t.jsxs)(l.xv,{style:i.W.fieldTitle,children:["Atividades: ",(0,t.jsx)(l.xv,{style:i.W.fieldValue,children:null!==(c=v.atividades)&&void 0!==c?c:"NI"})]}),(0,t.jsxs)(l.xv,{style:i.W.fieldTitle,children:["Sistema de qualidade:"," ",(0,t.jsx)(l.xv,{style:i.W.fieldValue,children:null!==(u=v.sistemaQualidade)&&void 0!==u?u:"NI"})]}),(0,t.jsxs)(l.xv,{style:i.W.fieldTitle,children:["Categoria: ",(0,t.jsx)(l.xv,{style:i.W.fieldValue,children:null!==(x=v.categoria)&&void 0!==x?x:"NI"})]})]}),(0,t.jsx)(l.G7,{style:i.W.separator}),null===(a=v.blocos)||void 0===a?void 0:a.map((e,o)=>(0,t.jsxs)(l.G7,{style:e,children:[(0,t.jsx)(l.xv,{style:[i.W.blockTitle,{paddingTop:20}],children:e.nome}),(0,t.jsxs)(l.G7,{style:i.W.table,children:[(0,t.jsxs)(l.G7,{style:i.W.tableTitle,children:[(0,t.jsx)(l.xv,{style:[i.W.tableTitlecolumn,{width:"60%"}],children:"Item"}),(0,t.jsx)(l.xv,{style:[i.W.tableTitlecolumn,{width:"20%",borderLeft:"1px solid #ddd"}],children:"Resposta"}),(0,t.jsx)(l.xv,{style:[i.W.tableTitlecolumn,{width:"20%",borderLeft:"1px solid #ddd"}],children:"Observa\xe7\xe3o"})]}),e.itens.map((e,o)=>(0,t.jsxs)(l.G7,{style:i.W.tableContainer,children:[(0,t.jsx)(l.G7,{style:[i.W.tableContent,{width:"60%"}],children:(0,t.jsx)(l.xv,{style:i.W.tableContentcolumn,children:e.nome})}),(0,t.jsx)(l.G7,{style:[i.W.tableContent,{width:"20%"}],children:(0,t.jsx)(l.xv,{style:i.W.tableContentcolumn,children:null!==(m=e.resposta)&&void 0!==m?m:"--"})}),(0,t.jsx)(l.G7,{style:[i.W.tableContent,{width:"20%"}],children:(0,t.jsx)(l.xv,{style:i.W.tableContentcolumn,children:null!==(p=e.obsResposta)&&void 0!==p?p:"--"})})]}))]})]},o))]})})};var c=d}}]);