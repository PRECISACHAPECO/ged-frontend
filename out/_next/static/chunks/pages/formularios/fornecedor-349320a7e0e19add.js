(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7463],{59424:function(e,o,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/formularios/fornecedor",function(){return r(18442)}])},93250:function(e,o,r){"use strict";var a=r(85893),n=r(49837),s=r(91359),i=r(40372);let t=e=>{let{result:o,columns:r,btnNew:t=!0,btnPrint:l=!0,openModal:d}=e;return(0,a.jsx)(n.Z,{children:(0,a.jsx)(s.Z,{sx:{pt:"0"},children:(0,a.jsx)(i.Z,{rows:o,columns:r,buttonsHeader:{btnNew:t,btnPrint:l,openModal:d}})})})};o.Z=t},18442:function(e,o,r){"use strict";r.r(o),r.d(o,{default:function(){return _}});var a=r(85893),n=r(67294),s=r(60664),i=r(93250),t=r(73312),l=r(60565),d=r(83830),c=r(40039),u=r(29620),m=r(77745),x=r(95398),h=r(44642),p=r(79072),f=r(55343),j=r(67836),v=r(29630),g=r(19604),F=r(75084),C=r(35966),Z=r(76779),b=r(11163);r(84220);var D=r(21609),I=r(49540),N=r(34175),P=r(82747),y=r(87536),S=r(86501),w=r(45061);let E=e=>{var o;let{handleClose:r,openModal:i,makeFornecedor:t,loadingSave:d}=e;(0,b.useRouter)();let[E,z]=(0,n.useState)(!1),{user:k,loggedUnity:A}=(0,n.useContext)(c.V),{handleSearch:_}=(0,n.useContext)(l.f),[J,M]=(0,n.useState)(null),[T,H]=(0,n.useState)(null),[V,q]=(0,n.useState)(!1),[G,L]=(0,n.useState)(null),[O,R]=(0,n.useState)(!1),[W,X]=(0,n.useState)(!1),[B,K]=(0,n.useState)(!1),[U,Q]=(0,n.useState)(!1),[Y,$]=(0,n.useState)([]),[ee,eo]=(0,n.useState)([]),[er,ea]=(0,n.useState)("");console.log("\uD83D\uDE80 ~ nomeFornecedor:",er);let{handleSubmit:en,formState:{errors:es},setValue:ei,register:et}=(0,y.cI)({}),el=()=>{Q(!0),setTimeout(()=>{Q(!1)},5e3);let e=(0,I.q)((0,I.X1)(T)),o=(0,I.q)(A.unidadeID),r=window.location.origin,a="".concat(r,"/fornecedor?c=").concat(e,"&u=").concat(o);navigator.clipboard.writeText(a)},ed=async e=>{e&&18===e.length&&(console.log("getFornecedorByCnpj: ",e),(0,P.zk)(e)?(z(!0),R(!1),await s.h.post("/formularios/fornecedor/cnpj",{unidadeID:A.unidadeID,cnpj:e}).then(o=>{console.log("\uD83D\uDE80 ~ getFornecedorByCnpj response:",o.data),M(o.data),H(e),z(!1)})):(H(null),R(!0)))},ec=async()=>{console.log("filtra no contexto..."),_(T),r()},eu=async()=>{z(!0),await s.h.post("/formularios/fornecedor/fornecedorStatus",{unidadeID:A.unidadeID,cnpj:T,status:1}).then(e=>{200===e.status?(M(e.data),S.Am.success("Fornecedor reativado com sucesso")):S.Am.error("Erro ao reativar fornecedor"),z(!1)})},em=()=>{K(!0)},ex=async()=>{await s.h.post("/formularios/fornecedor/getGruposAnexo",{unidadeID:A.unidadeID}).then(e=>{$(e.data)}).catch(e=>{console.log("\uD83D\uDE80 ~ error:",e)})},eh=e=>{console.log("\uD83D\uDE80 ~ onSubmit ~ values:",e)};return(0,n.useEffect)(()=>{ex()},[]),(0,n.useEffect)(()=>{ed(T),M(null),en(eh),H(null),L(null)},[i,d]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(u.Z,{open:i,onClose:r,"aria-labelledby":"form-dialog-title",children:[(0,a.jsx)(m.Z,{id:"form-dialog-title",children:"Habilitar novo fornecedor"}),(0,a.jsxs)(x.Z,{children:[(0,a.jsxs)(h.Z,{sx:{mb:3},children:["Insira o CNPJ da empresa que deseja habilitar como um novo fornecedor. Com isso, a empresa ficar\xe1 apta a preencher formul\xe1rios para a ",A.nomeFantasia,"."]}),(0,a.jsx)("form",{onSubmit:en(eh),children:(0,a.jsxs)(p.ZP,{container:!0,children:[(0,a.jsx)(p.ZP,{item:!0,xs:12,md:12,children:(0,a.jsxs)(f.Z,{fullWidth:!0,children:[(0,a.jsx)(j.Z,{defaultValue:(null==J?void 0:J.cnpj)?J.cnpj:"",label:"CNPJ",placeholder:"CNPJ","aria-describedby":"validation-schema-nome",name:"cnpj",error:O,...et("cnpj",{required:!0,validate:e=>(0,P.zk)(e)||"CNPJ inv\xe1lido"}),helperText:null===(o=es.cnpj)||void 0===o?void 0:o.message,inputProps:{maxLength:18,onChange(e){M(null),ei("cnpj",(0,N.PK)(e.target.value)),H((0,N.PK)(e.target.value)),ed(e.target.value),q(!1)}}}),O&&(0,a.jsx)(v.Z,{variant:"body2",color:"error",children:"Por favor, insira um CNPJ v\xe1lido!"})]})}),J&&J.isFornecedor&&!J.hasFormulario&&V&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(p.ZP,{item:!0,xs:12,md:12,sx:{mt:4},children:(0,a.jsx)(f.Z,{fullWidth:!0,children:(0,a.jsx)(j.Z,{defaultValue:"",type:"email",label:"E-mail",placeholder:"E-mail","aria-describedby":"validation-schema-nome",name:"email",...et("email",{required:!0,validate:e=>e.includes("@")||"E-mail inv\xe1lido"}),error:W,helperText:W?"Insira um e-mail v\xe1lido":null,inputProps:{onChange(e){ei("email",e.target.value),L(e.target.value),X(!(0,P.dI)(e.target.value))}}})})}),(0,a.jsx)(p.ZP,{item:!0,xs:12,md:12,sx:{mt:2},children:(0,a.jsx)(g.Z,{severity:"info",children:"Um e-mail ser\xe1 enviado para o fornecedor com as instru\xe7\xf5es de cadastro e preenchimento do formul\xe1rio"})})]})]})}),J&&(0,a.jsx)(p.ZP,{container:!0,sx:{mt:2},children:(0,a.jsx)(p.ZP,{item:!0,xs:12,md:12,children:J.isFornecedor&&J.hasFormulario?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(g.Z,{severity:"success",children:["Esse CNPJ est\xe1 habilitado como um Fornecedor da ",A.nomeFantasia]}),(0,a.jsx)(F.Z,{startIcon:(0,a.jsx)(D.Z,{icon:U?"mdi:check-bold":"iconamoon:copy-bold"}),sx:{mt:2},onClick:U?null:el,style:{cursor:U?"default":"pointer"},children:U?"Copiado!":"Copiar Link do Formul\xe1rio"})]}):J.isFornecedor&&!J.hasFormulario?(0,a.jsx)(g.Z,{severity:"warning",children:"Esse CNPJ j\xe1 \xe9 seu fornecedor, mas n\xe3o h\xe1 nenhum formul\xe1rio criado"}):!J.isFornecedor&&J.hasFormulario?(0,a.jsx)(g.Z,{severity:"warning",children:"Esse CNPJ n\xe3o est\xe1 mais ativo como um fornecedor mas possui formul\xe1rios preenchidos"}):J.isFornecedor||J.hasFormulario?null:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(p.ZP,{item:!0,xs:12,md:12,sx:{my:1},children:(0,a.jsx)(f.Z,{fullWidth:!0,children:(0,a.jsx)(j.Z,{defaultValue:"",label:"Nome do Fornecedor",placeholder:"Nome do Fornecedor","aria-describedby":"validation-schema-nome",name:"nomeFornecedor",inputProps:{onChange(e){ei("nomeFornecedor",e.target.value),ea(e.target.value)}}})})}),(0,a.jsx)(p.ZP,{item:!0,xs:12,md:12,sx:{mt:3},children:(0,a.jsx)(f.Z,{fullWidth:!0,children:(0,a.jsx)(C.Z,{multiple:!0,limitTags:5,options:Y,getOptionLabel:e=>e.nome,defaultValue:[],onChange(e,o){console.log("\uD83D\uDE80 Select => onChange:",o),eo(o)},renderInput:e=>(0,a.jsx)(j.Z,{...e,label:"Grupos de Anexo",placeholder:"Grupos de Anexo"})})})}),(0,a.jsx)(g.Z,{severity:"info",sx:{mt:3},children:"Esse CNPJ ainda n\xe3o \xe9 seu fornecedor"})]})})})]}),(0,a.jsxs)(Z.Z,{className:"dialog-actions-dense",sx:{mx:2,mb:2},children:[(0,a.jsx)(F.Z,{variant:"outlined",onClick:r,children:"Fechar"}),J&&(J.isFornecedor&&J.hasFormulario||!J.isFornecedor&&J.hasFormulario||!J.isFornecedor&&!J.hasFormulario)&&(0,a.jsx)(F.Z,{variant:"contained",onClick:J.isFornecedor&&J.hasFormulario?ec:!J.isFornecedor&&J.hasFormulario?eu:J.isFornecedor||J.hasFormulario?null:em,children:J.isFornecedor&&J.hasFormulario?"Filtrar formul\xe1rios":!J.isFornecedor&&J.hasFormulario?"Reativar fornecedor":J.isFornecedor||J.hasFormulario?null:"Tornar meu fornecedor"})]})]}),(0,a.jsx)(w.Z,{title:"Confirmar novo fornecedor",text:"Tem certeza que deseja tornar o CNPJ ".concat(T," um fornecedor ativo na ").concat(A.nomeFantasia," ? Se sim, o mesmo poder\xe1 preencher formul\xe1rios de Fornecedor para a sua empresa."),handleClose(){K(!1)},openModal:B,handleSubmit:t,inputEmail:!0,closeAfterSave:!0,cnpj:T,gruposAnexo:ee,nomeFornecedor:er,grupoAnexosFornecedor:!0,btnCancel:!0,btnConfirm:!0,btnConfirmColor:"primary"})]})};var z=r(47842),k=r(46749);let A=()=>{let{user:e,loggedUnity:o}=(0,n.useContext)(c.V),[r,u]=(0,n.useState)(null),m=(0,b.useRouter)(),x=m.pathname,{setTitle:h}=(0,n.useContext)(l.f),[p,f]=(0,n.useState)(!1),[j,v]=(0,n.useState)(!1),{id:g}=(0,n.useContext)(d.X),F=()=>{f(!0)},C=async(r,a,n,i)=>{try{v(!0),await s.h.post("".concat(x,"/makeFornecedor"),{usuarioID:e.usuarioID,unidadeID:o.unidadeID,papelID:e.papelID,cnpj:r,nomeFornecedor:a,gruposAnexo:n}).then(e=>{200===e.status?(S.Am.success("Fornecedor habilitado com sucesso"),i&&Z(i,r)):S.Am.error("Erro ao tornar fornecedor"),v(!1)})}catch(t){console.log(t)}},Z=(e,r)=>{if(e&&(0,P.dI)(e)){let a={unidadeID:o.unidadeID,cnpj:r,destinatario:e};console.log("\uD83D\uDE80 ~ sendMail:",a),s.h.post("".concat(x,"/sendMail"),{data:a}).then(e=>{S.Am.success("E-mail enviado com sucesso")}).catch(e=>{console.error("Erro ao enviar email",e)})}},D=async()=>{await s.h.post("".concat(x,"/getList"),{unidadeID:o.unidadeID,papelID:e.papelID,cnpj:e.cnpj?e.cnpj:null}).then(e=>{u(e.data),h("Fornecedor")})};(0,n.useEffect)(()=>{D()},[g,j]);let I=1==e.papelID?[{headerName:"ID",field:"id",size:1},{headerName:"Fornecedor",field:"fornecedor",size:1},{headerName:"CNPJ",field:"cnpj",size:1},{headerName:"Data da Avalia\xe7\xe3o",field:"data",size:1},{headerName:"Cidade",field:"cidade",size:1},{headerName:"Respons\xe1vel",field:"responsavel",size:1},{headerName:"Status",field:"status",size:1}]:2==e.papelID?[{headerName:"ID",field:"id",size:1},{headerName:"F\xe1brica",field:"fabrica",size:1},{headerName:"CNPJ",field:"cnpj",size:1},{headerName:"Data da Avalia\xe7\xe3o",field:"data",size:1},{headerName:"Cidade",field:"cidade",size:1},{headerName:"Respons\xe1vel",field:"responsavel",size:1},{headerName:"Status",field:"status",size:1}]:[],N=(0,k.OL)(x,I);return(0,a.jsxs)(a.Fragment,{children:[r?g&&g>0?(0,a.jsx)(t.Z,{id:g}):(0,a.jsx)(i.Z,{result:r,columns:N,btnNew:1==e.papelID,openModal:1==e.papelID?F:null}):(0,a.jsx)(z.Z,{}),(0,a.jsx)(E,{openModal:p,handleClose:()=>f(!1),makeFornecedor:C,loadingSave:j})]})};var _=A},40372:function(e,o,r){"use strict";r.d(o,{Z:function(){return D}});var a=r(85893),n=r(67294),s=r(87630),i=r(75680),t=r(61953),l=r(67836),d=r(80562),c=r(50853),u=r(11163),m=r.n(u),x=r(91359),h=r(75084),p=r(41664),f=r.n(p),j=r(40039),v=r(21609);let g=e=>{let{btnNew:o,btnPrint:r,openModal:s}=e,i=m(),{routes:l}=(0,n.useContext)(j.V);return(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(x.Z,{sx:{display:"flex",justifyContent:"end",alignItems:"center",p:"0",m:"0"},children:(0,a.jsxs)(t.Z,{sx:{display:"flex",gap:"8px"},children:[r&&(0,a.jsx)(h.Z,{onClick:()=>window.print(),type:"button",variant:"outlined",color:"primary",size:"medium",startIcon:(0,a.jsx)(v.Z,{icon:"mdi:printer"}),children:"Imprimir"}),o&&l.find(e=>e.rota===i.pathname&&e.inserir)&&(0,a.jsx)(f(),{href:s?"":"".concat(i.pathname,"/novo"),children:(0,a.jsx)(h.Z,{type:"button",variant:"outlined",color:"primary",size:"medium",startIcon:(0,a.jsx)(v.Z,{icon:"ic:outline-plus"}),onClick:s||null,children:"Novo"})})]})})})},F=e=>(0,a.jsxs)(t.Z,{sx:{display:"flex",flexWrap:"wrap",alignItems:"baseline",justifyContent:"space-between",p:e=>e.spacing(8,0,0,0)},children:[(0,a.jsxs)(t.Z,{sx:{display:"flex",gap:"8px",textAlig:"end"},children:[(0,a.jsx)(l.Z,{size:"medium",value:e.value,onChange:e.onChange,placeholder:"Buscar…",variant:"standard",InputProps:{startAdornment:(0,a.jsx)(t.Z,{sx:{mr:2,display:"flex"},children:(0,a.jsx)(v.Z,{icon:"mdi:magnify",fontSize:20})}),endAdornment:(0,a.jsx)(d.Z,{size:"medium",title:"Clear","aria-label":"Clear",onClick:e.clearSearch,children:(0,a.jsx)(v.Z,{icon:"mdi:close",fontSize:20})})},sx:{width:{xs:1,sm:"auto"},"& .MuiInputBase-root > svg":{mr:2}}}),(0,a.jsx)(c.M,{})]}),(0,a.jsx)(t.Z,{children:(0,a.jsx)(g,{btnNew:e.buttonsHeader.btnNew,btnPrint:e.buttonsHeader.btnPrint,openModal:e.buttonsHeader.openModal})})]});var C=r(60565),Z=r(83830);let b=e=>{let{rows:o,columns:r,buttonsHeader:t}=e,{handleSearch:l,pageSize:d,setPageSize:c,searchText:u,filteredData:m,setData:x,data:h}=(0,n.useContext)(C.f),{setId:p}=(0,n.useContext)(Z.X);return x(o),(0,a.jsx)(s._,{localeText:i.F.components.MuiDataGrid.defaultProps.localeText,autoHeight:!0,columns:r,pageSize:d,rowsPerPageOptions:[10,20,30,40,50,100],components:{Toolbar:F},rows:u?m:h,onCellClick(e,o){p(e.row.id)},onPageSizeChange:e=>c(e),sx:{"& .MuiDataGrid-cell":{cursor:"pointer"}},componentsProps:{toolbar:{value:u,clearSearch:()=>l(""),onChange:e=>l(e.target.value),buttonsHeader:t}}})};var D=b}},function(e){e.O(0,[4186,1445,1111,5999,7536,2064,2187,1082,1515,8213,6896,3312,9774,2888,179],function(){return e(e.s=59424)}),_N_E=e.O()}]);