(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1132],{94156:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/formularios/limpeza",function(){return t(2350)}])},93250:function(e,a,t){"use strict";var o=t(85893),s=t(49837),n=t(91359),i=t(69175);let r=e=>{let{result:a,columns:t,btnNew:r=!0,btnPrint:l=!0,btnBack:u,openModal:c,modaLog:d}=e;return(0,o.jsx)(s.Z,{children:(0,o.jsx)(n.Z,{sx:{pt:"0"},children:(0,o.jsx)(i.Z,{rows:a,columns:t,modaLog:d,buttonsHeader:{btnNew:r,btnPrint:l,btnBack:u,openModal:c}})})})};a.Z=r},2350:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return _}});var o=t(85893),s=t(67294),n=t(60664),i=t(93250),r=t(87536),l=t(56531),u=t(99734),c=t(34282),d=t(29308),m=t(19604),p=t(49837),x=t(91359),f=t(79072),h=t(55343),D=t(29630),b=t(11163),g=t.n(b),I=t(46749),v=t(86887),C=t(60565),j=t(83830),S=t(40039),Z=t(39976),w=t(47842),y=t(86501),z=t(66136),P=t(80377);let E=e=>{let{id:a}=e,{user:t,loggedUnity:i}=(0,s.useContext)(S.V),[b,C]=(0,s.useState)(!1),[E,N]=(0,s.useState)(!1),[_,L]=(0,s.useState)(!1),[F,M]=(0,s.useState)(!0),[R,O]=(0,s.useState)(null),{createNewNotification:k}=(0,s.useContext)(Z.u),[V,T]=(0,s.useState)(!1),[H,X]=(0,s.useState)([]),[A,B]=(0,s.useState)(null),[W,G]=(0,s.useState)([]),[U,J]=(0,s.useState)(""),[K,q]=(0,s.useState)(!1),[Q,Y]=(0,s.useState)({status:!1,errors:[]}),{settings:$}=(0,s.useContext)(z.J6),{setId:ee}=(0,s.useContext)(j.X),[ea,et]=(0,s.useState)({status:!1,message:"Voc\xea n\xe3o tem permiss\xf5es",messageType:"info"}),eo=g(),es=a&&a>0?"edit":"new",en=eo.pathname,{reset:ei,register:er,getValues:el,setValue:eu,control:ec,watch:ed,handleSubmit:em,clearErrors:ep,setError:ex,formState:{errors:ef}}=(0,r.cI)(),eh=async e=>{let o={status:e,auth:{usuarioID:t.usuarioID,papelID:t.papelID,unidadeID:i.unidadeID}};try{N(!0),await n.h.post("".concat(en,"/changeFormStatus/").concat(a),o).then(a=>{y.ZP.success(I.OD.successUpdate),N(!1),eS(e,null,null)})}catch(s){console.log(s)}},eD=[{id:1,name:"Dados do Recebimento de MP",component:(0,o.jsx)(ReportRecebimentoMP,{params:{id:a,unidadeID:1}}),route:"/relatorio/recebimentoMp/dadosRecebimentoMp",papelID:t.papelID,identification:"01",params:{fornecedorID:a}},{id:2,name:"Declara\xe7\xe3o de prolifici\xeancia",component:(0,o.jsx)(ReportRecebimentoMP,{params:{id:a,unidadeID:1}}),route:"/relatorio/recebimentoMp/dadosRecebimentoMp",papelID:t.papelID,identification:"02",params:{fornecedorID:a}}],eb=async()=>{try{await n.h.post("".concat(en,"/verifyFormPending/").concat(a),{parFormularioID:4}).then(e=>{M(e.data) //! true/false
})}catch(e){console.log(e)}},eg=()=>{try{C(!0),n.h.post("".concat((0,I.g_)(en),"/new/getData"),{unidadeID:i.unidadeID}).then(e=>{console.log("getNewData: ",e.data),X(e.data.fields),G(e.data.blocos),J(e.data.info),ei(e.data),et({status:!0,message:'Esse formul\xe1rio j\xe1 foi conclu\xeddo! Para alter\xe1-lo \xe9 necess\xe1rio atualizar seu Status para "Em preenchimento" atrav\xe9s do bot\xe3o "Status"!',messageType:"info"}),C(!1)})}catch(e){console.log("\uD83D\uDE80 ~ error:",e)}},eI=()=>{C(!0),a&&n.h.post("".concat(en,"/getData/").concat(a),{type:es,unidadeID:i.unidadeID}).then(e=>{var a,t,o,s;console.log("getData: ",e.data),X(e.data.fields),G(e.data.blocos),J(e.data.info),ei(e.data),O(I.WR[null==e?void 0:null===(a=e.data)||void 0===a?void 0:null===(t=a.info)||void 0===t?void 0:t.status]),et({status:(null==e?void 0:null===(o=e.data)||void 0===o?void 0:null===(s=o.info)||void 0===s?void 0:s.status)<40,message:'Esse formul\xe1rio j\xe1 foi conclu\xeddo! Para alter\xe1-lo \xe9 necess\xe1rio atualizar seu Status para "Em preenchimento" atrav\xe9s do bot\xe3o "Status"!',messageType:"info"}),eb(),C(!1)})},ev=()=>{ep();let e=!1,a=[];null==H||H.forEach((t,o)=>{let s=t.tabela?"fields[".concat(o,"].").concat(t.tabela):"fields[".concat(o,"].").concat(t.nomeColuna),n=el(s);1!==t.obrigatorio||n||(ex(s,{type:"manual",message:"Campo obrigat\xf3rio"}),a.push(null==t?void 0:t.nomeCampo),e=!0)}),W.forEach((t,o)=>{t.itens.forEach((t,s)=>{let n=el("blocos[".concat(o,"].itens[").concat(s,"].resposta"));(null==t?void 0:t.obrigatorio)!==1||n||(ex("blocos[".concat(o,"].itens[").concat(s,"].resposta"),{type:"manual",message:"Campo obrigat\xe1rio"}),a.push(null==t?void 0:t.nome),e=!0)})}),Y({status:e,errors:a})},eC=()=>{ev(),q(!0),L(!0)},ej=async e=>{e.conclusion=!0,await em(eZ)(e)},eS=(e,o,s)=>{let n=30==e?"Em preenchimento":40==e?"Conclu\xeddo":50==e?"Reprovado":60==e?"Aprovado parcialmente":70==e?"Aprovado":"Pendente",r={titulo:"Formul\xe1rio de Limpeza ".concat(n),descricao:"O formul\xe1rio de Limpeza #".concat(a," est\xe1 ").concat(n,"."),url:"/formularios/limpeza/",urlID:a,tipoNotificacaoID:6,usuarioGeradorID:t.usuarioID,usuarioID:0,unidadeID:i.unidadeID,papelID:1};if(r&&(k(r),o)){let l={titulo:"Limpeza gerada",descricao:"O formul\xe1rio de Limpeza #".concat(a," est\xe1 ").concat(n," e gerou uma n\xe3o conformidade."),url:"/formularios/limpeza/nao-conformidade/",urlID:s,tipoNotificacaoID:5,usuarioGeradorID:t.usuarioID,usuarioID:0,unidadeID:i.unidadeID,papelID:1};k(l)}},eZ=async function(e){let o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];!0===o.conclusion&&o.status>10&&(e.status=o.status,e.obsConclusao=o.obsConclusao);let s={form:e,auth:{usuarioID:t.usuarioID,papelID:t.papelID,unidadeID:i.unidadeID}};try{"edit"==es?(N(!0),await n.h.post("".concat(en,"/updateData/").concat(a),s).then(a=>{y.ZP.success(I.OD.successUpdate),N(!1);let t=null;a.data&&a.data.naoConformidade&&a.data.id>0&&(eo.push("/formularios/limpeza/nao-conformidade/"),ee(a.data.id),t=a.data.id),eS(e.status,e.naoConformidade,t)})):"new"==es?await n.h.post("".concat((0,I.g_)(en),"/insertData"),s).then(e=>{eo.push("".concat((0,I.g_)(en))),ee(e.data),y.ZP.success(I.OD.successNew)}):y.ZP.error(I.OD.error)}catch(r){console.log(r)}};return(0,s.useEffect)(()=>{"new"==es?eg():eI()},[a,E]),(0,s.useEffect)(()=>{ev()},[]),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(w.Z,{show:b}),(0,o.jsxs)("form",{onSubmit:em(eZ),children:[!ea.status&&(0,o.jsx)(m.Z,{severity:ea.messageType,sx:{mb:2},children:ea.message}),(0,o.jsxs)(p.Z,{children:[(0,o.jsx)(v.Z,{btnCancel:!0,btnSave:(null==U?void 0:U.status)<40||"new"==es,btnSend:"edit"==es&&(null==U?void 0:U.status)<50,btnPrint:"edit"==es,generateReport:I.generateReport,actionsData:eD,actions:!0,handleSubmit:()=>em(eZ),handleSend:eC,iconConclusion:"mdi:check-bold",titleConclusion:"Aprovar Limpeza",title:"Limpeza",btnStatus:"edit"==es,handleBtnStatus:()=>T(!0),type:es,status:R}),(0,o.jsx)(x.Z,{children:(0,o.jsx)(l.Z,{register:er,errors:ef,setValue:eu,control:ec,fields:H,values:H,disabled:!ea.status})})]}),W&&W.map((e,a)=>(0,o.jsx)(u.Z,{index:a,blockKey:"parLimpezaModeloBlocoID",values:e,control:ec,register:er,setValue:eu,errors:ef,disabled:!ea.status},a)),U&&(0,o.jsx)(o.Fragment,{children:(0,o.jsx)(p.Z,{sx:{mt:4},children:(0,o.jsx)(x.Z,{children:(0,o.jsx)(f.ZP,{container:!0,spacing:4,children:(0,o.jsx)(f.ZP,{item:!0,xs:12,md:12,children:(0,o.jsxs)(h.Z,{fullWidth:!0,children:[(0,o.jsx)(D.Z,{variant:"subtitle1",sx:{fontWeight:600,mb:2},children:"Observa\xe7\xf5es (campo de uso exclusivo da validadora)"}),(0,o.jsx)(d.Z,{title:"Observa\xe7\xe3o (opcional)",name:"info.obs",multiline:!0,rows:4,value:U.obs,disabled:!ea.status,control:ec})]})})})})})}),V&&(0,o.jsx)(c.Z,{id:a,parFormularioID:2,formStatus:U.status,hasFormPending:F,canChangeStatus:U.status>30&&!F,openModal:V,handleClose:()=>T(!1),title:"Hist\xf3rico do Formul\xe1rio",text:"Listagem do hist\xf3rico das movimenta\xe7\xf5es do formul\xe1rio ".concat(a," de Limpeza e Higieniza\xe7\xe3o."),btnCancel:!0,btnConfirm:!0,handleSubmit:eh}),(0,o.jsx)(P.Z,{openModal:K,handleClose(){q(!1),L(!1)},title:"Concluir Formul\xe1rio",text:"Deseja realmente concluir este formul\xe1rio?",info:U,canChange:!F,register:er,setValue:eu,getValues:el,btnCancel:!0,btnConfirm:!0,btnConfirmColor:"primary",conclusionForm:ej,listErrors:Q})]})]})},N=()=>{let{user:e,loggedUnity:a}=(0,s.useContext)(S.V),[t,r]=(0,s.useState)(null),l=(0,b.useRouter)(),u=l.pathname,{setTitle:c}=(0,s.useContext)(C.f),{id:d}=(0,s.useContext)(j.X),m=async()=>{await n.h.get("".concat(u,"/getList/").concat(a.unidadeID)).then(e=>{r(e.data),c({title:"Limpeza e Higieniza\xe7\xe3o",subtitle:{id:d,count:e.data.length,new:!1}})})};(0,s.useEffect)(()=>{m()},[d]);let p=(0,I.OL)(u,[{headerName:"ID",field:"id",size:.1},{headerName:"Data",field:"data",size:.1,type:"date"},{headerName:"Profissional",field:"profissional",size:.2},{headerName:"Modelo",field:"modelo",size:.2},{headerName:"Status",field:"status",size:.2}]);return(0,o.jsx)(o.Fragment,{children:t?d&&d>0?(0,o.jsx)(E,{id:d}):(0,o.jsx)(i.Z,{result:t,columns:p}):(0,o.jsx)(w.Z,{show:!0})})};var _=N}},function(e){e.O(0,[9241,1515,9525,8934,5815,9774,2888,179],function(){return e(e.s=94156)}),_N_E=e.O()}]);