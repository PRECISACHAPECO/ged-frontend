(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7463],{59424:function(e,a,o){(window.__NEXT_P=window.__NEXT_P||[]).push(["/formularios/fornecedor",function(){return o(18442)}])},93250:function(e,a,o){"use strict";var r=o(85893),n=o(49837),s=o(91359),i=o(40372);let t=e=>{let{result:a,columns:o,btnNew:t=!0,btnPrint:l=!0,openModal:d}=e;return(0,r.jsx)(n.Z,{children:(0,r.jsx)(s.Z,{sx:{pt:"0"},children:(0,r.jsx)(i.Z,{rows:a,columns:o,buttonsHeader:{btnNew:t,btnPrint:l,openModal:d}})})})};a.Z=t},18442:function(e,a,o){"use strict";o.r(a),o.d(a,{default:function(){return _}});var r=o(85893),n=o(67294),s=o(60664),i=o(93250),t=o(73312),l=o(60565),d=o(83830),c=o(40039),u=o(1890),m=o(77745),x=o(95398),h=o(44642),p=o(79072),f=o(55343),j=o(67836),v=o(29630),g=o(19604),F=o(75084),b=o(35966),C=o(76779),Z=o(11163);o(84220);var N=o(21609),D=o(49540),I=o(34175),P=o(82747),y=o(87536),w=o(86501),S=o(45061);let z=e=>{var a;let{handleClose:o,openModal:i,makeFornecedor:t,loadingSave:d}=e;(0,Z.useRouter)();let[z,E]=(0,n.useState)(!1),{user:k,loggedUnity:A}=(0,n.useContext)(c.V),{handleSearch:_}=(0,n.useContext)(l.f),[J,M]=(0,n.useState)(null),[T,H]=(0,n.useState)(null),[q,R]=(0,n.useState)(!1),[V,G]=(0,n.useState)(null),[L,O]=(0,n.useState)(!1),[X,W]=(0,n.useState)(!1),[B,K]=(0,n.useState)(!1),[U,Q]=(0,n.useState)(!1),[Y,$]=(0,n.useState)([]),[ee,ea]=(0,n.useState)([]),[eo,er]=(0,n.useState)(""),{handleSubmit:en,reset:es,formState:{errors:ei},setValue:et,register:el}=(0,y.cI)({}),ed=()=>{Q(!0),setTimeout(()=>{Q(!1)},5e3);let e=(0,D.q)((0,D.X1)(T)),a=(0,D.q)(A.unidadeID),o=window.location.origin,r="".concat(o,"/registro?c=").concat(e,"&u=").concat(a,"&n=").concat(encodeURIComponent(eo),"&e=").concat(V);navigator.clipboard.writeText(r)},ec=async e=>{e&&18===e.length&&((0,P.zk)(e)?(E(!0),O(!1),await s.h.post("/formularios/fornecedor/cnpj",{unidadeID:A.unidadeID,cnpj:e}).then(a=>{var o,r;M(a.data),H(e),er(null===(o=a.data)||void 0===o?void 0:o.nomeFornecedor),G(null===(r=a.data)||void 0===r?void 0:r.email),E(!1)})):(M(null),H(null),O(!0)))},eu=async()=>{_(T),o()},em=async()=>{E(!0),await s.h.post("/formularios/fornecedor/fornecedorStatus",{unidadeID:A.unidadeID,cnpj:T,status:1}).then(e=>{200===e.status?(M(e.data),w.Am.success("Fornecedor reativado com sucesso")):w.Am.error("Erro ao reativar fornecedor"),E(!1)})},ex=()=>{K(!0)},eh=async()=>{await s.h.post("/formularios/fornecedor/getGruposAnexo",{unidadeID:A.unidadeID}).then(e=>{$(e.data)}).catch(e=>{console.log("\uD83D\uDE80 ~ error:",e)})},ep=e=>{console.log("\uD83D\uDE80 ~ onSubmit ~ values:",e)};return(0,n.useEffect)(()=>{eh()},[]),(0,n.useEffect)(()=>{ec(T),en(ep)},[d]),(0,n.useEffect)(()=>{es(),M(null),H(null),er(null),G(null)},[i]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(u.Z,{open:i,onClose:o,"aria-labelledby":"form-dialog-title",children:[(0,r.jsx)(m.Z,{id:"form-dialog-title",children:"Habilitar novo fornecedor"}),(0,r.jsxs)(x.Z,{children:[(0,r.jsxs)(h.Z,{sx:{mb:3},children:["Insira o CNPJ da empresa que deseja habilitar como um novo fornecedor. Com isso, a empresa ficar\xe1 apta a preencher formul\xe1rios para a ",A.nomeFantasia,"."]}),(0,r.jsx)("form",{onSubmit:en(ep),children:(0,r.jsxs)(p.ZP,{container:!0,children:[(0,r.jsx)(p.ZP,{item:!0,xs:12,md:12,children:(0,r.jsxs)(f.Z,{fullWidth:!0,children:[(0,r.jsx)(j.Z,{label:"CNPJ",placeholder:"CNPJ","aria-describedby":"validation-schema-nome",name:"cnpj",error:L,...el("cnpj",{required:!0,validate:e=>(0,P.zk)(e)||"CNPJ inv\xe1lido"}),helperText:null===(a=ei.cnpj)||void 0===a?void 0:a.message,inputProps:{maxLength:18,onChange(e){M(null),et("cnpj",(0,I.PK)(e.target.value)),H((0,I.PK)(e.target.value)),ec(e.target.value),R(!1)}}}),L&&(0,r.jsx)(v.Z,{variant:"body2",color:"error",children:"Por favor, insira um CNPJ v\xe1lido!"})]})}),J&&J.isFornecedor&&!J.hasFormulario&&q&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(p.ZP,{item:!0,xs:12,md:12,sx:{mt:4},children:(0,r.jsx)(f.Z,{fullWidth:!0,children:(0,r.jsx)(j.Z,{defaultValue:"",type:"email",label:"E-mail",placeholder:"E-mail","aria-describedby":"validation-schema-nome",name:"email",...el("email",{required:!0,validate:e=>e.includes("@")||"E-mail inv\xe1lido"}),error:X,helperText:X?"Insira um e-mail v\xe1lido":null,inputProps:{onChange(e){et("email",e.target.value),G(e.target.value),W(!(0,P.dI)(e.target.value))}}})})}),(0,r.jsx)(p.ZP,{item:!0,xs:12,md:12,sx:{mt:2},children:(0,r.jsx)(g.Z,{severity:"info",children:"Um e-mail ser\xe1 enviado para o fornecedor com as instru\xe7\xf5es de cadastro e preenchimento do formul\xe1rio"})})]})]})}),J&&(0,r.jsx)(p.ZP,{container:!0,sx:{mt:2},children:(0,r.jsx)(p.ZP,{item:!0,xs:12,md:12,children:J.isFornecedor&&J.hasFormulario?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(g.Z,{severity:"success",children:["Esse CNPJ est\xe1 habilitado como um Fornecedor da ",A.nomeFantasia]}),(0,r.jsx)(F.Z,{startIcon:(0,r.jsx)(N.Z,{icon:U?"mdi:check-bold":"iconamoon:copy-bold"}),sx:{mt:2},onClick:U?null:ed,style:{cursor:U?"default":"pointer"},children:U?"Copiado!":"Copiar Link do Formul\xe1rio"})]}):J.isFornecedor&&!J.hasFormulario?(0,r.jsx)(g.Z,{severity:"warning",children:"Esse CNPJ j\xe1 \xe9 seu fornecedor, mas n\xe3o h\xe1 nenhum formul\xe1rio criado"}):!J.isFornecedor&&J.hasFormulario?(0,r.jsx)(g.Z,{severity:"warning",children:"Esse CNPJ n\xe3o est\xe1 mais ativo como um fornecedor mas possui formul\xe1rios preenchidos"}):J.isFornecedor||J.hasFormulario?null:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(p.ZP,{item:!0,xs:12,md:12,sx:{my:1},children:(0,r.jsx)(f.Z,{fullWidth:!0,children:(0,r.jsx)(j.Z,{defaultValue:"",label:"Nome do Fornecedor",placeholder:"Nome do Fornecedor","aria-describedby":"validation-schema-nome",name:"nomeFornecedor",inputProps:{onChange(e){et("nomeFornecedor",e.target.value),er(e.target.value)}}})})}),(0,r.jsx)(p.ZP,{item:!0,xs:12,md:12,sx:{mt:3},children:(0,r.jsx)(f.Z,{fullWidth:!0,children:(0,r.jsx)(b.Z,{multiple:!0,limitTags:5,options:Y,getOptionLabel:e=>e.nome,defaultValue:[],onChange(e,a){ea(a)},renderInput:e=>(0,r.jsx)(j.Z,{...e,label:"Grupos de Anexo",placeholder:"Grupos de Anexo"})})})}),(0,r.jsx)(g.Z,{severity:"info",sx:{mt:3},children:"Esse CNPJ ainda n\xe3o \xe9 seu fornecedor"})]})})})]}),(0,r.jsxs)(C.Z,{className:"dialog-actions-dense",sx:{mx:2,mb:2},children:[(0,r.jsx)(F.Z,{variant:"outlined",onClick:o,children:"Fechar"}),J&&(J.isFornecedor&&J.hasFormulario||!J.isFornecedor&&J.hasFormulario||!J.isFornecedor&&!J.hasFormulario)&&(0,r.jsx)(F.Z,{variant:"contained",onClick:J.isFornecedor&&J.hasFormulario?eu:!J.isFornecedor&&J.hasFormulario?em:J.isFornecedor||J.hasFormulario?null:ex,children:J.isFornecedor&&J.hasFormulario?"Filtrar formul\xe1rios":!J.isFornecedor&&J.hasFormulario?"Reativar fornecedor":J.isFornecedor||J.hasFormulario?null:"Tornar meu fornecedor"})]})]}),(0,r.jsx)(S.Z,{title:"Confirmar novo fornecedor",text:"Tem certeza que deseja tornar o CNPJ ".concat(T," um fornecedor ativo na ").concat(A.nomeFantasia," ? Se sim, o mesmo poder\xe1 preencher formul\xe1rios de Fornecedor para a sua empresa."),handleClose(){K(!1)},openModal:B,handleSubmit:t,inputEmail:!0,setEmail:G,email:V,closeAfterSave:!0,cnpj:T,gruposAnexo:ee,nomeFornecedor:eo,grupoAnexosFornecedor:!0,btnCancel:!0,btnConfirm:!0,btnConfirmColor:"primary"})]})};var E=o(47842),k=o(46749);let A=()=>{let{user:e,loggedUnity:a}=(0,n.useContext)(c.V),[o,u]=(0,n.useState)(null),m=(0,Z.useRouter)(),x=m.pathname,{setTitle:h}=(0,n.useContext)(l.f),[p,f]=(0,n.useState)(!1),[j,v]=(0,n.useState)(!1),{id:g}=(0,n.useContext)(d.X),F=()=>{f(!0)},b=async(o,r,n,i)=>{try{v(!0),await s.h.post("".concat(x,"/makeFornecedor"),{usuarioID:e.usuarioID,unidadeID:a.unidadeID,papelID:e.papelID,cnpj:o,email:i,nomeFornecedor:r,gruposAnexo:n}).then(e=>{200===e.status?(w.Am.success("Fornecedor habilitado com sucesso"),i&&C(i,o,r)):w.Am.error("Erro ao tornar fornecedor"),v(!1)})}catch(t){console.log(t)}},C=(e,o,r)=>{if(e&&(0,P.dI)(e)){let n={unidadeID:a.unidadeID,cnpj:o,nomeFornecedor:r,destinatario:e};console.log("\uD83D\uDE80 ~ sendMail:",n),s.h.post("".concat(x,"/sendMail"),{data:n}).then(e=>{w.Am.success("E-mail enviado com sucesso")}).catch(e=>{console.error("Erro ao enviar email",e)})}},N=async()=>{await s.h.post("".concat(x,"/getList"),{unidadeID:a.unidadeID,papelID:e.papelID,cnpj:e.cnpj?e.cnpj:null}).then(e=>{u(e.data),h({title:"Fornecedor",subtitle:{id:g,count:e.data.length,new:!1}})})};(0,n.useEffect)(()=>{N()},[g,j]);let D=1==e.papelID?[{headerName:"ID",field:"id",size:1},{headerName:"Fornecedor",field:"fornecedor",size:1},{headerName:"CNPJ",field:"cnpj",size:1},{headerName:"Data da Avalia\xe7\xe3o",field:"data",size:1},{headerName:"Cidade",field:"cidade",size:1},{headerName:"Respons\xe1vel",field:"responsavel",size:1},{headerName:"Status",field:"status",size:1}]:2==e.papelID?[{headerName:"ID",field:"id",size:1},{headerName:"F\xe1brica",field:"fabrica",size:1},{headerName:"CNPJ",field:"cnpj",size:1},{headerName:"Data da Avalia\xe7\xe3o",field:"data",size:1},{headerName:"Cidade",field:"cidade",size:1},{headerName:"Respons\xe1vel",field:"responsavel",size:1},{headerName:"Status",field:"status",size:1}]:[],I=(0,k.OL)(x,D);return(0,r.jsxs)(r.Fragment,{children:[o?g&&g>0?(0,r.jsx)(t.Z,{id:g}):(0,r.jsx)(i.Z,{result:o,columns:I,btnNew:1==e.papelID,openModal:1==e.papelID?F:null}):(0,r.jsx)(E.Z,{}),(0,r.jsx)(z,{openModal:p,handleClose:()=>f(!1),makeFornecedor:b,loadingSave:j})]})};var _=A},40372:function(e,a,o){"use strict";o.d(a,{Z:function(){return N}});var r=o(85893),n=o(67294),s=o(87630),i=o(75680),t=o(61953),l=o(67836),d=o(80562),c=o(50853),u=o(11163),m=o.n(u),x=o(75084),h=o(41664),p=o.n(h),f=o(40039),j=o(21609);let v=e=>{let{btnNew:a,btnPrint:o,openModal:s}=e,i=m(),{routes:t}=(0,n.useContext)(f.V);return(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)("div",{className:"flex items-center justify-end sm:justify-normal gap-4 my-2 ",children:[(0,r.jsx)("div",{children:o&&(0,r.jsxs)(x.Z,{onClick:()=>window.print(),type:"button",variant:"outlined",color:"primary",size:"medium",sx:{display:"flex",gap:2},children:[(0,r.jsx)(j.Z,{icon:"mdi:printer"}),(0,r.jsx)("span",{className:"hidden sm:block",children:"Imprimir"})]})}),(0,r.jsx)("div",{className:"",children:a&&t.find(e=>e.rota===i.pathname&&e.inserir)&&(0,r.jsx)(p(),{href:s?"":"".concat(i.pathname,"/novo"),children:(0,r.jsxs)(x.Z,{type:"button",variant:"outlined",color:"primary",size:"medium",onClick:s||null,sx:{display:"flex",gap:2},children:[(0,r.jsx)(j.Z,{icon:"ic:outline-plus"}),(0,r.jsx)("span",{className:"hidden sm:block",children:"Novo"})]})})})]})})};var g=o(61225);let F=e=>((0,g.Z)("(min-width:640px)"),(0,r.jsxs)(t.Z,{sx:{display:"flex",flexDirection:"row",gap:2,alignItems:"baseline",justifyContent:"space-between",p:e=>e.spacing(8,0,0,0)},children:[(0,r.jsxs)(t.Z,{sx:{display:"flex",gap:"8px",textAlig:"end"},children:[(0,r.jsx)(l.Z,{size:"medium",value:e.value,onChange:e.onChange,placeholder:"Buscar…",variant:"standard",InputProps:{startAdornment:(0,r.jsx)(t.Z,{sx:{mr:2,display:"flex"},children:(0,r.jsx)(j.Z,{icon:"mdi:magnify",fontSize:20})}),endAdornment:(0,r.jsx)(d.Z,{size:"medium",title:"Clear","aria-label":"Clear",onClick:e.clearSearch,children:(0,r.jsx)(j.Z,{icon:"mdi:close",fontSize:20})})},sx:{width:{xs:1,sm:"auto"},"& .MuiInputBase-root > svg":{mr:2}}}),(0,r.jsx)("div",{className:"hidden sm:block",children:(0,r.jsx)(c.M,{})})]}),(0,r.jsx)(v,{btnNew:e.buttonsHeader.btnNew,btnPrint:e.buttonsHeader.btnPrint,openModal:e.buttonsHeader.openModal})]}));var b=o(60565),C=o(83830);let Z=e=>{let{rows:a,columns:o,buttonsHeader:t}=e,{handleSearch:l,pageSize:d,setPageSize:c,searchText:u,filteredData:m,setData:x,data:h}=(0,n.useContext)(b.f),{setId:p}=(0,n.useContext)(C.X);return x(a),(0,r.jsx)(s._,{localeText:i.F.components.MuiDataGrid.defaultProps.localeText,autoHeight:!0,columns:o,pageSize:d,rowsPerPageOptions:[10,20,30,40,50,100],components:{Toolbar:F},rows:u?m:h,onCellClick(e,a){p(e.row.id)},onPageSizeChange:e=>c(e),sx:{"& .MuiDataGrid-cell":{cursor:"pointer",overflow:"scroll"}},componentsProps:{toolbar:{value:u,clearSearch:()=>l(""),onChange:e=>l(e.target.value),buttonsHeader:t}}})};var N=Z}},function(e){e.O(0,[4186,1445,1111,5999,7536,2064,2187,1082,1515,8213,6896,3312,9774,2888,179],function(){return e(e.s=59424)}),_N_E=e.O()}]);