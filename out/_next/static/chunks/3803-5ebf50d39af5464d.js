"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3803],{3803:function(e,t,a){a.d(t,{Z:function(){return L}});var s=a(85893),n=a(67294),l=a(87536),o=a(21609);a(50196);var i=a(56531);a(29308);var r=a(81284),d=a(95309),c=a(29630),u=a(22841),x=a(75158);let h=e=>{let{title:t,values:a,name:n,changeCategory:l,register:o,isDisabled:i}=e;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.ZP,{disablePadding:!0,children:(0,s.jsx)(d.Z,{children:(0,s.jsx)(c.Z,{variant:"subtitle1",sx:{fontWeight:600},children:t})})}),a&&a.map((e,t)=>(0,s.jsx)(r.ZP,{disablePadding:!0,children:(0,s.jsxs)(d.Z,{children:[(0,s.jsx)("input",{type:"hidden",name:"".concat(n,".[").concat(t,"].id"),defaultValue:e.id,...o("".concat(n,".[").concat(t,"].id"))}),(0,s.jsx)(u.Z,{control:(0,s.jsx)(x.Z,{name:"".concat(n,"[").concat(t,"].checked"),disabled:!!i,...o("".concat(n,"[").concat(t,"].checked")),defaultChecked:1==e.checked,onClick:t=>l?l(e.id,!!t.target.checked):null}),label:e.nome})]})},t))]})};var m=a(79139),p=a(49837),f=a(91359),v=a(79072),g=a(72389),j=a(80562),b=a(66136),D=function(e){return(0,s.jsx)("svg",{viewBox:"0 0 20 20",fill:"currentColor",height:"1em",width:"1em",...e,children:(0,s.jsx)("path",{d:"M16.88 9.1A4 4 0 0116 17H5a5 5 0 01-1-9.9V7a3 3 0 014.52-2.59A4.98 4.98 0 0117 8c0 .38-.04.74-.12 1.1zM11 11h3l-4-4-4 4h3v3h2v-3z"})})},y=function(e){return(0,s.jsx)("svg",{viewBox:"0 0 384 512",fill:"currentColor",height:"1em",width:"1em",...e,children:(0,s.jsx)("path",{d:"M320 464c8.8 0 16-7.2 16-16v-32h48v32c0 35.3-28.7 64-64 64H64c-35.35 0-64-28.7-64-64v-32h48v32c0 8.8 7.16 16 16 16h256zm-64-304c-17.7 0-32-14.3-32-32V48H64c-8.84 0-16 7.16-16 16v128H0V64C0 28.65 28.65 0 64 0h165.5c17 0 33.2 6.743 45.2 18.75l90.6 90.55c12 12 18.7 28.2 18.7 45.2V192h-48v-32h-80zM88 224c30.9 0 56 25.1 56 56s-25.1 56-56 56h-8v32c0 8.8-7.16 16-16 16s-16-7.2-16-16V240c0-8.8 7.16-16 16-16h24zm24 56c0-13.3-10.7-24-24-24h-8v48h8c13.3 0 24-10.7 24-24zm48-40c0-8.8 7.2-16 16-16h24c26.5 0 48 21.5 48 48v64c0 26.5-21.5 48-48 48h-24c-8.8 0-16-7.2-16-16V240zm32 112h8c8.8 0 16-7.2 16-16v-64c0-8.8-7.2-16-16-16h-8v96zm144-128c8.8 0 16 7.2 16 16s-7.2 16-16 16h-32v32h32c8.8 0 16 7.2 16 16s-7.2 16-16 16h-32v48c0 8.8-7.2 16-16 16s-16-7.2-16-16V240c0-8.8 7.2-16 16-16h48z"})})};let I=e=>{let{grupo:t,indexGrupo:a,handleFileSelect:l,handleRemoveAnexo:i}=e,[r,d]=(0,n.useState)(null);console.log("\uD83D\uDE80 ~ selectedItem:",r);let{settings:u}=(0,n.useContext)(b.J6),x=u.mode,h=(0,n.useRef)(null),m=e=>{h.current.click(),d(e)};return(0,n.useEffect)(()=>{h.current.value=""},[l]),(0,s.jsx)(p.Z,{sx:{mt:4},children:(0,s.jsxs)(f.Z,{children:[(0,s.jsx)(c.Z,{variant:"subtitle1",sx:{fontWeight:600,mb:2},children:t.nome}),(0,s.jsx)(c.Z,{variant:"body2",sx:{mb:2},children:t.descricao}),(0,s.jsx)(v.ZP,{container:!0,spacing:4,children:t.itens.map((e,t)=>{var n;return(0,s.jsx)(v.ZP,{item:!0,xs:12,md:3,children:(0,s.jsxs)("div",{className:"border  ".concat("dark"===x?"border-[#71717B]":"border-[#E1E1E6]"," rounded-lg flex flex-col relative z-10"),children:[(0,s.jsx)("div",{className:"flex items-center justify-center p-2 mt-1 ",children:(0,s.jsx)("p",{className:"font-medium",children:e.nome})}),(0,s.jsx)("div",{className:"flex justify-center items-center cursor-pointer p-1 h-[150px] w-full ",onClick(){e.anexo&&e.anexo.path&&e.anexo.exist?window.open(e.anexo.path,"_blank"):m(e)},children:(0,s.jsx)("div",{className:"flex p-2  justify-center items-center gap-2 rounded-lg w-full h-full m-3 border border-dashed hover:border-[#4A8B57] transition-colors ".concat("dark"===x?" border-[rgba(234, 234, 255, 0.10)]":"rgba(76, 78, 100, 0.12)"),children:(0,s.jsx)("div",{className:"flex items-center gap-3",children:e.anexo&&e.anexo.exist?(0,s.jsx)("div",{children:(0,s.jsx)("div",{className:"flex items-center gap-2",children:(0,s.jsx)(y,{className:"text-6xl fill-red-500"})})}):(0,s.jsxs)("div",{className:"flex flex-col items-center gap-1",children:[(0,s.jsx)(D,{className:"w-20 h-20 ".concat(e.anexo&&e.anexo.exist?"fill-[#666CFF]":"fill-current")}),(0,s.jsx)("h6",{className:"text-sm font-normal opacity-80",children:"Adicione um arquivo"})]})})})}),(0,s.jsxs)("div",{className:"flex items-center justify-between gap-1 p-2 py-3 pl-4",children:[(0,s.jsx)("p",{className:"text-xs opacity-70",children:e.descricao}),(0,s.jsx)(g.Z,{title:1==e.hasPending?"Este item n\xe3o pode mais ser removido pois j\xe1 foi respondido em um formul\xe1rio":"Remover este item",children:(0,s.jsx)(j.Z,{color:"error",onClick:()=>i(e),disabled:!(null===(n=e.anexo)||void 0===n?void 0:n.exist),children:(0,s.jsx)(o.Z,{icon:"tabler:trash-filled"})})})]}),(0,s.jsx)("input",{type:"file",ref:h,style:{display:"none"},onChange:e=>l(e,r)})]})},"".concat(a,"-").concat(t))})})]})})};var Z=a(99070),C=a(40874),S=a(60664);let w=e=>{let[t,a]=(0,n.useState)([]);return(0,n.useEffect)(()=>{let t=async()=>{await S.h.post("relatorio/fornecedor/dadosFornecedor",{data:e}).then(e=>a(e.data))};t()},[e]),t},W=e=>{var t,a,l,o,i,r,d,c,u;let{params:x}=e,h=w(x);return(0,s.jsx)(s.Fragment,{children:h&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(Z.G7,{style:C.W.containerFields,children:null===(t=h.fields)||void 0===t?void 0:t.map((e,t)=>(0,s.jsxs)(n.Fragment,{children:[(0,s.jsxs)(Z.G7,{style:[C.W.fields,{width:"33%"}],children:[(0,s.jsx)(Z.xv,{style:C.W.fieldTitle,children:null!==(l=e.title)&&void 0!==l?l:"NI"}),(0,s.jsx)(Z.xv,{style:C.W.fieldValue,children:null!==(o=e.value)&&void 0!==o?o:"NI"})]}),(t+1)%3==0&&(0,s.jsx)(Z.G7,{style:C.W.separator})]},t))}),(0,s.jsx)(Z.G7,{style:C.W.separator}),(0,s.jsxs)(Z.G7,{style:{display:"flex",flexDirection:"column",gap:7,paddingVertical:10,paddingBottom:10},children:[(0,s.jsxs)(Z.xv,{style:C.W.fieldTitle,children:["Atividades: ",(0,s.jsx)(Z.xv,{style:C.W.fieldValue,children:null!==(i=h.atividades)&&void 0!==i?i:"NI"})]}),(0,s.jsxs)(Z.xv,{style:C.W.fieldTitle,children:["Sistema de qualidade:"," ",(0,s.jsx)(Z.xv,{style:C.W.fieldValue,children:null!==(r=h.sistemaQualidade)&&void 0!==r?r:"NI"})]}),(0,s.jsxs)(Z.xv,{style:C.W.fieldTitle,children:["Categoria: ",(0,s.jsx)(Z.xv,{style:C.W.fieldValue,children:null!==(d=h.categoria)&&void 0!==d?d:"NI"})]})]}),(0,s.jsx)(Z.G7,{style:C.W.separator}),null===(a=h.blocos)||void 0===a?void 0:a.map((e,t)=>(0,s.jsxs)(Z.G7,{style:e,children:[(0,s.jsx)(Z.xv,{style:[C.W.blockTitle,{paddingTop:20}],children:e.nome}),(0,s.jsxs)(Z.G7,{style:C.W.table,children:[(0,s.jsxs)(Z.G7,{style:C.W.tableTitle,children:[(0,s.jsx)(Z.xv,{style:[C.W.tableTitlecolumn,{width:"60%"}],children:"Item"}),(0,s.jsx)(Z.xv,{style:[C.W.tableTitlecolumn,{width:"20%",borderLeft:"1px solid #ddd"}],children:"Resposta"}),(0,s.jsx)(Z.xv,{style:[C.W.tableTitlecolumn,{width:"20%",borderLeft:"1px solid #ddd"}],children:"Observa\xe7\xe3o"})]}),e.itens.map((e,t)=>(0,s.jsxs)(Z.G7,{style:C.W.tableContainer,children:[(0,s.jsx)(Z.G7,{style:[C.W.tableContent,{width:"60%"}],children:(0,s.jsx)(Z.xv,{style:C.W.tableContentcolumn,children:e.nome})}),(0,s.jsx)(Z.G7,{style:[C.W.tableContent,{width:"20%"}],children:(0,s.jsx)(Z.xv,{style:C.W.tableContentcolumn,children:null!==(c=e.resposta)&&void 0!==c?c:"--"})}),(0,s.jsx)(Z.G7,{style:[C.W.tableContent,{width:"20%"}],children:(0,s.jsx)(Z.xv,{style:C.W.tableContentcolumn,children:null!==(u=e.obsResposta)&&void 0!==u?u:"--"})})]}))]})]},t))]})})};var F=a(19604),P=a(61953),E=a(55343),N=a(11163),k=a.n(N),V=a(46749),z=a(99741),A=a(60565),T=a(83830),G=a(40039),R=a(47842);a(49540);var B=a(86501),M=a(11935),O=a(7071);a(13860),a(57548),a(45061);var H=a(34282);let _=e=>{let{id:t}=e,{user:a,loggedUnity:o}=(0,n.useContext)(G.V),[r,d]=(0,n.useState)(!1),[u,x]=(0,n.useState)(!1),[g,j]=(0,n.useState)(!1),[D,y]=(0,n.useState)([]),[Z,C]=(0,n.useState)(null),[w,N]=(0,n.useState)([]),[_,L]=(0,n.useState)([]),[Q,U]=(0,n.useState)([]),[q,J]=(0,n.useState)([]),[K,X]=(0,n.useState)([]),[Y,$]=(0,n.useState)([]),[ee,et]=(0,n.useState)(""),[ea,es]=(0,n.useState)(!1),[en,el]=(0,n.useState)(null),[eo,ei]=(0,n.useState)(null),[er,ed]=(0,n.useState)(!1),[ec,eu]=(0,n.useState)(!1),[ex,eh]=(0,n.useState)(!0),[em,ep]=(0,n.useState)({status:!1,errors:[]}),[ef,ev]=(0,n.useState)(!1),[eg,ej]=(0,n.useState)([]),[eb,eD]=(0,n.useState)({status:!1,message:"Voc\xea n\xe3o tem permiss\xf5es",messageType:"info"}),{setTitle:ey,setStorageId:eI,getStorageId:eZ}=(0,n.useContext)(A.f),eC=k(),{setId:eS}=(0,n.useContext)(T.X),ew=t&&t>0?"edit":"new",eW=eC.pathname,{settings:eF}=(0,n.useContext)(b.J6),{watch:eP,register:eE,control:eN,getValues:ek,clearErrors:eV,setValue:ez,setError:eA,handleSubmit:eT,formState:{errors:eG}}=(0,l.cI)(),eR=e=>{var t;null==e||null===(t=e.blocos)||void 0===t||t.map((e,t)=>{var a;null==e||null===(a=e.itens)||void 0===a||a.map((e,a)=>{(null==e?void 0:e.resposta)&&ez("blocos[".concat(t,"].itens[").concat(a,"].resposta"),null==e?void 0:e.resposta)})}),ez()},eB=async()=>{try{await S.h.post("/formularios/fornecedor/verifyFormPending/".concat(t),{parFormularioID:1}).then(e=>{eh(e.data) //! true/false
})}catch(e){console.log(e)}},eM=async e=>{let s={status:e,auth:{usuarioID:a.usuarioID,papelID:a.papelID,unidadeID:o.unidadeID}};try{x(!0),await S.h.post("".concat(eW,"/changeFormStatus/").concat(t),s).then(e=>{B.ZP.success(V.OD.successUpdate),x(!1)})}catch(n){console.log(n)}},eO=async()=>{let e={status:{edit:er,status:ee.status},auth:{usuarioID:a.usuarioID,papelID:a.papelID,unidadeID:o.unidadeID}};if(er)try{x(!0),await S.h.post("".concat(eW,"/updateFormStatus/").concat(t),e).then(e=>{B.ZP.success(V.OD.successUpdate),x(!1)})}catch(s){console.log(s)}else B.ZP.error("N\xe3o h\xe1 dados a serem atualizados!")},eH=[{id:1,title:"Formul\xe1rio do fornecedor",titleButton:"Imprimir",component:(0,s.jsx)(W,{params:{id:t}}),route:"/relatorio/fornecedor/dadosFornecedor",papelID:a.papelID,identification:"01",params:{fornecedorID:t}}],e_=(e,t)=>{let a=[];null==e||e.map((e,s)=>{eQ(e.categorias,t)&&a.push(e)}),$(a)},eL=(e,t)=>{let a=w.map(a=>a.id===e?{...a,checked:t}:a);N(a),e_(K,a)},eQ=(e,t)=>{let a=e.map(e=>e.categoriaID),s=t.filter(e=>e.checked).map(e=>e.id);if(a.length!==s.length)return!1;let n=[...a].sort(),l=[...s].sort();for(let o=0;o<n.length;o++)if(n[o]!==l[o])return!1;return!0},eU=()=>{console.log("\uD83D\uDE80 ~ loggedUnity.unidadeID:",o.unidadeID);try{d(!0),t&&S.h.post("".concat(eW,"/getData/").concat(t),{unidadeLogadaID:o.unidadeID}).then(e=>{console.log("getData: ",e.data.grupoAnexo),y(e.data.fields),N(e.data.categorias),L(e.data.atividades),U(e.data.sistemasQualidade),X(e.data.blocos),e_(e.data.blocos,e.data.categorias),C(e.data.data),J(e.data.grupoAnexo),et(e.data.info),el(e.data.unidade),eR(e.data);let t=V.WR[e.data.info.status];ei(t),eD({status:2==a.papelID&&e.data.info.status<40,message:2==a.papelID?"Esse formul\xe1rio j\xe1 foi conclu\xeddo e enviado pra f\xe1brica, n\xe3o \xe9 mais poss\xedvel alterar as informa\xe7\xf5es!":"Somente o fornecedor pode alterar as informa\xe7\xf5es deste formul\xe1rio!",messageType:2==a.papelID?"warning":"info"}),d(!1)})}catch(e){console.log(e)}},eq=()=>{eC.push("/formularios/fornecedor/"),B.ZP.error("Voc\xea n\xe3o tem permiss\xf5es para acessar esta p\xe1gina!")},eJ=()=>{eY(),es(!0),j(!0)},eK=async e=>{e.conclusion=!0,await eT(eX)(e)},eX=async function(e){let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];!0===s.conclusion&&(e.status=a&&1==a.papelID?s.status:40,e.obsConclusao=s.obsConclusao);let n={forms:{...e,header:{...e.header}},auth:{usuarioID:a.usuarioID,papelID:a.papelID,unidadeID:o.unidadeID}};try{x(!0),await e0(),await S.h.put("".concat(eW,"/updateData/").concat(t),n).then(e=>{B.ZP.success(V.OD.successUpdate),x(!1)})}catch(l){console.log(l)}},eY=()=>{eV();let e=!1,t=[];D.forEach((a,s)=>{let n=a.tabela?"header.".concat(a.tabela):"header.".concat(a.nomeColuna),l=ek(n);1!==a.obrigatorio||l||(eA(n,{type:"manual",message:"Campo obrigat\xf3rio"}),t.push(null==a?void 0:a.nomeCampo),e=!0)}),Y.forEach((a,s)=>{a.itens.forEach((a,n)=>{let l=ek("blocos[".concat(s,"].itens[").concat(n,"].resposta"));(null==a?void 0:a.obrigatorio)!==1||l||(eA("blocos[".concat(s,"].itens[").concat(n,"].resposta"),{type:"manual",message:"Campo obrigat\xe1rio"}),t.push(null==a?void 0:a.nome),e=!0)})}),ep({status:e,errors:t})};(0,n.useEffect)(()=>{ey("Formul\xe1rio do Fornecedor"),"edit"==ew?eU():eq(),eB()},[t,u]),(0,n.useEffect)(()=>{eY()},[]),(0,n.useEffect)(()=>{ef&&B.ZP.success("Dados copiados com sucesso!")},[ef]);let e$=(e,t)=>{let a=e.target.files[0];console.log("\uD83D\uDE80 ~ selectedFile:",a);let s={...t,anexo:{exist:!0,path:null,file:a,nome:a.name,type:a.type,size:a.size,time:a.lastModified}},n=q.map(e=>e.grupoAnexoID==t.grupoanexoID?{...e,itens:e.itens.map(e=>e.grupoanexoitemID==s.grupoanexoitemID?(console.log("encontrou item"),s):e)}:e);J(n),B.ZP.success("Anexo adicionado, salve para concluir!")},e0=async()=>{let e=new FormData;e.append("usuarioID",a.usuarioID),e.append("unidadeID",o.unidadeID);let s=0;q.forEach((t,a)=>{t.itens.forEach((t,a)=>{t.anexo&&t.anexo.file&&(e.append("pdfFiles",t.anexo.file),e.append("titulo[".concat(s,"]"),t.anexo.nome),e.append("grupoanexoitemID[".concat(s,"]"),t.grupoanexoitemID),s++)})}),eg.forEach((t,a)=>{e.append("arrAnexoRemoved[".concat(a,"]"),t)}),await S.h.post("/formularios/fornecedor/saveAnexo/".concat(t),e,{headers:{"Content-Type":"multipart/form-data"}})},e1=e=>{ej([...eg,e.grupoanexoitemID]);let t=q.map(t=>t.grupoAnexoID==e.grupoanexoID?{...t,itens:t.itens.map(t=>t.grupoanexoitemID==e.grupoanexoitemID?{...e,anexo:null}:t)}:t);J(t),B.ZP.success("Anexo pr\xe9-removido, salve para concluir!")};return(0,s.jsxs)(s.Fragment,{children:[r?(0,s.jsx)(R.Z,{}):D?(0,s.jsxs)("form",{onSubmit:eT(e=>{eb.status?eX(e,!1):eO()}),children:[Y&&0===Y.length&&(0,s.jsx)(F.Z,{severity:"warning",sx:{mb:2},children:"N\xe3o h\xe1 nenhum bloco dispon\xedvel para as categorias selecionadas!"}),!eb.status&&(0,s.jsx)(F.Z,{severity:eb.messageType,sx:{mb:2},children:eb.message}),(0,s.jsxs)(p.Z,{children:[(0,s.jsx)(z.Z,{btnCancel:!0,btnSave:2==a.papelID&&ee.status<40,btnSend:1==a.papelID&&ee.status>=40||2==a.papelID&&ee.status<40,disabledSend:0===Y.length,disabledSubmit:0===Y.length,disabledPrint:0===Y.length,btnPrint:!0,generateReport:V.OE,dataReports:eH,handleSubmit:()=>eT(eX),handleSend:eJ,title:"Fornecedor",btnStatus:!0,handleBtnStatus:()=>eu(!0),type:ew}),(0,s.jsxs)(f.Z,{children:[en&&(0,s.jsxs)(P.Z,{sx:{mb:4},children:[(0,s.jsx)("input",{type:"hidden",value:en.unidadeID,name:"unidadeID",...eE("unidadeID")}),(0,s.jsxs)(v.ZP,{container:!0,spacing:4,children:[(0,s.jsxs)(v.ZP,{item:!0,xs:12,md:6,children:[(0,s.jsx)(c.Z,{variant:"caption",children:"F\xe1brica:"}),(0,s.jsx)(c.Z,{variant:"subtitle1",sx:{fontWeight:600},children:en.nomeFantasia})]}),(0,s.jsx)(v.ZP,{item:!0,xs:12,md:6,children:eo&&(0,s.jsx)(P.Z,{display:"flex",alignItems:"center",justifyContent:"flex-end",children:(0,s.jsx)(O.Z,{size:"small",skin:"light",color:eo.color,label:eo.title,sx:{"& .MuiChip-label":{textTransform:"capitalize"}}})})})]})]}),(0,s.jsx)(i.Z,{register:eE,errors:eG,setValue:ez,watch:eP,fields:D,values:Z,disabled:!eb.status,setCopiedDataContext:ev}),(0,s.jsxs)(v.ZP,{container:!0,spacing:4,children:[(0,s.jsx)(v.ZP,{item:!0,xs:12,md:4,children:(0,s.jsx)(h,{title:"Categorias",values:w,name:"categorias",changeCategory:eL,register:eE,disabled:!eb.status})}),(0,s.jsx)(v.ZP,{item:!0,xs:12,md:4,children:(0,s.jsx)(h,{title:"Atividades",values:_,name:"atividades",register:eE,disabled:!eb.status})}),(0,s.jsx)(v.ZP,{item:!0,xs:12,md:4,children:(0,s.jsx)(h,{title:"Sistema de Qualidade",values:Q,name:"sistemasQualidade",register:eE,disabled:!eb.status})})]})]})]}),Y&&Y.map((e,t)=>(0,s.jsx)(m.Z,{index:t,blockKey:"parFornecedorBlocoID",values:e,register:eE,setValue:ez,errors:eG,disabled:!eb.status},t)),q&&q.map((e,t)=>(0,s.jsx)(I,{grupo:e,indexGrupo:t,handleFileSelect:e$,handleRemoveAnexo:e1},t)),(0,s.jsx)(p.Z,{sx:{mt:4},children:(0,s.jsx)(f.Z,{children:(0,s.jsx)(v.ZP,{container:!0,spacing:4,children:(0,s.jsx)(v.ZP,{item:!0,xs:12,md:12,children:(0,s.jsx)(E.Z,{fullWidth:!0,children:(0,s.jsx)(c.Z,{variant:"subtitle1",sx:{fontWeight:600,mb:2},children:"Observa\xe7\xf5es (campo de uso exclusivo da validadora)"})})})})})})]}):null,(0,s.jsx)(M.Z,{openModal:ea,handleClose(){es(!1),j(!1)},title:"Concluir Formul\xe1rio",text:"Deseja realmente concluir este formul\xe1rio?",info:ee,btnCancel:!0,btnConfirm:!0,btnConfirmColor:"primary",conclusionForm:eK,listErrors:em}),ec&&(0,s.jsx)(H.Z,{id:t,parFormularioID:1,formStatus:ee.status,hasFormPending:ex,canChangeStatus:1==a.papelID&&!ex&&ee.status>30,openModal:ec,handleClose:()=>eu(!1),title:"Hist\xf3rico do Formul\xe1rio",text:"Listagem do hist\xf3rico das movimenta\xe7\xf5es do formul\xe1rio ".concat(t," do Fornecedor."),btnCancel:!0,btnConfirm:!0,handleSubmit:eM})]})};var L=_}}]);